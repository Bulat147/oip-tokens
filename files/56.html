<!doctype html>
<html lang="ru">
 <head>
  <title>Kubernetes как PaaS: максимум возможностей без разработки. Часть 2 / Хабр</title>
  <meta property="fb:app_id" content="444736788986613">
  <meta property="fb:pages" content="472597926099084">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@habr_com">
  <meta property="og:site_name" content="Хабр">
  <link href="https://habr.com/ru/rss/post/890386/?fl=ru" type="application/rss+xml" title rel="alternate" name="rss">
  <link href="https://habr.com/ru/companies/vktech/articles/890386/" rel="canonical" data-hid="e3fa780">
  <link rel="image_src" href="https://habrastorage.org/getpro/habr/upload_files/205/df3/456/205df345626a6122cc9eac69284d2479.png" data-hid="2a79c45">
  <link rel="amphtml" href="https://habr.com/ru/amp/publications/890386/">
  <meta property="og:title" content="Kubernetes как PaaS: максимум возможностей без разработки. Часть 2">
  <meta name="twitter:title" content="Kubernetes как PaaS: максимум возможностей без разработки. Часть 2">
  <meta name="aiturec:title" content="Kubernetes как PaaS: максимум возможностей без разработки. Часть 2">
  <meta name="description" content="Это вторая часть серии статей, где мы шаг за шагом строим PaaS на базе Kubernetes без написания кода. Наша цель — выжать максимум из современных технологий и экосистемы Kubernetes, чтобы создать...">
  <meta itemprop="description" content="Это вторая часть серии статей, где мы шаг за шагом строим PaaS на базе Kubernetes без написания кода. Наша цель — выжать максимум из современных технологий и экосистемы Kubernetes, чтобы создать...">
  <meta property="og:description" content="Это вторая часть серии статей, где мы шаг за шагом строим PaaS на базе Kubernetes без написания кода. Наша цель — выжать максимум из современных технологий и экосистемы Kubernetes, чтобы создать...">
  <meta name="twitter:description" content="Это вторая часть серии статей, где мы шаг за шагом строим PaaS на базе Kubernetes без написания кода. Наша цель — выжать максимум из современных технологий и экосистемы Kubernetes, чтобы создать...">
  <meta property="aiturec:description" content="Это вторая часть серии статей, где мы шаг за шагом строим PaaS на базе Kubernetes без написания кода. Наша цель — выжать максимум из современных технологий и экосистемы Kubernetes, чтобы создать...">
  <meta itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/205/df3/456/205df345626a6122cc9eac69284d2479.png">
  <meta property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/205/df3/456/205df345626a6122cc9eac69284d2479.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/205/df3/456/205df345626a6122cc9eac69284d2479.png">
  <meta name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/205/df3/456/205df345626a6122cc9eac69284d2479.png">
  <meta property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/205/df3/456/205df345626a6122cc9eac69284d2479.png?format=vk">
  <meta property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/205/df3/456/205df345626a6122cc9eac69284d2479.png?format=vk">
  <meta property="aiturec:item_id" content="890386">
  <meta property="aiturec:datetime" content="2025-05-06T09:12:17.000Z">
  <meta content="https://habr.com/ru/companies/vktech/articles/890386/" property="og:url">
  <meta property="og:type" content="article">
  <meta property="og:locale" content="ru_RU">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta name="keywords" content="vk cloud, paas, балансировка нагрузки, kubernetes, k8s, casdoor">
  <script type="application/ld+json" data-hid="1e0f0a2">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/companies\/vktech\/articles\/890386\/"},"headline":"Kubernetes как PaaS: максимум возможностей без разработки. Часть 2","datePublished":"2025-05-06T12:12:17+03:00","dateModified":"2025-05-07T00:28:25+03:00","author":{"@type":"Person","name":"Сергей Емельянов"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Это вторая часть серии статей, где мы шаг за шагом строим PaaS на базе Kubernetes без написания кода. Наша цель &mdash; выжать максимум из современных технологий и эко...","url":"https:\/\/habr.com\/ru\/companies\/vktech\/articles\/890386\/#post-content-body","about":["c_vktech","c_vk","h_kubernetes","h_devops","h_dev_management","f_develop","f_management","f_admin"],"image":["https:\/\/habr.com\/share\/publication\/890386\/393dde17c2046261a3a7c42e5d64cea7\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/ccc\/0a6\/c3f\/ccc0a6c3f77954981682afe0c26fdb91.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/4a0\/558\/8c0\/4a05588c06619099deb19fcaef88c83d.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/889\/611\/fce\/889611fce5b94c3607b63cb3faea0346.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/d08\/f12\/02c\/d08f1202c7c24bea044cf259ca8318a8.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/259\/1f4\/cbb\/2591f4cbb6df2f25bcbd905694dda18a.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/1d9\/5b9\/ddf\/1d95b9ddf7e41bd398d563b43a20e3ac.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/f23\/e2c\/082\/f23e2c08291395171751c1f4b9088ada.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/281\/102\/928\/2811029280fef2d89f47fb445ebd7a4f.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/4fc\/284\/544\/4fc284544b116d88796189cd1ff8df87.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/205\/df3\/456\/205df345626a6122cc9eac69284d2479.png"]}</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover,maximum-scale=1,user-scalable=0">
  <meta name="referrer" content="unsafe-url">
  <style>
      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5VvmojLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5Vvk4jLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5VvmYjLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5Vvl4jLazX3dA.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }

      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveSxf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveQhf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveSBf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveRhf6Xl7Glw.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }

      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eSxf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eQhf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eSBf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eRhf6Xl7Glw.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }
    </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/theme/light-v1.css" as="style" media="(prefers-color-scheme: light)">
  <link rel="preload" href="https://assets.habr.com/habr-web/css/theme/dark-v1.css" as="style" media="(prefers-color-scheme: dark)">
  <link id="light-colors" rel="stylesheet" href="https://assets.habr.com/habr-web/css/theme/light-v1.css" media="(prefers-color-scheme: light)">
  <link id="dark-colors" rel="stylesheet" href="https://assets.habr.com/habr-web/css/theme/dark-v1.css" media="(prefers-color-scheme: dark)">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.635b6c39236ebd33fa716c71ab0131a0.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  <style>
      .grecaptcha-badge {
        visibility: hidden;
      }
    </style>
  <meta name="habr-version" content="2.241.0">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" type="image/png" sizes="16x16" href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png">
  <link rel="shortcut icon" type="image/png" sizes="32x32" href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png">
  <link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png">
  <link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png">
  <link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png">
  <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png">
  <link rel="apple-touch-icon" type="image/png" sizes="256x256" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png">
  <link rel="mask-icon" color="#77a2b6" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg">
  <link crossorigin="use-credentials" href="/manifest.webmanifest" rel="manifest">
  <script async src="https://unpkg.com/pwacompat" crossorigin="anonymous"></script>
  <script>window.yaContextCb = window.yaContextCb || []</script>
  <script src="https://yandex.ru/ads/system/context.js" async></script>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.04465f7c.css" as="style">
  <link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.978df117.js" as="script">
  <link rel="preload" href="https://assets.habr.com/habr-web/css/app.8599692f.css" as="style">
  <link rel="preload" href="https://assets.habr.com/habr-web/js/app.58b8c457.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.04465f7c.css">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.8599692f.css">
 </head>
 <body>
  <div id="mount">
   <div id="app">
    <div class="tm-layout__wrapper">
     <!--[--><!---->
     <div></div><!---->
     <header class="tm-header" data-test-id="header">
      <div class="tm-page-width">
       <!--[-->
       <div class="tm-header__container">
        <!----><span class="tm-header__logo-wrap"><a class="tm-header__logo tm-header__logo_hl-ru tm-header__logo" href="/ru/">
          <svg class="tm-svg-img tm-header__icon" height="16" width="16">
           <title>
            Хабр
           </title><use xlink:href="/img/habr-logo-ru.svg#logo"></use>
          </svg></a><span style="display:none;" class="tm-header__beta-sign">β</span></span><!--[-->
        <div class="tm-dropdown tm-header__projects">
         <div class="tm-dropdown__head">
          <!--[-->
          <button class="tm-header__dropdown-toggle">
           <svg class="tm-svg-img tm-header__icon tm-header__icon_dropdown" height="16" width="16">
            <title>
             Открыть список
            </title><use xlink:href="/img/megazord-v28.7909a852..svg#arrow-down"></use>
           </svg></button><!--]-->
         </div><!---->
        </div><a href="/ru/sandbox/start/" class="tm-header__become-author-btn">Как стать автором</a>
        <div class="tm-feature tm-feature tm-feature_variant-inline tm-header__feature">
         <!---->
        </div><!----><!--]--><!---->
       </div><!--]-->
      </div>
     </header>
     <div class="tm-layout">
      <div class="tm-page-progress-bar"></div>
      <div class="tm-base-layout__header_is-sticky tm-base-layout__header" data-menu-sticky="true">
       <div class="tm-page-width">
        <!--[-->
        <div class="tm-base-layout__header-wrapper">
         <div class="tm-main-menu">
          <div class="tm-main-menu__section">
           <nav class="tm-main-menu__section-content">
            <!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/feed/">Моя лента</a><!--]--><!--[--><a class="tm-main-menu__item" href="/ru/articles/">Все потоки</a><!--]--><!--[--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/develop/">Разработка</a><!--]--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/admin/">Администрирование</a><!--]--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/design/">Дизайн</a><!--]--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/management/">Менеджмент</a><!--]--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/marketing/">Маркетинг</a><!--]--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/popsci/">Научпоп</a><!--]--><!--]-->
           </nav>
          </div>
         </div>
         <div class="tm-header-user-menu tm-base-layout__user-menu">
          <a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search" data-test-id="search-button">
           <svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark" height="24" width="24">
            <title>
             Поиск
            </title><use xlink:href="/img/megazord-v28.7909a852..svg#search"></use>
           </svg></a><!----><!---->
          <div class="tm-header-user-menu__item tm-header-user-menu__write">
           <div>
            <svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_write tm-header-user-menu__icon_dark" height="24" width="24">
             <title>
              Написать публикацию
             </title><use xlink:href="/img/megazord-v28.7909a852..svg#write"></use>
            </svg>
           </div><!---->
          </div><!--[-->
          <div class="tm-header-user-menu__item">
           <button class="tm-header-user-menu__toggle" data-test-id="user-menu-settings">
            <svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_dark" height="24" width="24">
             <title>
              Настройки
             </title><use xlink:href="/img/megazord-v28.7909a852..svg#page-settings"></use>
            </svg></button>
          </div><a href="https://habr.com/kek/v1/auth/habrahabr/?back=/ru/companies/vktech/articles/890386/&amp;hl=ru" rel="nofollow" class="tm-header-user-menu__item"><!--[-->
           <button class="btn btn_solid btn_small tm-header-user-menu__login" type="button"><!--[-->Войти<!--]--></button><!--]--></a><!--]--><!----><!--teleport start--><!--teleport end--><!---->
         </div>
        </div><!--]-->
       </div>
      </div><!---->
      <div class="tm-page-width">
       <!--[--><!--]-->
      </div>
      <main class="tm-layout__container">
       <div class="tm-page" hl="ru" companyname="vktech" data-async-called="true" style="--5ab2e5a8:16px;--44c4f6f6:100%;--45ba7a3b:0;">
        <div class="tm-page-width">
         <!--[-->
         <div class="tm-page__header">
          <!--[-->
          <div class="tm-company-card__branding tm-company-card__branding_loading tm-company-article__branding" data-test-id="company-card-branding">
           <div class="tm-company-card__branding-placeholder">
            <!---->
           </div><a href="https://cloud.vk.com/events/vk-cloud-conf-25/?utm_source=habr&amp;utm_medium=referral&amp;utm_campaign=???&amp;utm_content=banner"><img class="tm-company-card__branding-image" src="//habrastorage.org/getpro/habr/branding/a71/21c/838/a7121c83810d7b34e282c9af838b8af2.png"></a>
          </div><!--]-->
         </div>
         <div class="tm-page__wrapper">
          <div class="tm-page__main_has-sidebar tm-page__main">
           <div class="pull-down">
            <!---->
            <div class="pull-down__header" style="height:0px;">
             <div class="pull-down__content" style="bottom:10px;">
              <svg class="tm-svg-img pull-down__icon pull-down__arrow" height="24" width="24">
               <title>
                Обновить
               </title><use xlink:href="/img/megazord-v28.7909a852..svg#pull-arrow"></use>
              </svg>
             </div>
            </div><!--[--><!--[-->
            <div class="tm-article-presenter">
             <!--[--><!--[--><!---->
             <div class="tm-company-profile-card tm-company-article__profile-card">
              <div class="tm-company-card tm-company-profile-card__info">
               <div class="tm-company-card__header">
                <a href="/ru/companies/vktech/profile/" class="tm-company-card__avatar">
                 <div class="tm-entity-image">
                  <img alt="" class="tm-entity-image__pic" height="48" src="//habrastorage.org/getpro/habr/company/ebb/972/15d/ebb97215d4403e1dbc2b3d190ec8239c.png" width="48">
                 </div></a><!--[--><!---->
                <div class="tm-counter-container tm-company-card__rating">
                 <div class="tm-counter-container__header">
                  <!--[--><!--[--><!--]-->
                  <div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating">
                   <!---->
                   <div class="tm-votes-lever__score tm-votes-lever__score_appearance-rating tm-votes-lever__score_no-margin tm-votes-lever__score">
                    <!--[--><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter_rating tm-votes-lever__score-counter" data-test-id="votes-score-counter">361.28</span></span><!--]-->
                   </div><!---->
                  </div><!--]-->
                 </div>
                 <div class="tm-counter-container__footer">
                  <!--[--><span class="tm-rating__text tm-rating__text">Рейтинг</span><!--]-->
                 </div>
                </div><!----><!--]-->
               </div>
               <div class="tm-company-card__info">
                <a href="/ru/companies/vktech/profile/" class="tm-company-card__name"><span>VK Tech</span></a>
                <div class="tm-company-card__description">
                 VK Tech — российский разработчик корпоративного ПО
                </div>
               </div>
              </div>
              <div class="tm-company-profile-card__buttons">
               <div class="tm-button-follow tm-company-profile-card__button tm-company-profile-card__button_follow">
                <!---->
                <button class="tm-button-follow__button tm-button-follow__button_big" data-test-id="follow-button" type="button">Подписаться</button>
               </div><!----><!----><!---->
              </div>
             </div><!----><!--]--><!--]-->
             <div class="tm-article-presenter__body" data-test-id="article-body">
              <div class="tm-misprint-area">
               <div class="tm-misprint-area__wrapper">
                <!--[-->
                <article class="tm-article-presenter__content tm-article-presenter__content_narrow">
                 <!--[-->
                 <div class="tm-article-presenter__header">
                  <!--[--><!--]-->
                  <div class="tm-article-snippet tm-article-snippet tm-article-presenter__snippet">
                   <!--[--><!--]-->
                   <div class="tm-article-snippet__meta-container">
                    <div class="tm-article-snippet__meta">
                     <span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/totaki/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="totaki">
                       <div class="tm-entity-image">
                        <img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/bea/5a3/53b/bea5a353bafb1de0b5a9a64bb35763aa.jpeg" width="24">
                       </div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/totaki/" class="tm-user-info__username">totaki <!----></a><!--[--><span class="tm-article-datetime-published"><time datetime="2025-05-06T09:12:17.000Z" title="2025-05-06, 12:12">21 час назад</time></span><!--]--></span></span>
                    </div><!---->
                   </div>
                   <h1 class="tm-title tm-title_h1" lang="ru" data-test-id="articleTitle"><span>Kubernetes как PaaS: максимум возможностей без разработки. Часть 2</span></h1>
                   <div class="tm-article-snippet__stats" data-test-id="articleStats">
                    <!---->
                    <div class="tm-article-reading-time">
                     <span class="tm-svg-icon__wrapper tm-article-reading-time__icon">
                      <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
                       <title>
                        Время на прочтение
                       </title><use xlink:href="/img/megazord-v28.7909a852..svg#clock"></use>
                      </svg></span><span class="tm-article-reading-time__label">12 мин</span>
                    </div><span class="tm-icon-counter tm-data-icons__item">
                     <svg class="tm-svg-img tm-icon-counter__icon" height="24" width="24">
                      <title>
                       Количество просмотров
                      </title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-views"></use>
                     </svg><span class="tm-icon-counter__value" title="596">596</span></span>
                   </div>
                   <div class="tm-publication-hubs__container" data-test-id="articleHubsList">
                    <div class="tm-publication-hubs">
                     <!--[--><span class="tm-publication-hub__link-container"><a href="/ru/companies/vktech/articles/" class="tm-publication-hub__link"><!--[--><span>Блог компании VK Tech</span><!----><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/companies/vk/articles/" class="tm-publication-hub__link"><!--[--><span>Блог компании VK</span><!----><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/kubernetes/" class="tm-publication-hub__link"><!--[--><span>Kubernetes</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/devops/" class="tm-publication-hub__link"><!--[--><span>DevOps</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/dev_management/" class="tm-publication-hub__link"><!--[--><span>Управление разработкой</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><!--]-->
                    </div>
                   </div><!----><!----><!---->
                  </div>
                 </div><!--[--><!---->
                 <div class="tm-article-body" data-gallery-root lang="ru">
                  <div>
                   <!--[--><!--]-->
                  </div>
                  <div id="post-content-body">
                   <div>
                    <div class="article-formatted-body article-formatted-body article-formatted-body_version-2">
                     <div xmlns="http://www.w3.org/1999/xhtml">
                      <figure class="full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/ccc/0a6/c3f/ccc0a6c3f77954981682afe0c26fdb91.png" width="860" height="574" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/ccc/0a6/c3f/ccc0a6c3f77954981682afe0c26fdb91.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/ccc/0a6/c3f/ccc0a6c3f77954981682afe0c26fdb91.png 781w" loading="lazy" decode="async">
                      </figure>
                      <p>Это вторая часть серии статей, где мы шаг за шагом строим PaaS на базе Kubernetes без написания кода. Наша цель — выжать максимум из современных технологий и экосистемы Kubernetes, чтобы создать PaaS-решение, которое упростит жизнь разработчикам. Мы хотим, чтобы приложения и сервисы разворачивались быстро, удобно и без глубокого погружения в инфраструктуру. Перейдем сразу к делу.</p>
                      <h3>Что уже сделано</h3>
                      <p>В<a href="https://habr.com/ru/companies/vktech/articles/895954/"> предыдущей части</a> мы сделали подготовительные шаги:</p>
                      <ul>
                       <li>
                        <p><strong>Добавили Gateway</strong>: подключили Envoy Gateway для управления входящим трафиком. Это позволило легко заводить внешний трафик в кластер через Kubernetes Gateway API, без сложных настроек.</p></li>
                       <li>
                        <p><strong>Выбрали первый оператор — CloudNativePG</strong>: развернули оператор PostgreSQL, который автоматизирует создание и управление кластерами баз данных, обеспечивая высокую доступность и простоту использования.</p></li>
                       <li>
                        <p><strong>Добавили Cyclops UI</strong>: интегрировали веб-интерфейс Cyclops, чтобы пользователи PaaS могли удобно заводить свои приложения. Через формы в UI они задают параметры, не вникая в YAML или CLI.</p></li>
                       <li>
                        <p><strong>Добавили Template для создания PostgreSQL</strong>: создали шаблон в Cyclops UI, который позволяет пользователям одним кликом разворачивать экземпляры PostgreSQL, используя CloudNativePG под капотом.</p></li>
                      </ul>
                      <p>Эти шаги заложили фундамент для нашей PaaS. Пора идти дальше — к централизованному управлению.</p>
                      <h3>Единый IAM для централизованного управления</h3>
                      <p>На нашей платформе будет доступно множество разнообразных приложений, и ручное управление пользователями и доступом быстро превратится в кошмар, поэтому мы добавим единый IAM. Он решает эту проблему, позволяя централизованно управлять пользователями и их правами из одного места — будь то доступ к интерфейсу, сервисам или данным.</p>
                      <p>На данный момент существует один хорошо зарекомендовавший себя стандарт — <strong>OIDC (OpenID Connect)</strong>. Он построен поверх OAuth 2.0 и широко используется для аутентификации и авторизации. Единственный его минус — многие бесплатные решения предлагают интеграции с OIDC только в платных Enterprise-версиях. Впрочем, нам это пока не помеха: мы можем выбрать инструмент, который поддерживает OIDC из коробки и вписывается в наш бескодовый подход.&nbsp;</p>
                      <p>Со стандартом определились, теперь перейдем к выбору конкретного решения. При выборе системы авторизации и аутентификации (IAM) для нашей PaaS-платформы я сразу подумал о Keycloak, но он оказался слишком громоздким для моих задач. Его сложная архитектура и код на Java не вписываются в мой стек, где я активно использую Go, — мне не хотелось нагружать проект этим «багажом».</p>
                      <p>Вдохновившись статьей <a href="https://habr.com/ru/articles/720490/">«Выбираем IAM в 2023, или Что есть кроме Keycloak»</a>, где сравниваются IAM-решения на Go, я рассмотрел несколько вариантов. Я стал выбирать из двух:</p>
                      <ul>
                       <li>
                        <p><strong>Casdoor</strong>. Этот инструмент меня впечатлил своей простотой. Его можно быстро развернуть и настроить даже без глубоких знаний IAM. Удобный веб-интерфейс, понятная документация и множество готовых интеграций делают его идеальным для моей цели — создать PaaS без лишней разработки.</p></li>
                       <li>
                        <p><strong>Zitadel</strong>. Хотя Zitadel выглядит стильно и современно, настройка оказалась настоящей проблемой. В документации есть примеры as is, но даже после следования им ничего не работало. Я решил, что, если продукт сразу вызывает трудности, лучше пройти мимо.</p></li>
                      </ul>
                      <p>В итоге выбор пал на Casdoor. Особенно радует, что для него можно использовать PostgreSQL в качестве базы данных. Это идеально вписывается в нашу архитектуру, ведь у нас уже есть <strong>CloudNativePG</strong>, развернутый в предыдущей части. Благодаря этому оператору мы можем просто создать новый кластер PostgreSQL для Casdoor, не добавляя новых компонентов и не выходя за рамки бескодового подхода. Теперь наша схема выглядит следующим образом:</p>
                      <figure class="full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/4a0/558/8c0/4a05588c06619099deb19fcaef88c83d.png" alt="Kubernetes PaaS" title="Kubernetes PaaS" width="2112" height="1120" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/4a0/558/8c0/4a05588c06619099deb19fcaef88c83d.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/4a0/558/8c0/4a05588c06619099deb19fcaef88c83d.png 781w" loading="lazy" decode="async">
                       <div>
                        <figcaption>
                         Kubernetes PaaS
                        </figcaption>
                       </div>
                      </figure>
                      <h3>Добавление Casdoor в PaaS</h3>
                      <p>Пора добавить Casdoor в нашу платформу через чарт paas-system, в котором нам надо будет реализовать следующую схему:</p>
                      <figure class="full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/889/611/fce/889611fce5b94c3607b63cb3faea0346.png" alt="Схема работы casdoor" title="Схема работы casdoor" width="3552" height="1952" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/889/611/fce/889611fce5b94c3607b63cb3faea0346.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/889/611/fce/889611fce5b94c3607b63cb3faea0346.png 781w" loading="lazy" decode="async">
                       <div>
                        <figcaption>
                         Схема работы casdoor
                        </figcaption>
                       </div>
                      </figure>
                      <p>Сам процесс делится на два шага:</p>
                      <h3>Шаг 1: Базовые компоненты</h3>
                      <ul>
                       <li>
                        <p>Одним запуском деплоим три компонента:</p>
                        <ul>
                         <li>
                          <p><strong>Gateway</strong>: Разворачиваем Envoy Gateway, который создаёт Deployment и LoadBalancer для Casdoor. Ждём, пока появится внешний IP-адрес.</p>
                          <pre><code class="yaml">apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: "gateway"
spec:
  gatewayClassName: "eg"
  listeners:
    - name: web
      protocol: HTTP
      port: "8000"</code></pre></li>
                         <li>
                          <p><strong>HTTPRoute и Service</strong>. Настраиваем маршрутизацию — HTTPRoute направляет трафик на Service, а Service привязан к подам Casdoor по селектору&nbsp;</p>
                          <pre><code class="yaml">apiVersion: v1
kind: Service
metadata:
  name: "iam-service"
spec:
  ports:
    - name: http
      port: 8000
      targetPort: 8000
  selector:
    labels:
      paas-system/app: iam
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: "casdoor-route"
spec:
  parentRefs:
    - name: "gateway" # Имя gateway
  rules:
    - backendRefs:
        - group: ""
          kind: Service
          name: "iam-service"
          port: 8000
          weight: 1
      matches:
        - path:
            type: PathPrefix
            value: /</code></pre></li>
                         <li>
                          <p><strong>Postgres Cluster</strong>. Используем CloudNativePG для создания кластера PostgreSQL (master и sync replica) с Secret’ом для пароля. CloudNativePG автоматически читает секрет и создает пользователя.</p>
                          <pre><code class="yaml">apiVersion: v1
kind: Secret
metadata:
  name: "iam-db"
type: kubernetes.io/basic-auth
data:
  username: {{ "admin" | b64enc }}
  password: {{ "admin" | b64enc }}
---
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: "iam"
spec:
  instances: 2
  bootstrap:
    initdb:
      database: "iam"
      owner: "admin"
      secret:
        name: "iam-db"
  storage:
    size: "1Gi"
    storageClass: "csi-ceph-ssd-me1" # Эток SC для vkcloud зоны ME1</code></pre></li>
                         <li>
                          <p>Для запуска<strong> </strong>выполняем команду для helmwave и потом ждем, пока у нас появится IP-адрес.</p>
                          <pre><code class="bash">helmwave up -t system --build --kubedog
kubectl get gateway/gateway -n paas-system -o=jsonpath='{.status.addresses[0].value}' -w</code></pre></li>
                        </ul>
                        <h3>Шаг 2: Разворачиваем Casdoor:</h3></li>
                       <li>
                        <p>После получения IP-адреса LoadBalancer’а обновляем .Values.iam.address в локальном файле values.yaml (он под .gitignore). Добавляем в чарт <strong>Secret</strong> с конфигурацией Casdoor (OIDC, подключение к базе) и <strong>Deployment</strong> с селектором paas-system/service: iam. Повторно запускаем деплой — Casdoor запускается и подключается к базе.</p>
                        <pre><code class="yaml">apiVersion: v1
kind: Secret
metadata:
  name: iam-config
type: Opaque
stringData:
  app.conf: |
    appname = casdoor
    httpport = 8000
    runmode = dev
    SessionOn = true
    copyrequestbody = true
    driverName = postgres
    dataSourceName = user=admin password=admin host=iam-rw port=5432 sslmode=disable dbname=iam
    dbName = ian
    tableNamePrefix = iam
    showSql = false
    redisEndpoint = ""
    defaultStorageProvider = ""
    isCloudIntranet = false
    authState = "casdoor"
    socks5Proxy = ""
    verificationCodeTimeout = 10
    initScore = 2000
    logPostOnly = true
    origin = "http://&lt;ip&gt;:8000"
    staticBaseUrl = "http://&lt;ip&gt;:8000"
    enableGzip = true
    inactiveTimeoutMinutes = ""
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: iam-casdoor
  labels:
    paas-system/app: iam
spec:
  replicas: 1
  selector:
    matchLabels:
      paas-system/app: iam
  template:
    metadata:
      labels:
        paas-system/app: iam
    spec:
      containers:
        - name: casdoor-container
          image: casbin/casdoor:latest
          imagePullPolicy: Always
          ports:
            - containerPort: 8000
          volumeMounts:
            - mountPath: /conf/
              name: conf
          env:
            - name: RUNNING_IN_DOCKER
              value: "true"
      volumes:
        - name: conf
          secret:
            secretName: iam-config</code></pre>
                        <h3>Шаг 3: Проверяем доступ</h3></li>
                       <li>
                        <p>Заходим по IP-адресу LoadBalancer’а с портом (например, http://&lt;IP&gt;:&lt;port&gt;), попадаем на страницу логина Casdoor. Вводим пароль по умолчанию (обычно admin/123, как указано в документации Casdoor), и после входа оказываемся на главной странице со статистикой и меню управления пользователями и ролями.</p>
                        <figure class="full-width ">
                         <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/d08/f12/02c/d08f1202c7c24bea044cf259ca8318a8.png" alt="Страница логина Casdoor" title="Страница логина Casdoor" width="2940" height="1614" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/d08/f12/02c/d08f1202c7c24bea044cf259ca8318a8.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/d08/f12/02c/d08f1202c7c24bea044cf259ca8318a8.png 781w" loading="lazy" decode="async">
                         <div>
                          <figcaption>
                           Страница логина Casdoor
                          </figcaption>
                         </div>
                        </figure>
                        <figure class="full-width ">
                         <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/259/1f4/cbb/2591f4cbb6df2f25bcbd905694dda18a.png" alt="Главная страница Casdoor" title="Главная страница Casdoor" width="2940" height="1614" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/259/1f4/cbb/2591f4cbb6df2f25bcbd905694dda18a.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/259/1f4/cbb/2591f4cbb6df2f25bcbd905694dda18a.png 781w" loading="lazy" decode="async">
                         <div>
                          <figcaption>
                           Главная страница Casdoor
                          </figcaption>
                         </div>
                        </figure></li>
                      </ul>
                      <p>Теперь, когда Casdoor работает, мы можем использовать его как OIDC-провайдера для защиты нашего интерфейса. На данный момент Cyclops UI закрыт через basic auth, но с Casdoor мы перейдем на более удобный и безопасный вариант с помощью <strong>oauth2-proxy</strong>.</p>
                      <h3>Настройка Casdoor</h3>
                      <p>Для начала настраиваем Casdoor. В нем есть понятие организаций, и по умолчанию уже существует организация Built-in, которая используется самим Casdoor для внутренних нужд. Мы же создадим новую организацию под названием PaaS, куда будем добавлять всех пользователей нашей платформы. Из-за особенности Casdoor — невозможности делить пользователей между организациями — мы не будем создавать несколько организаций, а вместо этого используем группы для управления доступом. Это удобно, так как oauth2-proxy поддерживает проверку групп.</p>
                      <p>В организации PaaS создаем:</p>
                      <ul>
                       <li>
                        <p>группу <strong>ops</strong> для администраторов PaaS, которые будут иметь полный доступ к платформе;</p></li>
                       <li>
                        <p>отдельную группу для каждого тенанта, чтобы управлять доступом пользователей к их приложениям и ресурсам.</p></li>
                      </ul>
                      <p>Кроме того, для каждого тенанта создаем отдельное приложение в Casdoor с уникальными client_id и client_secret. Это позволяет изолировать доступ и настройки аутентификации для каждого тенанта, обеспечивая дополнительную безопасность и гибкость. Все пользователи добавляются в организацию PaaS, а их роли и права определяются через группы и приложения.</p>
                      <p>Расписывать процесс добавления пользователей, групп и приложений здесь не будем: интерфейс Casdoor интуитивно понятный, все делается через веб-формы и запутаться сложно.</p>
                      <figure class="full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/1d9/5b9/ddf/1d95b9ddf7e41bd398d563b43a20e3ac.png" alt="Casdoor UI" title="Casdoor UI" width="3597" height="1016" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/1d9/5b9/ddf/1d95b9ddf7e41bd398d563b43a20e3ac.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/1d9/5b9/ddf/1d95b9ddf7e41bd398d563b43a20e3ac.png 781w" loading="lazy" decode="async">
                       <div>
                        <figcaption>
                         Casdoor UI
                        </figcaption>
                       </div>
                      </figure>
                      <h4></h4>
                      <h4>Защита Cyclops UI с помощью oauth2-proxy</h4>
                      <p>Теперь, когда Casdoor настроен, мы заменяем basic auth в Cyclops UI на аутентификацию через OIDC с помощью <strong>oauth2-proxy</strong>. Все изменения вносим в наш чарт paas-tenant, работая в namespace paas-tenant-1.</p>
                      <p><strong>Добавляем ConfigMap</strong>. Создаем ConfigMap в namespace paas-tenant-1 с конфигурацией для oauth2-proxy. В нем указываем параметры OIDC: client_id и client_secret приложения из Casdoor (для организации PaaS), URL провайдера (IP-адрес Casdoor), настройки для проверки групп (например, ops или группы тенанта). Также в ConfigMap задаем проксирование запросов к Cyclops UI, указав его адрес и порт. Все прописывается в манифесте чарта.</p>
                      <pre><code class="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: oauth2-proxy-config
data:
  oauth2-proxy.cfg: |
    provider = "oidc"
    provider_display_name = "PaaS"
    
    # Группы должны быть с префиксом организации.
    # Первая группа это админы paas, вторая это пользователи tenant
    allowed_groups = ["paas/ops", "paas/tenant-1"] 

    # Публичный address IAM
    oidc_issuer_url = "http://&lt;ip&gt;:&lt;iam public port&gt;"

    # Параметры приложения
    client_id = "&lt;app client id&gt;"
    client_secret = "&lt;app client secret&gt;"

    # Публичный адрес нашего oauth2-proxy
    redirect_url = "http://&lt;ip&gt;:8000/oauth2/callback"
    
    email_domains = "*"
    cookie_secret = "your-32-char-secret-key1"
    cookie_secure = false # Это позволяет пока отказаться от HTTPs

    # Куда будут запроксированы запросы.
    upstreams = ["http://cyclops-ui:3000"]
    http_address = "0.0.0.0:3000"
    scope = "openid profile email"</code></pre>
                      <ul>
                       <li>
                        <p><strong>Добавляем Deployment</strong>. Деплоим oauth2-proxy через новый <strong>Deployment</strong> в namespace paas-tenant-1. Deployment подхватывает ConfigMap с настройками, включая проксирование к Cyclops UI.</p>
                        <pre><code class="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: oauth2-proxy
  labels:
    app: oauth2-proxy
spec:
  replicas: 1
  selector:
    matchLabels:
      app: oauth2-proxy
  template:
    metadata:
      labels:
        app: oauth2-proxy
    spec:
      containers:
      - name: oauth2-proxy
        image: quay.io/oauth2-proxy/oauth2-proxy:latest
        args:
        - --config=/etc/oauth2-proxy/oauth2-proxy.cfg
        ports:
        - containerPort: 3000
          name: http
        volumeMounts:
        - name: config
          mountPath: /etc/oauth2-proxy
      volumes:
      - name: config
        configMap:
          name: oauth2-proxy-config</code></pre></li>
                       <li>
                        <p><strong>Обновляем Service</strong>. В существующем Service (в namespace paas-tenant-1), который направляет трафик на Cyclops UI, меняем селектор, чтобы он указывал на поды oauth2-proxy. Новый селектор, например app: oauth2-proxy, обеспечивает маршрутизацию через oauth2-proxy. Gateway и HTTPRoute остаются без изменений — трафик идет через Envoy Gateway.</p>
                        <pre><code class="yaml">apiVersion: v1
kind: Service
metadata:
  name: oauth2-proxy
spec:
  selector:
    app: oauth2-proxy
  ports:
  - name: http
    port: 3000
    targetPort: 3000
    protocol: TCP
  type: ClusterIP</code></pre></li>
                      </ul>
                      <p>Теперь oauth2-proxy в paas-tenant-1 проверяет аутентификацию через Casdoor и перенаправляет запросы к Cyclops UI, если пользователь авторизован. Пользователь видит страницу логина Casdoor, а после входа попадает в интерфейс Cyclops UI.</p>
                      <figure class="full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/f23/e2c/082/f23e2c08291395171751c1f4b9088ada.png" alt="Авторизация через oauth2-proxy" title="Авторизация через oauth2-proxy" width="3607" height="1016" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/f23/e2c/082/f23e2c08291395171751c1f4b9088ada.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/f23/e2c/082/f23e2c08291395171751c1f4b9088ada.png 781w" loading="lazy" decode="async">
                       <div>
                        <figcaption>
                         Авторизация через oauth2-proxy
                        </figcaption>
                       </div>
                      </figure>
                      <h4>Добавление общего ресурса — Grafana</h4>
                      <p>Теперь, когда Cyclops UI защищен через oauth2-proxy и Casdoor, мы добавляем первый общий ресурс для нашей PaaS — <strong>Grafana</strong>. Это инструмент для визуализации метрик, доступный всем пользователям платформы. Устанавливаем его в namespace paas-system, так как это общий ресурс. Для хранения данных Grafana используем PostgreSQL, благо у нас уже есть CloudNativePG. Авторизацию настроим через Casdoor.</p>
                      <ul>
                       <li>
                        <p><strong>Установка Grafana Operator</strong>: Через Helmwave деплоим Grafana Operator в namespace paas-operators.</p></li>
                      </ul>
                      <pre><code class="yaml">  - name: "grafana"
    chart:
      name: "oci://ghcr.io/grafana/helm-charts/grafana-operator"
      # Версию надо явно указывать, в противном случае не ставится
      version: "v5.17.0"
    &lt;&lt;: *options-operators
    tags: [grafana]</code></pre>
                      <ul>
                       <li>
                        <p><strong>Создаем PostgreSQL для Grafana</strong>. Используем CloudNativePG для создания нового кластера PostgreSQL в paas-system. Через Helmwave добавляем манифест с <strong>Secret</strong> для пароля и конфигурацией кластера. CloudNativePG сам создает пользователя и базу, как мы делали для Casdoor.</p></li>
                      </ul>
                      <pre><code class="yaml">apiVersion: v1
kind: Secret
metadata:
  name: "grafana-secret"
type: kubernetes.io/basic-auth
data:
  username: {{ "grafna" | b64enc }}
  password: {{ "password"| b64enc }}
---
apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: "grafana-pg"
spec:
  instances: 1
  bootstrap:
    initdb:
      database: "grafana"
      owner: "grafana"
      secret:
        name: "grafana-secret"
  storage:
    size: "1Gi"
    storageClass: "csi-ceph-ssd-me1"</code></pre>
                      <ul>
                       <li>
                        <p><strong>Разворачиваем Grafana</strong>. В чарте через Helmwave добавляем Custom Resource (CR) для Grafana Operator в paas-system. В CR задаем подключение к PostgreSQL (адрес и credentials из CloudNativePG) и параметры OIDC для авторизации через Casdoor: client_id, client_secret и URL провайдера из приложения Casdoor (для организации paas). Также, чтобы появился доступ извне, нужно добавить HTTPRoute (пока будем использовать тот же Gateway, что и для IAM), а оператор сам создаст сервис. Источники данных вроде Prometheus пока не подключаем — добавим их позже.</p></li>
                      </ul>
                      <pre><code class="yaml"># Обновим графана secret
apiVersion: v1
kind: Secret
metadata:
  name: "grafana-secret"
type: kubernetes.io/basic-auth
data:
  ...
  admin_password: {{ "admin" | b64enc }}
  client_id: {{ "&lt;client id&gt;" | b64enc  }}
  client_secret: {{ "&lt;client secret&gt;"| b64enc }}
---
apiVersion: grafana.integreatly.org/v1beta1
kind: Grafana
metadata:
  name: paas
  labels:
    dashboards: "paas"
spec:
  deployment:
    spec:
      replicas: 1
      template:
        spec:
          containers:
            - name: grafana
              env:
                - name: GF_DATABASE_USER
                  valueFrom:
                    secretKeyRef:
                      name: "grafana-secret"
                      key: username
                - name: GF_DATABASE_PASSWORD
                  valueFrom:
                    secretKeyRef:
                      name: "grafana-secret"
                      key: password
                - name: GF_SECURITY_ADMIN_PASSWORD
                  valueFrom:
                    secretKeyRef:
                      name: "grafana-secret"
                      key: admin_password
                - name: GF_AUTH_GENERIC_OAUTH_CLIENT_ID
                  valueFrom:
                    secretKeyRef:
                      name: "grafana-secret"
                      key: client_id
                - name: GF_AUTH_GENERIC_OAUTH_CLIENT_SECRET
                  valueFrom:
                    secretKeyRef:
                      name: "grafana-secret"
                      key: client_secret
  config:
    database:
      type: postgres
      host: grafana-pg-rw
      name: grafana
    security:
      admin_user: admin
    server:
      root_url: "http://&lt;public gateway ip&gt;:&lt;iam public port&gt;/grafana"
      serve_from_sub_path: "true"
      http_port: "3000"
    auth:
      disable_login_form: "true"
    auth.basic:
      enabled: "true"
    auth.generic_oauth:
      enabled: "true"
      auth_url: "http://&lt;iam public ip&gt;:&lt;iam public port&gt;/login/oauth/authorize"
      api_url: "http://&lt;iam service name&gt;:&lt;iam internal port&gt;/api/userinfo"
      token_url: "http://&lt;iam service name&gt;:&lt;iam internal port&gt;/api/login/oauth/access_token"
      signout_redirect_url: "http://&lt;iam public ip&gt;:&lt;iam public port&gt;/api/logout"
      scopes: "openid profile email groups offline_access"
      use_pkce: "true"
      use_refresh_token: "true"
      role_attribute_path: contains(groups[*], 'paas/ops') &amp;&amp; 'GrafanaAdmin' || 'Viewer'
--
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: "grafana-route"
spec:
  parentRefs:
    - name: "iam-gateway"
  rules:
    - backendRefs:
        - group: ""
          kind: Service
          name: "paas-service" # сервис с таким именем добавляет оператор
          port: "3000"
          weight: 1
      matches:
        - path:
            type: PathPrefix
            value: /grafana</code></pre>
                      <ul>
                       <li>
                        <p><strong>Интеграция с Casdoor</strong>. В CR для Grafana включаем oauth2, указав настройки Casdoor. Пользователи перенаправляются на страницу логина Casdoor, а доступ определяется их группами в организации paas (например, ops или группы тенанта).</p>
                        <p>После деплоя Grafana доступна через Envoy Gateway (по существующему или новому HTTPRoute). Пользователи логинятся через Casdoor и получают доступ к дашбордам для просмотра метрик платформы.</p></li>
                      </ul>
                      <figure class="full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/281/102/928/2811029280fef2d89f47fb445ebd7a4f.png" alt="Схема работы grafana" title="Схема работы grafana" width="3552" height="1952" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/281/102/928/2811029280fef2d89f47fb445ebd7a4f.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/281/102/928/2811029280fef2d89f47fb445ebd7a4f.png 781w" loading="lazy" decode="async">
                       <div>
                        <figcaption>
                         Схема работы grafana
                        </figcaption>
                       </div>
                      </figure>
                      <h4>Подключение PostgreSQL как источников данных в Grafana</h4>
                      <p>С Grafana в namespace paas-system и PostgreSQL для Casdoor и самой Grafana, настроенных через CloudNativePG, мы можем использовать эти базы как источники данных для визуализации метрик. Для этого добавим их в Grafana как Custom Resources (CR) GrafanaDatasource.</p>
                      <p><strong>Добавление GrafanaDatasource для PostgreSQL</strong>. Через Helmwave в чарте paas-tenant создаем два CR GrafanaDatasource в namespace paas-system:</p>
                      <ul>
                       <li>
                        <p>Для базы Casdoor: указываем адрес PostgreSQL кластера Casdoor (из CloudNativePG), имя базы, пользователя и пароль (из <strong>Secret’а</strong>, созданного для Casdoor). Тип источника данных — PostgreSQL.</p></li>
                       <li>
                        <p>Для базы Grafana: аналогично указываем параметры PostgreSQL кластера, используемого самой Grafana (адрес, имя базы, пользователь, пароль из соответствующего <strong>Secret’а</strong>).</p></li>
                      </ul>
                      <pre><code class="yaml">apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDatasource
metadata:
  name: grafana-postgres
spec:
  valuesFrom:
    - targetPath: "secureJsonData.password"
      valueFrom:
        secretKeyRef:
          name: "grafana-secret"
          key: "password"
  instanceSelector:
    matchLabels:
      dashboards: "paas"
  datasource:
    name: grafana-postgres
    type: postgres
    url: "grafana-pg-r:5432"
    user: grafana
    access: proxy
    jsonData:
      database: "grafana"
      sslmode: 'disable'
      maxOpenConns: 10
      maxIdleConns: 10
      maxIdleConnsAuto: true
      connMaxLifetime: 14400
      postgresVersion: 1500
      timescaledb: false
    secureJsonData:
      password: "${password}"
---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDatasource
metadata:
  name: iam-postgres
spec:
  valuesFrom:
    - targetPath: "secureJsonData.password"
      valueFrom:
        secretKeyRef:
          name: "iam-db"
          key: "password"
  instanceSelector:
    matchLabels:
      dashboards: "paas"
  datasource:
    name: iam-postgres
    type: postgres
    url: "iam-r:5432"
    user: "admin"
    access: proxy
    jsonData:
      database: "iam"
      sslmode: 'disable'
      maxOpenConns: 10
      maxIdleConns: 10
      maxIdleConnsAuto: true
      connMaxLifetime: 14400
      postgresVersion: 1500
      timescaledb: false
    secureJsonData:
      password: "${password}"</code></pre>
                      <ul>
                       <li>
                        <p><strong>Автоматическое появление в Grafana</strong>. После деплоя CR через Helmwave Grafana Operator подхватывает эти GrafanaDatasource и автоматически добавляет источники данных в Grafana. Они появляются в интерфейсе Grafana, готовые для создания дашбордов.</p></li>
                      </ul>
                      <figure class="full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/4fc/284/544/4fc284544b116d88796189cd1ff8df87.png" alt="Postgres grafana" title="Postgres grafana" width="2940" height="1614" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/4fc/284/544/4fc284544b116d88796189cd1ff8df87.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/4fc/284/544/4fc284544b116d88796189cd1ff8df87.png 781w" loading="lazy" decode="async">
                       <div>
                        <figcaption>
                         Postgres grafana
                        </figcaption>
                       </div>
                      </figure>
                      <p>Теперь пользователи, авторизованные через Casdoor, могут заходить в Grafana и использовать эти источники данных для визуализации метрик, связанных с Casdoor (например, статистика логинов) или самой Grafana (например, внутренние метрики).</p>
                      <blockquote>
                       <p>Как обычно, весь код можно <a href="https://gitverse.ru/emelianovss/paas-kube-article/content/part-02">найти в репозитории.&nbsp;</a></p>
                      </blockquote>
                      <p>В следующей части наш PaaS начнет обрастать глазами и ушами, а также мы сделаем несколько улучшений в самих чартах.</p>
                     </div>
                    </div>
                   </div><!----><!---->
                  </div><!----><!---->
                 </div><!--]--><!---->
                 <div class="tm-article-presenter__meta" data-test-id="article-meta-links">
                  <div class="tm-separated-list tm-article-presenter__meta-list">
                   <span class="tm-separated-list__title">Теги:</span>
                   <ul class="tm-separated-list__list">
                    <!--[-->
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[vk+cloud]" class="tm-tags-list__link"><span>vk cloud</span></a><!--]--></li>
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[paas]" class="tm-tags-list__link"><span>paas</span></a><!--]--></li>
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D0%B1%D0%B0%D0%BB%D0%B0%D0%BD%D1%81%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B0+%D0%BD%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B8]" class="tm-tags-list__link"><span>балансировка нагрузки</span></a><!--]--></li>
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[kubernetes]" class="tm-tags-list__link"><span>kubernetes</span></a><!--]--></li>
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[k8s]" class="tm-tags-list__link"><span>k8s</span></a><!--]--></li>
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[casdoor]" class="tm-tags-list__link"><span>casdoor</span></a><!--]--></li><!--]--><!---->
                   </ul>
                  </div>
                  <div class="tm-separated-list tm-article-presenter__meta-list">
                   <span class="tm-separated-list__title">Хабы:</span>
                   <ul class="tm-separated-list__list">
                    <!--[-->
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/companies/vktech/articles/" class="tm-hubs-list__link"><!--[--><span>Блог компании VK Tech</span><!--]--></a><!--]--></li>
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/companies/vk/articles/" class="tm-hubs-list__link"><!--[--><span>Блог компании VK</span><!--]--></a><!--]--></li>
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/kubernetes/" class="tm-hubs-list__link"><!--[--><span>Kubernetes</span><!--]--></a><!--]--></li>
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/devops/" class="tm-hubs-list__link"><!--[--><span>DevOps</span><!--]--></a><!--]--></li>
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/dev_management/" class="tm-hubs-list__link"><!--[--><span>Управление разработкой</span><!--]--></a><!--]--></li><!--]--><!---->
                   </ul>
                  </div>
                 </div><!----><!--]-->
                </article><!--]-->
               </div><!---->
              </div>
              <div style="" class="tm-article-sticky-panel" data-test-id="article-sticky-panel">
               <div class="tm-data-icons tm-data-icons tm-data-icons_space-big tm-article-sticky-panel__icons" data-test-id="article-stats-icons">
                <div class="article-rating tm-data-icons__item" data-v-86aec4a7>
                 <div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-article votes-switcher" title="Всего голосов 14: ↑14 и ↓0" data-v-86aec4a7>
                  <button class="tm-votes-lever__button" data-test-id="votes-lever-upvote-button" title="Нравится" type="button">
                   <svg class="tm-svg-img tm-votes-lever__icon" height="24" width="24">
                    <title>
                     Нравится
                    </title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-vote"></use>
                   </svg></button>
                  <div class="tm-votes-lever__score tm-votes-lever__score_appearance-article tm-votes-lever__score">
                   <!--[--><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter_positive tm-votes-lever__score-counter" data-test-id="votes-score-counter">+16</span></span><!--]-->
                  </div>
                  <button class="tm-votes-lever__button" data-test-id="votes-lever-downvote-button" title="Не нравится" type="button">
                   <svg class="tm-svg-img tm-votes-lever__icon tm-votes-lever__icon_arrow-down" height="24" width="24">
                    <title>
                     Не нравится
                    </title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-vote"></use>
                   </svg></button>
                 </div><!--teleport start--><!--teleport end--><!---->
                </div><!----><!---->
                <button class="bookmarks-button tm-data-icons__item" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon">
                  <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
                   <title>
                    Добавить в закладки
                   </title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use>
                  </svg></span><span class="bookmarks-button__counter" title="Количество пользователей, добавивших публикацию в закладки">15</span></button>
                <div class="tm-sharing tm-data-icons__item" title="Поделиться">
                 <button class="tm-sharing__button" type="button">
                  <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="tm-sharing__icon">
                   <path fill="currentColor" d="M13.8 13.8V18l7.2-6.6L13.8 5v3.9C5 8.9 3 18.6 3 18.6c2.5-4.4 6-4.8 10.8-4.8z"></path>
                  </svg></button><!--teleport start--><!--teleport end-->
                </div>
                <div class="tm-article-comments-counter-link tm-data-icons__item" title="Читать комментарии">
                 <a href="/ru/companies/vktech/articles/890386/comments/" class="tm-article-comments-counter-link__link" data-test-id="counter-comments"><!--[-->
                  <svg class="tm-svg-img tm-article-comments-counter-link__icon" height="24" width="24">
                   <title>
                    Комментарии
                   </title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-comments"></use>
                  </svg><span class="tm-article-comments-counter-link__value">2</span><!--]--></a><!---->
                </div><!--[--><!--[--><!--[--><!----><!--]--><!--]--><!--]--><!--teleport start--><!--teleport end--><!---->
               </div>
              </div>
             </div><!--[--><!--]-->
             <div class="tm-article-presenter__footer">
              <!--[--><!--[-->
              <div class="tm-article-blocks">
               <!----><!--[-->
               <section class="tm-block tm-block tm-block_spacing-bottom">
                <!----><!--[-->
                <div class="tm-block__body tm-block__body tm-block__body_variant-balanced">
                 <!--[-->
                 <div class="tm-article-author" data-test-id="article-author-info" data-async-called="true">
                  <!--[--><!--[-->
                  <div class="tm-article-author__company">
                   <div class="tm-article-author__company-card">
                    <div class="tm-company-snippet">
                     <a href="/ru/companies/vktech/profile/" class="tm-company-snippet__logo-link">
                      <div class="tm-entity-image">
                       <img alt="" class="tm-entity-image__pic" height="40" src="//habrastorage.org/getpro/habr/company/ebb/972/15d/ebb97215d4403e1dbc2b3d190ec8239c.png" width="40">
                      </div></a>
                     <div class="tm-company-snippet__info">
                      <a href="/ru/companies/vktech/profile/" class="tm-company-snippet__title" data-test-id="company-title"><span>VK Tech</span></a>
                      <div class="tm-company-snippet__description">
                       VK Tech — российский разработчик корпоративного ПО
                      </div>
                     </div>
                    </div>
                    <div class="tm-article-author__buttons">
                     <!----><!---->
                    </div>
                   </div>
                   <div class="tm-article-author__company-contacts">
                    <!--[--><a class="tm-article-author__contact" href="https://tech.vk.com/" rel="noopener" target="_blank">Сайт</a><a class="tm-article-author__contact" href="https://telegram.me/vk_digital_tech" rel="noopener" target="_blank">Telegram</a><a class="tm-article-author__contact" href="https://telegram.me/vk_cloud_news" rel="noopener" target="_blank">Telegram</a><a class="tm-article-author__contact" href="https://telegram.me/k8s_vk" rel="noopener" target="_blank">Telegram</a><a class="tm-article-author__contact" href="https://telegram.me/sterodata" rel="noopener" target="_blank">Telegram</a><a class="tm-article-author__contact" href="https://telegram.me/tarantool_news" rel="noopener" target="_blank">Telegram</a><a class="tm-article-author__contact" href="https://telegram.me/vk_workspace_official" rel="noopener" target="_blank">Telegram</a><a class="tm-article-author__contact" href="https://telegram.me/vkhrtek" rel="noopener" target="_blank">Telegram</a><!--]-->
                   </div>
                   <div class="tm-article-author__separator"></div>
                  </div><!--]--><!--]-->
                  <div class="tm-user-card tm-user-card tm-user-card_variant-article tm-article-author__user-card" data-async-called="true">
                   <div class="tm-user-card__info-container">
                    <div class="tm-user-card__header">
                     <div class="tm-user-card__header-data">
                      <a href="/ru/users/totaki/" class="tm-user-card__userpic tm-user-card__userpic_size-40">
                       <div class="tm-entity-image">
                        <img alt="" class="tm-entity-image__pic" src="//habrastorage.org/getpro/habr/avatars/bea/5a3/53b/bea5a353bafb1de0b5a9a64bb35763aa.jpeg">
                       </div></a>
                      <div class="tm-user-card__meta">
                       <div class="tm-counter-container karma" title=" 5 голосов " data-v-f7c0e283>
                        <div class="tm-counter-container__header">
                         <!--[-->
                         <div class="karma-display positive" data-v-f7c0e283 data-v-7635202e>
                          5
                         </div><!----><!--]-->
                        </div>
                        <div class="tm-counter-container__footer">
                         <!--[-->
                         <div class="karma-text" data-v-f7c0e283>
                          Карма
                         </div><!--teleport start--><!--teleport end--><!--]-->
                        </div>
                       </div>
                       <div class="tm-counter-container" title="Рейтинг пользователя">
                        <div class="tm-counter-container__header">
                         <!--[--><!--[--><!--]-->
                         <div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating">
                          <!---->
                          <div class="tm-votes-lever__score tm-votes-lever__score_appearance-rating tm-votes-lever__score">
                           <!--[--><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter_rating tm-votes-lever__score-counter" data-test-id="votes-score-counter">19</span></span><!--]-->
                          </div><!---->
                         </div><!--]-->
                        </div>
                        <div class="tm-counter-container__footer">
                         <!--[--><span class="tm-rating__text tm-rating__text">Рейтинг</span><!--]-->
                        </div>
                       </div>
                      </div>
                     </div>
                    </div>
                    <div class="tm-user-card__info tm-user-card__info_variant-article tm-user-card__info">
                     <div class="tm-user-card__title tm-user-card__title_variant-article tm-user-card__title">
                      <span class="tm-user-card__name tm-user-card__name_variant-article tm-user-card__name">Сергей Емельянов</span><a href="/ru/users/totaki/" class="tm-user-card__nickname tm-user-card__nickname tm-user-card__nickname_variant-article"> @totaki</a><!---->
                     </div>
                     <p class="tm-user-card__short-info tm-user-card__short-info_variant-article tm-user-card__short-info" data-test-id="user-card-speciality">Go Developer</p>
                    </div>
                   </div><!---->
                   <div class="tm-user-card__buttons tm-user-card__buttons_variant-article tm-user-card__buttons">
                    <!---->
                    <div class="tm-user-card__button">
                     <div class="tm-button-follow tm-user-card__button-follow">
                      <!---->
                      <button class="tm-button-follow__button tm-button-follow__button_big" data-test-id="follow-button" type="button">Подписаться</button>
                     </div>
                    </div><!---->
                    <div class="tm-user-card__button tm-user-card__button_write" data-test-id="user-card-conversations">
                     <svg class="tm-svg-img tm-user-card__button-icon" height="16" width="16">
                      <title>
                       Отправить сообщение
                      </title><use xlink:href="/img/megazord-v28.7909a852..svg#mail"></use>
                     </svg>
                    </div><!---->
                   </div><!---->
                  </div>
                  <div class="tm-article-author__user-contacts" data-test-id="author-contacts">
                   <!----><!----><!---->
                  </div>
                 </div><!--]-->
                </div><!--]--><!---->
               </section><!----><!--[--><!--]--><!--]-->
               <div class="tm-article-blocks__comments">
                <div id="publication-comments" class="tm-article-page-comments">
                 <div>
                  <!--[-->
                  <div class="tm-article-comments-counter-link tm-article-comments-counter-button">
                   <a href="/ru/companies/vktech/articles/890386/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style" data-test-id="counter-comments"><!--[-->
                    <svg class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted" height="24" width="24">
                     <title>
                      Комментарии
                     </title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-comments"></use>
                    </svg><span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted"> Комментарии 2 </span><!--]--></a><!---->
                  </div><!--]-->
                 </div>
                </div>
               </div><!--[--><!--[--><!--]-->
               <section class="tm-block tm-block tm-block_spacing-bottom">
                <header class="tm-block__header tm-block__header tm-block__header_variant-borderless">
                 <div class="tm-block__header-container">
                  <h2 class="tm-block__title tm-block__title tm-block__title_variant-large">Публикации</h2><!--[--><!--]-->
                 </div><!---->
                </header><!--[-->
                <div class="tm-block__body tm-block__body tm-block__body_variant-condensed-slim">
                 <!--[--><!--[-->
                 <div class="tm-tabs tm-tabs">
                  <div class="">
                   <!--[--><span class="tm-tabs__tab-item">
                    <button class="tm-tabs__tab-link tm-tabs__tab-link_active tm-tabs__tab-link_slim tm-tabs__tab-link">Лучшие за сутки</button></span><span class="tm-tabs__tab-item">
                    <button class="tm-tabs__tab-link tm-tabs__tab-link_slim tm-tabs__tab-link">Похожие</button></span><!--]-->
                  </div><!---->
                 </div>
                 <div class="similar-and-daily__tab-view">
                  <div class="placeholder-wrapper">
                   <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---->
                   <div class="tm-placeholder-article-cards">
                    <!--[-->
                    <div class="tm-placeholder-article-card">
                     <div class="tm-placeholder__user">
                      <div class="tm-placeholder__user-pic loads"></div>
                      <div class="tm-placeholder__user-date loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__title">
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__icons tm-placeholder__counters">
                      <!--[-->
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div><!--]-->
                     </div>
                    </div>
                    <div class="tm-placeholder-article-card">
                     <div class="tm-placeholder__user">
                      <div class="tm-placeholder__user-pic loads"></div>
                      <div class="tm-placeholder__user-date loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__title">
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__icons tm-placeholder__counters">
                      <!--[-->
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div><!--]-->
                     </div>
                    </div>
                    <div class="tm-placeholder-article-card">
                     <div class="tm-placeholder__user">
                      <div class="tm-placeholder__user-pic loads"></div>
                      <div class="tm-placeholder__user-date loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__title">
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__icons tm-placeholder__counters">
                      <!--[-->
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div><!--]-->
                     </div>
                    </div>
                    <div class="tm-placeholder-article-card">
                     <div class="tm-placeholder__user">
                      <div class="tm-placeholder__user-pic loads"></div>
                      <div class="tm-placeholder__user-date loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__title">
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__icons tm-placeholder__counters">
                      <!--[-->
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div><!--]-->
                     </div>
                    </div>
                    <div class="tm-placeholder-article-card">
                     <div class="tm-placeholder__user">
                      <div class="tm-placeholder__user-pic loads"></div>
                      <div class="tm-placeholder__user-date loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__title">
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__icons tm-placeholder__counters">
                      <!--[-->
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div><!--]-->
                     </div>
                    </div><!--]-->
                   </div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---->
                  </div><!---->
                 </div><!--]--><!--]-->
                </div><!--]--><!---->
               </section><!--[--><!--]--><!----><!--[--><!--]--><!--]-->
              </div><!--]--><!--]-->
             </div>
            </div><!--]--><!--]-->
           </div>
          </div>
          <div class="tm-page__sidebar">
           <!--[-->
           <div class="tm-layout-sidebar">
            <div class="tm-layout-sidebar__placeholder_initial"></div>
            <div class="tm-sexy-sidebar_initial tm-sexy-sidebar" style="margin-top:0px;">
             <!--[--><!--]--><!---->
             <div class="tm-layout-sidebar__placeholder_initial"></div><!--[-->
             <section class="tm-block tm-block tm-block_spacing-bottom">
              <header class="tm-block__header tm-block__header">
               <div class="tm-block__header-container">
                <h2 class="tm-block__title tm-block__title">Информация</h2><!--[--><!--]-->
               </div><!---->
              </header><!--[-->
              <div class="tm-block__body tm-block__body">
               <!--[-->
               <div class="tm-company-basic-info">
                <dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap">
                 <dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap tm-description-list__title">
                  Сайт
                 </dt>
                 <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap tm-description-list__body">
                  <!--[--><a class="tm-company-basic-info__link" href="https://tech.vk.com/" target="_blank">tech.vk.com</a><!--]-->
                 </dd>
                </dl>
                <dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap">
                 <dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap tm-description-list__title">
                  Дата регистрации
                 </dt>
                 <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap tm-description-list__body">
                  <!--[--><time datetime="2025-02-24T07:48:25.000Z" title="2025-02-24, 10:48">24 февраля </time><!--]-->
                 </dd>
                </dl><!---->
                <dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap">
                 <dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap tm-description-list__title">
                  Численность
                 </dt>
                 <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap tm-description-list__body">
                  <!--[-->1 001–5 000 человек<!--]-->
                 </dd>
                </dl>
                <dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap">
                 <dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap tm-description-list__title">
                  Местоположение
                 </dt>
                 <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap tm-description-list__body">
                  <!--[-->Россия<!--]-->
                 </dd>
                </dl>
                <dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap">
                 <dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap tm-description-list__title">
                  Представитель
                 </dt>
                 <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap tm-description-list__body">
                  <!--[--><a href="/ru/users/levashove/" class="tm-company-basic-info__link">Евгений Левашов</a><!--]-->
                 </dd>
                </dl>
               </div><!--]-->
              </div><!--]--><!---->
             </section>
             <div class="tm-company-widgets">
              <!--[--><!--]-->
             </div><!----><!----><!--]--><!---->
            </div>
           </div><!--]-->
          </div>
         </div><!----><!--]-->
        </div>
       </div>
      </main><!---->
     </div>
     <div class="tm-footer-menu">
      <div class="tm-page-width">
       <!--[-->
       <div class="tm-footer-menu__container">
        <!--[-->
        <div class="tm-footer-menu__block">
         <p class="tm-footer-menu__block-title">Ваш аккаунт</p>
         <div class="tm-footer-menu__block-content">
          <ul class="tm-footer-menu__list">
           <!--[-->
           <li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/companies/vktech/articles/890386/&amp;hl=ru" rel="nofollow" target="_self">Войти</a></li>
           <li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/companies/vktech/articles/890386/&amp;hl=ru" rel="nofollow" target="_self">Регистрация</a></li><!--]-->
          </ul>
         </div>
        </div>
        <div class="tm-footer-menu__block">
         <p class="tm-footer-menu__block-title">Разделы</p>
         <div class="tm-footer-menu__block-content">
          <ul class="tm-footer-menu__list">
           <!--[-->
           <li class="tm-footer-menu__list-item"><a href="/ru/articles/" class="footer-menu__item-link">Статьи</a></li>
           <li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">Новости</a></li>
           <li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">Хабы</a></li>
           <li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">Компании</a></li>
           <li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">Авторы</a></li>
           <li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">Песочница</a></li><!--]-->
          </ul>
         </div>
        </div>
        <div class="tm-footer-menu__block">
         <p class="tm-footer-menu__block-title">Информация</p>
         <div class="tm-footer-menu__block-content">
          <ul class="tm-footer-menu__list">
           <!--[-->
           <li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">Устройство сайта</a></li>
           <li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">Для авторов</a></li>
           <li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">Для компаний</a></li>
           <li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">Документы</a></li>
           <li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement/?hl=ru_RU" target="_blank">Соглашение</a></li>
           <li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/?hl=ru_RU" target="_blank">Конфиденциальность</a></li><!--]-->
          </ul>
         </div>
        </div>
        <div class="tm-footer-menu__block">
         <p class="tm-footer-menu__block-title">Услуги</p>
         <div class="tm-footer-menu__block-content">
          <ul class="tm-footer-menu__list">
           <!--[-->
           <li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/corporate-blogs/" target="_blank">Корпоративный блог</a></li>
           <li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/advertising/" target="_blank">Медийная реклама</a></li>
           <li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/native-special/" target="_blank">Нативные проекты</a></li>
           <li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/education-programs/" target="_blank">Образовательные программы</a></li>
           <li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/hello-startup/" target="_blank">Стартапам</a></li><!--]-->
          </ul>
         </div>
        </div><!--]-->
       </div><!--]-->
      </div>
     </div>
     <div class="tm-footer">
      <div class="tm-page-width">
       <!--[-->
       <div class="tm-footer__container">
        <!---->
        <div class="tm-footer__social">
         <!--[--><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank">
          <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
           <title>
            Facebook
           </title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-facebook"></use>
          </svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank">
          <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
           <title>
            Twitter
           </title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-twitter"></use>
          </svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank">
          <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
           <title>
            VK
           </title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-vk"></use>
          </svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank">
          <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
           <title>
            Telegram
           </title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-telegram"></use>
          </svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank">
          <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
           <title>
            Youtube
           </title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-youtube"></use>
          </svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://dzen.ru/habr" rel="nofollow noopener noreferrer" target="_blank">
          <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
           <title>
            Яндекс Дзен
           </title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-dzen"></use>
          </svg></a><!--]-->
        </div><!--teleport start--><!--teleport end-->
        <button class="tm-footer__link"><!----> Настройка языка</button><a href="/ru/feedback/" class="tm-footer__link">Техническая поддержка</a>
        <div class="tm-footer-copyright">
         <span class="tm-copyright"><span class="tm-copyright__years">© 2006–2025, </span><span class="tm-copyright__name"><a class="tm-copyright__link" href="https://company.habr.com/" rel="noopener" target="_blank">Habr</a></span></span>
        </div>
       </div><!--]-->
      </div>
     </div><!----><!--]-->
    </div><!---->
   </div>
   <script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"890386":{"id":"890386","timePublished":"2025-05-06T09:12:17+00:00","isCorporative":true,"lang":"ru","titleHtml":"Kubernetes как PaaS: максимум возможностей без разработки. Часть 2","leadData":{"textHtml":"\u003Cp\u003EЭто вторая часть серии статей, где мы шаг за шагом строим PaaS на базе Kubernetes без написания кода. Напомню, для чего мы это делаем: наша цель — выжать максимум из современных технологий и экосистемы Kubernetes, чтобы создать PaaS-решение, которое упростит жизнь разработчикам. Мы хотим, чтобы приложения и сервисы разворачивались быстро, удобно и без глубокого погружения в инфраструктуру.\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F205\u002Fdf3\u002F456\u002F205df345626a6122cc9eac69284d2479.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F205\u002Fdf3\u002F456\u002F205df345626a6122cc9eac69284d2479.png","fit":"cover","positionY":53,"positionX":0}},"editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"402482","alias":"totaki","fullname":"Сергей Емельянов","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fbea\u002F5a3\u002F53b\u002Fbea5a353bafb1de0b5a9a64bb35763aa.jpeg","speciality":"Go Developer","scoreStats":{"score":5,"votesCount":5},"rating":19,"relatedData":null,"contacts":[],"authorContacts":[],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"donationsMethod":null,"isInBlacklist":null,"careerProfile":null},"statistics":{"commentsCount":2,"favoritesCount":15,"readingCount":596,"score":16,"votesCount":14,"votesCountPlus":14,"votesCountMinus":0},"hubs":[{"id":"23638","alias":"vktech","type":"corporative","title":"Блог компании VK Tech","titleHtml":"Блог компании VK Tech","isProfiled":false,"relatedData":null},{"id":"4992","alias":"vk","type":"corporative","title":"Блог компании VK","titleHtml":"Блог компании VK","isProfiled":false,"relatedData":null},{"id":"22196","alias":"kubernetes","type":"collective","title":"Kubernetes","titleHtml":"Kubernetes","isProfiled":true,"relatedData":null},{"id":"20788","alias":"devops","type":"collective","title":"DevOps","titleHtml":"DevOps","isProfiled":true,"relatedData":null},{"id":"19583","alias":"dev_management","type":"collective","title":"Управление разработкой","titleHtml":"Управление разработкой","isProfiled":true,"relatedData":null}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"},{"id":"3","alias":"management","title":"Менеджмент","titleHtml":"Менеджмент"},{"id":"6","alias":"admin","title":"Администрирование","titleHtml":"Администрирование"}],"relatedData":{"vote":null,"unreadCommentsCount":0,"bookmarked":false,"canComment":false,"canEdit":false,"canViewVotes":false,"votePlus":{"canVote":false,"isChargeEnough":false,"isKarmaEnough":false,"isVotingOver":false,"isPublicationLimitEnough":false},"voteMinus":{"canVote":false,"isChargeEnough":false,"isKarmaEnough":false,"isVotingOver":false,"isPublicationLimitEnough":false},"canModerateComments":false,"trackerSubscribed":false,"emailSubscribed":false},"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fccc\u002F0a6\u002Fc3f\u002Fccc0a6c3f77954981682afe0c26fdb91.png\" width=\"860\" height=\"574\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fccc\u002F0a6\u002Fc3f\u002Fccc0a6c3f77954981682afe0c26fdb91.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fccc\u002F0a6\u002Fc3f\u002Fccc0a6c3f77954981682afe0c26fdb91.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EЭто вторая часть серии статей, где мы шаг за шагом строим PaaS на базе Kubernetes без написания кода. Наша цель — выжать максимум из современных технологий и экосистемы Kubernetes, чтобы создать PaaS-решение, которое упростит жизнь разработчикам. Мы хотим, чтобы приложения и сервисы разворачивались быстро, удобно и без глубокого погружения в инфраструктуру. Перейдем сразу к делу.\u003C\u002Fp\u003E\u003Ch3\u003EЧто уже сделано\u003C\u002Fh3\u003E\u003Cp\u003EВ\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fvktech\u002Farticles\u002F895954\u002F\"\u003E предыдущей части\u003C\u002Fa\u003E мы сделали подготовительные шаги:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EДобавили Gateway\u003C\u002Fstrong\u003E: подключили Envoy Gateway для управления входящим трафиком. Это позволило легко заводить внешний трафик в кластер через Kubernetes Gateway API, без сложных настроек.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EВыбрали первый оператор — CloudNativePG\u003C\u002Fstrong\u003E: развернули оператор PostgreSQL, который автоматизирует создание и управление кластерами баз данных, обеспечивая высокую доступность и простоту использования.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EДобавили Cyclops UI\u003C\u002Fstrong\u003E: интегрировали веб-интерфейс Cyclops, чтобы пользователи PaaS могли удобно заводить свои приложения. Через формы в UI они задают параметры, не вникая в YAML или CLI.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EДобавили Template для создания PostgreSQL\u003C\u002Fstrong\u003E: создали шаблон в Cyclops UI, который позволяет пользователям одним кликом разворачивать экземпляры PostgreSQL, используя CloudNativePG под капотом.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EЭти шаги заложили фундамент для нашей PaaS. Пора идти дальше — к централизованному управлению.\u003C\u002Fp\u003E\u003Ch3\u003EЕдиный IAM для централизованного управления\u003C\u002Fh3\u003E\u003Cp\u003EНа нашей платформе будет доступно множество разнообразных приложений, и ручное управление пользователями и доступом быстро превратится в кошмар, поэтому мы добавим единый IAM. Он решает эту проблему, позволяя централизованно управлять пользователями и их правами из одного места — будь то доступ к интерфейсу, сервисам или данным.\u003C\u002Fp\u003E\u003Cp\u003EНа данный момент существует один хорошо зарекомендовавший себя стандарт — \u003Cstrong\u003EOIDC (OpenID Connect)\u003C\u002Fstrong\u003E. Он построен поверх OAuth 2.0 и широко используется для аутентификации и авторизации. Единственный его минус — многие бесплатные решения предлагают интеграции с OIDC только в платных Enterprise-версиях. Впрочем, нам это пока не помеха: мы можем выбрать инструмент, который поддерживает OIDC из коробки и вписывается в наш бескодовый подход. \u003C\u002Fp\u003E\u003Cp\u003EСо стандартом определились, теперь перейдем к выбору конкретного решения. При выборе системы авторизации и аутентификации (IAM) для нашей PaaS-платформы я сразу подумал о Keycloak, но он оказался слишком громоздким для моих задач. Его сложная архитектура и код на Java не вписываются в мой стек, где я активно использую Go, — мне не хотелось нагружать проект этим «багажом».\u003C\u002Fp\u003E\u003Cp\u003EВдохновившись статьей \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F720490\u002F\"\u003E«Выбираем IAM в 2023, или Что есть кроме Keycloak»\u003C\u002Fa\u003E, где сравниваются IAM-решения на Go, я рассмотрел несколько вариантов. Я стал выбирать из двух:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003ECasdoor\u003C\u002Fstrong\u003E. Этот инструмент меня впечатлил своей простотой. Его можно быстро развернуть и настроить даже без глубоких знаний IAM. Удобный веб-интерфейс, понятная документация и множество готовых интеграций делают его идеальным для моей цели — создать PaaS без лишней разработки.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EZitadel\u003C\u002Fstrong\u003E. Хотя Zitadel выглядит стильно и современно, настройка оказалась настоящей проблемой. В документации есть примеры as is, но даже после следования им ничего не работало. Я решил, что, если продукт сразу вызывает трудности, лучше пройти мимо.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EВ итоге выбор пал на Casdoor. Особенно радует, что для него можно использовать PostgreSQL в качестве базы данных. Это идеально вписывается в нашу архитектуру, ведь у нас уже есть \u003Cstrong\u003ECloudNativePG\u003C\u002Fstrong\u003E, развернутый в предыдущей части. Благодаря этому оператору мы можем просто создать новый кластер PostgreSQL для Casdoor, не добавляя новых компонентов и не выходя за рамки бескодового подхода. Теперь наша схема выглядит следующим образом:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4a0\u002F558\u002F8c0\u002F4a05588c06619099deb19fcaef88c83d.png\" alt=\"Kubernetes PaaS\" title=\"Kubernetes PaaS\" width=\"2112\" height=\"1120\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4a0\u002F558\u002F8c0\u002F4a05588c06619099deb19fcaef88c83d.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4a0\u002F558\u002F8c0\u002F4a05588c06619099deb19fcaef88c83d.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cdiv\u003E\u003Cfigcaption\u003EKubernetes PaaS\u003C\u002Ffigcaption\u003E\u003C\u002Fdiv\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003EДобавление Casdoor в PaaS\u003C\u002Fh3\u003E\u003Cp\u003EПора добавить Casdoor в нашу платформу через чарт paas-system, в котором нам надо будет реализовать следующую схему:\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F889\u002F611\u002Ffce\u002F889611fce5b94c3607b63cb3faea0346.png\" alt=\"Схема работы casdoor\" title=\"Схема работы casdoor\" width=\"3552\" height=\"1952\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F889\u002F611\u002Ffce\u002F889611fce5b94c3607b63cb3faea0346.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F889\u002F611\u002Ffce\u002F889611fce5b94c3607b63cb3faea0346.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cdiv\u003E\u003Cfigcaption\u003EСхема работы casdoor\u003C\u002Ffigcaption\u003E\u003C\u002Fdiv\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EСам процесс делится на два шага:\u003C\u002Fp\u003E\u003Ch3\u003EШаг 1: Базовые компоненты\u003C\u002Fh3\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EОдним запуском деплоим три компонента: \u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EGateway\u003C\u002Fstrong\u003E: Разворачиваем Envoy Gateway, который создаёт Deployment и LoadBalancer для Casdoor. Ждём, пока появится внешний IP-адрес.\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"yaml\"\u003EapiVersion: gateway.networking.k8s.io\u002Fv1\nkind: Gateway\nmetadata:\n  name: \"gateway\"\nspec:\n  gatewayClassName: \"eg\"\n  listeners:\n    - name: web\n      protocol: HTTP\n      port: \"8000\"\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EHTTPRoute и Service\u003C\u002Fstrong\u003E. Настраиваем маршрутизацию — HTTPRoute направляет трафик на Service, а Service привязан к подам Casdoor по селектору \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"yaml\"\u003EapiVersion: v1\nkind: Service\nmetadata:\n  name: \"iam-service\"\nspec:\n  ports:\n    - name: http\n      port: 8000\n      targetPort: 8000\n  selector:\n    labels:\n      paas-system\u002Fapp: iam\n---\napiVersion: gateway.networking.k8s.io\u002Fv1\nkind: HTTPRoute\nmetadata:\n  name: \"casdoor-route\"\nspec:\n  parentRefs:\n    - name: \"gateway\" # Имя gateway\n  rules:\n    - backendRefs:\n        - group: \"\"\n          kind: Service\n          name: \"iam-service\"\n          port: 8000\n          weight: 1\n      matches:\n        - path:\n            type: PathPrefix\n            value: \u002F\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EPostgres Cluster\u003C\u002Fstrong\u003E. Используем CloudNativePG для создания кластера PostgreSQL (master и sync replica) с Secret’ом для пароля. CloudNativePG автоматически читает секрет и создает пользователя.  \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"yaml\"\u003EapiVersion: v1\nkind: Secret\nmetadata:\n  name: \"iam-db\"\ntype: kubernetes.io\u002Fbasic-auth\ndata:\n  username: {{ \"admin\" | b64enc }}\n  password: {{ \"admin\" | b64enc }}\n---\napiVersion: postgresql.cnpg.io\u002Fv1\nkind: Cluster\nmetadata:\n  name: \"iam\"\nspec:\n  instances: 2\n  bootstrap:\n    initdb:\n      database: \"iam\"\n      owner: \"admin\"\n      secret:\n        name: \"iam-db\"\n  storage:\n    size: \"1Gi\"\n    storageClass: \"csi-ceph-ssd-me1\" # Эток SC для vkcloud зоны ME1\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EДля запуска\u003Cstrong\u003E \u003C\u002Fstrong\u003Eвыполняем команду для helmwave и потом ждем, пока у нас появится IP-адрес. \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003Ehelmwave up -t system --build --kubedog\nkubectl get gateway\u002Fgateway -n paas-system -o=jsonpath='{.status.addresses[0].value}' -w\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Ch3\u003EШаг 2: Разворачиваем Casdoor: \u003C\u002Fh3\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПосле получения IP-адреса LoadBalancer’а обновляем .Values.iam.address в локальном файле values.yaml (он под .gitignore). Добавляем в чарт \u003Cstrong\u003ESecret\u003C\u002Fstrong\u003E с конфигурацией Casdoor (OIDC, подключение к базе) и \u003Cstrong\u003EDeployment\u003C\u002Fstrong\u003E с селектором paas-system\u002Fservice: iam. Повторно запускаем деплой — Casdoor запускается и подключается к базе.  \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"yaml\"\u003EapiVersion: v1\nkind: Secret\nmetadata:\n  name: iam-config\ntype: Opaque\nstringData:\n  app.conf: |\n    appname = casdoor\n    httpport = 8000\n    runmode = dev\n    SessionOn = true\n    copyrequestbody = true\n    driverName = postgres\n    dataSourceName = user=admin password=admin host=iam-rw port=5432 sslmode=disable dbname=iam\n    dbName = ian\n    tableNamePrefix = iam\n    showSql = false\n    redisEndpoint = \"\"\n    defaultStorageProvider = \"\"\n    isCloudIntranet = false\n    authState = \"casdoor\"\n    socks5Proxy = \"\"\n    verificationCodeTimeout = 10\n    initScore = 2000\n    logPostOnly = true\n    origin = \"http:\u002F\u002F&lt;ip&gt;:8000\"\n    staticBaseUrl = \"http:\u002F\u002F&lt;ip&gt;:8000\"\n    enableGzip = true\n    inactiveTimeoutMinutes = \"\"\n---\napiVersion: apps\u002Fv1\nkind: Deployment\nmetadata:\n  name: iam-casdoor\n  labels:\n    paas-system\u002Fapp: iam\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      paas-system\u002Fapp: iam\n  template:\n    metadata:\n      labels:\n        paas-system\u002Fapp: iam\n    spec:\n      containers:\n        - name: casdoor-container\n          image: casbin\u002Fcasdoor:latest\n          imagePullPolicy: Always\n          ports:\n            - containerPort: 8000\n          volumeMounts:\n            - mountPath: \u002Fconf\u002F\n              name: conf\n          env:\n            - name: RUNNING_IN_DOCKER\n              value: \"true\"\n      volumes:\n        - name: conf\n          secret:\n            secretName: iam-config\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Ch3\u003EШаг 3: Проверяем доступ \u003C\u002Fh3\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EЗаходим по IP-адресу LoadBalancer’а с портом (например, http:\u002F\u002F&lt;IP&gt;:&lt;port&gt;), попадаем на страницу логина Casdoor. Вводим пароль по умолчанию (обычно admin\u002F123, как указано в документации Casdoor), и после входа оказываемся на главной странице со статистикой и меню управления пользователями и ролями.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd08\u002Ff12\u002F02c\u002Fd08f1202c7c24bea044cf259ca8318a8.png\" alt=\"Страница логина Casdoor\" title=\"Страница логина Casdoor\" width=\"2940\" height=\"1614\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd08\u002Ff12\u002F02c\u002Fd08f1202c7c24bea044cf259ca8318a8.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd08\u002Ff12\u002F02c\u002Fd08f1202c7c24bea044cf259ca8318a8.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cdiv\u003E\u003Cfigcaption\u003EСтраница логина Casdoor\u003C\u002Ffigcaption\u003E\u003C\u002Fdiv\u003E\u003C\u002Ffigure\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F259\u002F1f4\u002Fcbb\u002F2591f4cbb6df2f25bcbd905694dda18a.png\" alt=\"Главная страница Casdoor\" title=\"Главная страница Casdoor\" width=\"2940\" height=\"1614\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F259\u002F1f4\u002Fcbb\u002F2591f4cbb6df2f25bcbd905694dda18a.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F259\u002F1f4\u002Fcbb\u002F2591f4cbb6df2f25bcbd905694dda18a.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cdiv\u003E\u003Cfigcaption\u003EГлавная страница Casdoor\u003C\u002Ffigcaption\u003E\u003C\u002Fdiv\u003E\u003C\u002Ffigure\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EТеперь, когда Casdoor работает, мы можем использовать его как OIDC-провайдера для защиты нашего интерфейса. На данный момент Cyclops UI закрыт через basic auth, но с Casdoor мы перейдем на более удобный и безопасный вариант с помощью \u003Cstrong\u003Eoauth2-proxy\u003C\u002Fstrong\u003E.  \u003C\u002Fp\u003E\u003Ch3\u003EНастройка Casdoor\u003C\u002Fh3\u003E\u003Cp\u003EДля начала настраиваем Casdoor. В нем есть понятие организаций, и по умолчанию уже существует организация Built-in, которая используется самим Casdoor для внутренних нужд. Мы же создадим новую организацию под названием PaaS, куда будем добавлять всех пользователей нашей платформы. Из-за особенности Casdoor — невозможности делить пользователей между организациями — мы не будем создавать несколько организаций, а вместо этого используем группы для управления доступом. Это удобно, так как oauth2-proxy поддерживает проверку групп.\u003C\u002Fp\u003E\u003Cp\u003EВ организации PaaS создаем:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eгруппу \u003Cstrong\u003Eops\u003C\u002Fstrong\u003E для администраторов PaaS, которые будут иметь полный доступ к платформе;\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eотдельную группу для каждого тенанта, чтобы управлять доступом пользователей к их приложениям и ресурсам.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EКроме того, для каждого тенанта создаем отдельное приложение в Casdoor с уникальными client_id и client_secret. Это позволяет изолировать доступ и настройки аутентификации для каждого тенанта, обеспечивая дополнительную безопасность и гибкость. Все пользователи добавляются в организацию PaaS, а их роли и права определяются через группы и приложения.\u003C\u002Fp\u003E\u003Cp\u003EРасписывать процесс добавления пользователей, групп и приложений здесь не будем: интерфейс Casdoor интуитивно понятный, все делается через веб-формы и запутаться сложно.\u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1d9\u002F5b9\u002Fddf\u002F1d95b9ddf7e41bd398d563b43a20e3ac.png\" alt=\"Casdoor UI\" title=\"Casdoor UI\" width=\"3597\" height=\"1016\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1d9\u002F5b9\u002Fddf\u002F1d95b9ddf7e41bd398d563b43a20e3ac.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1d9\u002F5b9\u002Fddf\u002F1d95b9ddf7e41bd398d563b43a20e3ac.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cdiv\u003E\u003Cfigcaption\u003ECasdoor UI\u003C\u002Ffigcaption\u003E\u003C\u002Fdiv\u003E\u003C\u002Ffigure\u003E\u003Ch4\u003E\u003C\u002Fh4\u003E\u003Ch4\u003EЗащита Cyclops UI с помощью oauth2-proxy\u003C\u002Fh4\u003E\u003Cp\u003EТеперь, когда Casdoor настроен, мы заменяем basic auth в Cyclops UI на аутентификацию через OIDC с помощью \u003Cstrong\u003Eoauth2-proxy\u003C\u002Fstrong\u003E. Все изменения вносим в наш чарт paas-tenant, работая в namespace paas-tenant-1.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EДобавляем ConfigMap\u003C\u002Fstrong\u003E. Создаем ConfigMap в namespace paas-tenant-1 с конфигурацией для oauth2-proxy. В нем указываем параметры OIDC: client_id и client_secret приложения из Casdoor (для организации PaaS), URL провайдера (IP-адрес Casdoor), настройки для проверки групп (например, ops или группы тенанта). Также в ConfigMap задаем проксирование запросов к Cyclops UI, указав его адрес и порт. Все прописывается в манифесте чарта. \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"yaml\"\u003EapiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: oauth2-proxy-config\ndata:\n  oauth2-proxy.cfg: |\n    provider = \"oidc\"\n    provider_display_name = \"PaaS\"\n    \n    # Группы должны быть с префиксом организации.\n    # Первая группа это админы paas, вторая это пользователи tenant\n    allowed_groups = [\"paas\u002Fops\", \"paas\u002Ftenant-1\"] \n\n    # Публичный address IAM\n    oidc_issuer_url = \"http:\u002F\u002F&lt;ip&gt;:&lt;iam public port&gt;\"\n\n    # Параметры приложения\n    client_id = \"&lt;app client id&gt;\"\n    client_secret = \"&lt;app client secret&gt;\"\n\n    # Публичный адрес нашего oauth2-proxy\n    redirect_url = \"http:\u002F\u002F&lt;ip&gt;:8000\u002Foauth2\u002Fcallback\"\n    \n    email_domains = \"*\"\n    cookie_secret = \"your-32-char-secret-key1\"\n    cookie_secure = false # Это позволяет пока отказаться от HTTPs\n\n    # Куда будут запроксированы запросы.\n    upstreams = [\"http:\u002F\u002Fcyclops-ui:3000\"]\n    http_address = \"0.0.0.0:3000\"\n    scope = \"openid profile email\"\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EДобавляем Deployment\u003C\u002Fstrong\u003E. Деплоим oauth2-proxy через новый \u003Cstrong\u003EDeployment\u003C\u002Fstrong\u003E в namespace paas-tenant-1. Deployment подхватывает ConfigMap с настройками, включая проксирование к Cyclops UI.  \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"yaml\"\u003EapiVersion: apps\u002Fv1\nkind: Deployment\nmetadata:\n  name: oauth2-proxy\n  labels:\n    app: oauth2-proxy\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: oauth2-proxy\n  template:\n    metadata:\n      labels:\n        app: oauth2-proxy\n    spec:\n      containers:\n      - name: oauth2-proxy\n        image: quay.io\u002Foauth2-proxy\u002Foauth2-proxy:latest\n        args:\n        - --config=\u002Fetc\u002Foauth2-proxy\u002Foauth2-proxy.cfg\n        ports:\n        - containerPort: 3000\n          name: http\n        volumeMounts:\n        - name: config\n          mountPath: \u002Fetc\u002Foauth2-proxy\n      volumes:\n      - name: config\n        configMap:\n          name: oauth2-proxy-config\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EОбновляем Service\u003C\u002Fstrong\u003E. В существующем Service (в namespace paas-tenant-1), который направляет трафик на Cyclops UI, меняем селектор, чтобы он указывал на поды oauth2-proxy. Новый селектор, например app: oauth2-proxy, обеспечивает маршрутизацию через oauth2-proxy. Gateway и HTTPRoute остаются без изменений — трафик идет через Envoy Gateway.  \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode class=\"yaml\"\u003EapiVersion: v1\nkind: Service\nmetadata:\n  name: oauth2-proxy\nspec:\n  selector:\n    app: oauth2-proxy\n  ports:\n  - name: http\n    port: 3000\n    targetPort: 3000\n    protocol: TCP\n  type: ClusterIP\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EТеперь oauth2-proxy в paas-tenant-1 проверяет аутентификацию через Casdoor и перенаправляет запросы к Cyclops UI, если пользователь авторизован. Пользователь видит страницу логина Casdoor, а после входа попадает в интерфейс Cyclops UI.  \u003C\u002Fp\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff23\u002Fe2c\u002F082\u002Ff23e2c08291395171751c1f4b9088ada.png\" alt=\"Авторизация через oauth2-proxy\" title=\"Авторизация через oauth2-proxy\" width=\"3607\" height=\"1016\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff23\u002Fe2c\u002F082\u002Ff23e2c08291395171751c1f4b9088ada.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff23\u002Fe2c\u002F082\u002Ff23e2c08291395171751c1f4b9088ada.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cdiv\u003E\u003Cfigcaption\u003EАвторизация через oauth2-proxy\u003C\u002Ffigcaption\u003E\u003C\u002Fdiv\u003E\u003C\u002Ffigure\u003E\u003Ch4\u003EДобавление общего ресурса — Grafana\u003C\u002Fh4\u003E\u003Cp\u003EТеперь, когда Cyclops UI защищен через oauth2-proxy и Casdoor, мы добавляем первый общий ресурс для нашей PaaS — \u003Cstrong\u003EGrafana\u003C\u002Fstrong\u003E. Это инструмент для визуализации метрик, доступный всем пользователям платформы. Устанавливаем его в namespace paas-system, так как это общий ресурс. Для хранения данных Grafana используем PostgreSQL, благо у нас уже есть CloudNativePG. Авторизацию настроим через Casdoor.\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EУстановка Grafana Operator\u003C\u002Fstrong\u003E: Через Helmwave деплоим Grafana Operator в namespace paas-operators. \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cpre\u003E\u003Ccode class=\"yaml\"\u003E  - name: \"grafana\"\n    chart:\n      name: \"oci:\u002F\u002Fghcr.io\u002Fgrafana\u002Fhelm-charts\u002Fgrafana-operator\"\n      # Версию надо явно указывать, в противном случае не ставится\n      version: \"v5.17.0\"\n    &lt;&lt;: *options-operators\n    tags: [grafana]\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EСоздаем PostgreSQL для Grafana\u003C\u002Fstrong\u003E. Используем CloudNativePG для создания нового кластера PostgreSQL в paas-system. Через Helmwave добавляем манифест с \u003Cstrong\u003ESecret\u003C\u002Fstrong\u003E для пароля и конфигурацией кластера. CloudNativePG сам создает пользователя и базу, как мы делали для Casdoor.  \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cpre\u003E\u003Ccode class=\"yaml\"\u003EapiVersion: v1\nkind: Secret\nmetadata:\n  name: \"grafana-secret\"\ntype: kubernetes.io\u002Fbasic-auth\ndata:\n  username: {{ \"grafna\" | b64enc }}\n  password: {{ \"password\"| b64enc }}\n---\napiVersion: postgresql.cnpg.io\u002Fv1\nkind: Cluster\nmetadata:\n  name: \"grafana-pg\"\nspec:\n  instances: 1\n  bootstrap:\n    initdb:\n      database: \"grafana\"\n      owner: \"grafana\"\n      secret:\n        name: \"grafana-secret\"\n  storage:\n    size: \"1Gi\"\n    storageClass: \"csi-ceph-ssd-me1\"\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EРазворачиваем Grafana\u003C\u002Fstrong\u003E. В чарте через Helmwave добавляем Custom Resource (CR) для Grafana Operator в paas-system. В CR задаем подключение к PostgreSQL (адрес и credentials из CloudNativePG) и параметры OIDC для авторизации через Casdoor: client_id, client_secret и URL провайдера из приложения Casdoor (для организации paas). Также, чтобы появился доступ извне, нужно добавить HTTPRoute (пока будем использовать тот же Gateway, что и для IAM), а оператор сам создаст сервис. Источники данных вроде Prometheus пока не подключаем — добавим их позже.  \u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cpre\u003E\u003Ccode class=\"yaml\"\u003E# Обновим графана secret\napiVersion: v1\nkind: Secret\nmetadata:\n  name: \"grafana-secret\"\ntype: kubernetes.io\u002Fbasic-auth\ndata:\n  ...\n  admin_password: {{ \"admin\" | b64enc }}\n  client_id: {{ \"&lt;client id&gt;\" | b64enc  }}\n  client_secret: {{ \"&lt;client secret&gt;\"| b64enc }}\n---\napiVersion: grafana.integreatly.org\u002Fv1beta1\nkind: Grafana\nmetadata:\n  name: paas\n  labels:\n    dashboards: \"paas\"\nspec:\n  deployment:\n    spec:\n      replicas: 1\n      template:\n        spec:\n          containers:\n            - name: grafana\n              env:\n                - name: GF_DATABASE_USER\n                  valueFrom:\n                    secretKeyRef:\n                      name: \"grafana-secret\"\n                      key: username\n                - name: GF_DATABASE_PASSWORD\n                  valueFrom:\n                    secretKeyRef:\n                      name: \"grafana-secret\"\n                      key: password\n                - name: GF_SECURITY_ADMIN_PASSWORD\n                  valueFrom:\n                    secretKeyRef:\n                      name: \"grafana-secret\"\n                      key: admin_password\n                - name: GF_AUTH_GENERIC_OAUTH_CLIENT_ID\n                  valueFrom:\n                    secretKeyRef:\n                      name: \"grafana-secret\"\n                      key: client_id\n                - name: GF_AUTH_GENERIC_OAUTH_CLIENT_SECRET\n                  valueFrom:\n                    secretKeyRef:\n                      name: \"grafana-secret\"\n                      key: client_secret\n  config:\n    database:\n      type: postgres\n      host: grafana-pg-rw\n      name: grafana\n    security:\n      admin_user: admin\n    server:\n      root_url: \"http:\u002F\u002F&lt;public gateway ip&gt;:&lt;iam public port&gt;\u002Fgrafana\"\n      serve_from_sub_path: \"true\"\n      http_port: \"3000\"\n    auth:\n      disable_login_form: \"true\"\n    auth.basic:\n      enabled: \"true\"\n    auth.generic_oauth:\n      enabled: \"true\"\n      auth_url: \"http:\u002F\u002F&lt;iam public ip&gt;:&lt;iam public port&gt;\u002Flogin\u002Foauth\u002Fauthorize\"\n      api_url: \"http:\u002F\u002F&lt;iam service name&gt;:&lt;iam internal port&gt;\u002Fapi\u002Fuserinfo\"\n      token_url: \"http:\u002F\u002F&lt;iam service name&gt;:&lt;iam internal port&gt;\u002Fapi\u002Flogin\u002Foauth\u002Faccess_token\"\n      signout_redirect_url: \"http:\u002F\u002F&lt;iam public ip&gt;:&lt;iam public port&gt;\u002Fapi\u002Flogout\"\n      scopes: \"openid profile email groups offline_access\"\n      use_pkce: \"true\"\n      use_refresh_token: \"true\"\n      role_attribute_path: contains(groups[*], 'paas\u002Fops') &amp;&amp; 'GrafanaAdmin' || 'Viewer'\n--\napiVersion: gateway.networking.k8s.io\u002Fv1\nkind: HTTPRoute\nmetadata:\n  name: \"grafana-route\"\nspec:\n  parentRefs:\n    - name: \"iam-gateway\"\n  rules:\n    - backendRefs:\n        - group: \"\"\n          kind: Service\n          name: \"paas-service\" # сервис с таким именем добавляет оператор\n          port: \"3000\"\n          weight: 1\n      matches:\n        - path:\n            type: PathPrefix\n            value: \u002Fgrafana\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EИнтеграция с Casdoor\u003C\u002Fstrong\u003E. В CR для Grafana включаем oauth2, указав настройки Casdoor. Пользователи перенаправляются на страницу логина Casdoor, а доступ определяется их группами в организации paas (например, ops или группы тенанта).\u003C\u002Fp\u003E\u003Cp\u003EПосле деплоя Grafana доступна через Envoy Gateway (по существующему или новому HTTPRoute). Пользователи логинятся через Casdoor и получают доступ к дашбордам для просмотра метрик платформы.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F281\u002F102\u002F928\u002F2811029280fef2d89f47fb445ebd7a4f.png\" alt=\"Схема работы grafana\" title=\"Схема работы grafana\" width=\"3552\" height=\"1952\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F281\u002F102\u002F928\u002F2811029280fef2d89f47fb445ebd7a4f.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F281\u002F102\u002F928\u002F2811029280fef2d89f47fb445ebd7a4f.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cdiv\u003E\u003Cfigcaption\u003EСхема работы grafana\u003C\u002Ffigcaption\u003E\u003C\u002Fdiv\u003E\u003C\u002Ffigure\u003E\u003Ch4\u003EПодключение PostgreSQL как источников данных в Grafana\u003C\u002Fh4\u003E\u003Cp\u003EС Grafana в namespace paas-system и PostgreSQL для Casdoor и самой Grafana, настроенных через CloudNativePG, мы можем использовать эти базы как источники данных для визуализации метрик. Для этого добавим их в Grafana как Custom Resources (CR) GrafanaDatasource.\u003C\u002Fp\u003E\u003Cp\u003E\u003Cstrong\u003EДобавление GrafanaDatasource для PostgreSQL\u003C\u002Fstrong\u003E. Через Helmwave в чарте paas-tenant создаем два CR GrafanaDatasource в namespace paas-system:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EДля базы Casdoor: указываем адрес PostgreSQL кластера Casdoor (из CloudNativePG), имя базы, пользователя и пароль (из \u003Cstrong\u003ESecret’а\u003C\u002Fstrong\u003E, созданного для Casdoor). Тип источника данных — PostgreSQL.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EДля базы Grafana: аналогично указываем параметры PostgreSQL кластера, используемого самой Grafana (адрес, имя базы, пользователь, пароль из соответствующего \u003Cstrong\u003ESecret’а\u003C\u002Fstrong\u003E).\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cpre\u003E\u003Ccode class=\"yaml\"\u003EapiVersion: grafana.integreatly.org\u002Fv1beta1\nkind: GrafanaDatasource\nmetadata:\n  name: grafana-postgres\nspec:\n  valuesFrom:\n    - targetPath: \"secureJsonData.password\"\n      valueFrom:\n        secretKeyRef:\n          name: \"grafana-secret\"\n          key: \"password\"\n  instanceSelector:\n    matchLabels:\n      dashboards: \"paas\"\n  datasource:\n    name: grafana-postgres\n    type: postgres\n    url: \"grafana-pg-r:5432\"\n    user: grafana\n    access: proxy\n    jsonData:\n      database: \"grafana\"\n      sslmode: 'disable'\n      maxOpenConns: 10\n      maxIdleConns: 10\n      maxIdleConnsAuto: true\n      connMaxLifetime: 14400\n      postgresVersion: 1500\n      timescaledb: false\n    secureJsonData:\n      password: \"${password}\"\n---\napiVersion: grafana.integreatly.org\u002Fv1beta1\nkind: GrafanaDatasource\nmetadata:\n  name: iam-postgres\nspec:\n  valuesFrom:\n    - targetPath: \"secureJsonData.password\"\n      valueFrom:\n        secretKeyRef:\n          name: \"iam-db\"\n          key: \"password\"\n  instanceSelector:\n    matchLabels:\n      dashboards: \"paas\"\n  datasource:\n    name: iam-postgres\n    type: postgres\n    url: \"iam-r:5432\"\n    user: \"admin\"\n    access: proxy\n    jsonData:\n      database: \"iam\"\n      sslmode: 'disable'\n      maxOpenConns: 10\n      maxIdleConns: 10\n      maxIdleConnsAuto: true\n      connMaxLifetime: 14400\n      postgresVersion: 1500\n      timescaledb: false\n    secureJsonData:\n      password: \"${password}\"\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EАвтоматическое появление в Grafana\u003C\u002Fstrong\u003E. После деплоя CR через Helmwave Grafana Operator подхватывает эти GrafanaDatasource и автоматически добавляет источники данных в Grafana. Они появляются в интерфейсе Grafana, готовые для создания дашбордов.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4fc\u002F284\u002F544\u002F4fc284544b116d88796189cd1ff8df87.png\" alt=\"Postgres grafana\" title=\"Postgres grafana\" width=\"2940\" height=\"1614\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4fc\u002F284\u002F544\u002F4fc284544b116d88796189cd1ff8df87.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4fc\u002F284\u002F544\u002F4fc284544b116d88796189cd1ff8df87.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003Cdiv\u003E\u003Cfigcaption\u003EPostgres grafana\u003C\u002Ffigcaption\u003E\u003C\u002Fdiv\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EТеперь пользователи, авторизованные через Casdoor, могут заходить в Grafana и использовать эти источники данных для визуализации метрик, связанных с Casdoor (например, статистика логинов) или самой Grafana (например, внутренние метрики).\u003C\u002Fp\u003E\u003Cblockquote\u003E\u003Cp\u003EКак обычно, весь код можно \u003Ca href=\"https:\u002F\u002Fgitverse.ru\u002Femelianovss\u002Fpaas-kube-article\u002Fcontent\u002Fpart-02\"\u003Eнайти в репозитории. \u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fblockquote\u003E\u003Cp\u003EВ следующей части наш PaaS начнет обрастать глазами и ушами, а также мы сделаем несколько улучшений в самих чартах. \u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"vk cloud"},{"titleHtml":"paas"},{"titleHtml":"балансировка нагрузки"},{"titleHtml":"kubernetes"},{"titleHtml":"k8s"},{"titleHtml":"casdoor"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F205\u002Fdf3\u002F456\u002F205df345626a6122cc9eac69284d2479.png","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F205\u002Fdf3\u002F456\u002F205df345626a6122cc9eac69284d2479.png","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompanies\\\u002Fvktech\\\u002Farticles\\\u002F890386\\\u002F\"},\"headline\":\"Kubernetes как PaaS: максимум возможностей без разработки. Часть 2\",\"datePublished\":\"2025-05-06T12:12:17+03:00\",\"dateModified\":\"2025-05-07T00:28:25+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Сергей Емельянов\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Это вторая часть серии статей, где мы шаг за шагом строим PaaS на базе Kubernetes без написания кода. Наша цель &mdash; выжать максимум из современных технологий и эко...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompanies\\\u002Fvktech\\\u002Farticles\\\u002F890386\\\u002F#post-content-body\",\"about\":[\"c_vktech\",\"c_vk\",\"h_kubernetes\",\"h_devops\",\"h_dev_management\",\"f_develop\",\"f_management\",\"f_admin\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F890386\\\u002F393dde17c2046261a3a7c42e5d64cea7\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fccc\\\u002F0a6\\\u002Fc3f\\\u002Fccc0a6c3f77954981682afe0c26fdb91.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F4a0\\\u002F558\\\u002F8c0\\\u002F4a05588c06619099deb19fcaef88c83d.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F889\\\u002F611\\\u002Ffce\\\u002F889611fce5b94c3607b63cb3faea0346.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fd08\\\u002Ff12\\\u002F02c\\\u002Fd08f1202c7c24bea044cf259ca8318a8.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F259\\\u002F1f4\\\u002Fcbb\\\u002F2591f4cbb6df2f25bcbd905694dda18a.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F1d9\\\u002F5b9\\\u002Fddf\\\u002F1d95b9ddf7e41bd398d563b43a20e3ac.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Ff23\\\u002Fe2c\\\u002F082\\\u002Ff23e2c08291395171751c1f4b9088ada.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F281\\\u002F102\\\u002F928\\\u002F2811029280fef2d89f47fb445ebd7a4f.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F4fc\\\u002F284\\\u002F544\\\u002F4fc284544b116d88796189cd1ff8df87.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F205\\\u002Fdf3\\\u002F456\\\u002F205df345626a6122cc9eac69284d2479.png\"]}","metaDescription":"Это вторая часть серии статей, где мы шаг за шагом строим PaaS на базе Kubernetes без написания кода. Наша цель — выжать максимум из современных технологий и экосистемы Kubernetes, чтобы создать...","mainImageUrl":null,"amp":true,"customTrackerLinks":[]},"polls":[],"commentsEnabled":{"status":true,"reason":null},"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"hasPinnedComments":false,"format":null,"banner":null,"multiwidget":null,"multiwidgetUuid":null,"readingTime":12,"complexity":null,"isEditorial":false,"allowedFeatures":{"isTestTargetAllow":false}}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"postReasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"viewedPosts":[],"myFeedFilter":{"complexity":"all","score":"all","types":["articles","posts","news"]},"myFeedIsApplyFilters":false,"myFeedIsForce":false,"karma":{"userReasonsList":null}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":""},"comments":{"articleComments":{},"articlePinnedComments":{},"searchCommentsResults":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":"","idempotenceKey":""}},"companies":{"companyRefs":{"vktech":{"alias":"vktech","imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcompany\u002Febb\u002F972\u002F15d\u002Febb97215d4403e1dbc2b3d190ec8239c.png","titleHtml":"VK Tech","descriptionHtml":"VK Tech — российский разработчик корпоративного ПО","relatedData":null,"statistics":{"subscribersCount":107,"rating":361.28,"invest":null,"postsCount":15,"threadsCount":6,"newsCount":8,"vacanciesCount":0,"employeesCount":30,"careerRating":null},"foundationDate":null,"location":{"city":{"id":"447159","title":"Москва"},"region":{"id":"1885","title":"Москва и Московская обл."},"country":{"id":"168","title":"Россия"}},"siteUrl":"https:\u002F\u002Ftech.vk.com\u002F","staffNumber":"1 001–5 000 человек","registrationDate":"2025-02-24T07:48:25+00:00","representativeUser":{"alias":"levashove","fullname":"Евгений Левашов"},"contacts":[{"title":"Сайт","url":"https:\u002F\u002Ftech.vk.com\u002F","siteTitle":"VK Tech","favicon":"https:\u002F\u002Ftech.vk.com\u002Fimages\u002Ffavicon-vk\u002Fandroid-icon-192x192.png"},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Fvk_digital_tech","siteTitle":"Telegram: View @vk_digital_tech","favicon":"https:\u002F\u002Ftelegram.org\u002Fimg\u002Fwebsite_icon.svg?4"},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Fvk_cloud_news","siteTitle":"Telegram: View @vk_cloud_news","favicon":"https:\u002F\u002Ftelegram.org\u002Fimg\u002Fwebsite_icon.svg?4"},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Fk8s_vk","siteTitle":"Telegram: View @k8s_vk","favicon":"https:\u002F\u002Ftelegram.org\u002Fimg\u002Fwebsite_icon.svg?4"},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Fsterodata","siteTitle":"Telegram: View @sterodata","favicon":"https:\u002F\u002Ftelegram.org\u002Fimg\u002Fwebsite_icon.svg?4"},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Ftarantool_news","siteTitle":"Telegram: View @tarantool_news","favicon":"https:\u002F\u002Ftelegram.org\u002Fimg\u002Fwebsite_icon.svg?4"},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Fvk_workspace_official","siteTitle":"Telegram: View @vk_workspace_official","favicon":"https:\u002F\u002Ftelegram.org\u002Fimg\u002Fwebsite_icon.svg?4"},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Fvkhrtek","siteTitle":"Telegram: View @vkhrtek","favicon":"https:\u002F\u002Ftelegram.org\u002Fimg\u002Fwebsite_icon.svg?4"}],"settings":{"analyticsSettings":[{"type":"ym","trackingId":"10008373"}],"branding":{"imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fbranding\u002Fa71\u002F21c\u002F838\u002Fa7121c83810d7b34e282c9af838b8af2.png","linkUrl":"https:\u002F\u002Fcloud.vk.com\u002Fevents\u002Fvk-cloud-conf-25\u002F?utm_source=habr&utm_medium=referral&utm_campaign=???&utm_content=banner","pixelUrl":null,"uuid":"0195ee0a-0197-703a-8403-af3dc61b8354"},"status":"active","isStartup":false,"hasActivePolls":false,"shouldShowHabrAds":false},"metadata":{"titleHtml":"VK Tech, Москва - VK Tech — российский разработчик корпоративного ПО","title":"VK Tech, Москва - VK Tech — российский разработчик корпоративного ПО","keywords":["vk cloud","vk tech","вебинар","kubernetes","инфраструктура","мультиоблако","go"],"descriptionHtml":"15 статей от авторов компании VK Tech","description":"15 статей от авторов компании VK Tech"},"aDeskSettings":null,"careerAlias":null,"schoolAlias":null}},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"multiwidgets":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"multiwidgetLoading":false,"vacancies":{},"companiesGalleries":{},"companiesBanners":{},"companiesLandingVacancies":{},"companiesTechnologies":{},"workplaceInfo":null},"companyAdmin":{"companyInfo":null,"companyInfoLoading":false,"faqArticles":null,"brandingPreviewImageUrl":null,"jivoStatus":0,"adminNotifications":null,"availableInvitesCount":{}},"companyAdd":{"currentStep":"","stepsData":{},"uncompletedSteps":[],"isStepLoading":true,"isStepCommitting":false,"isInitialized":false,"agreementContent":""},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"pagesCount":0},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":true},"fixedBanner":{"isArticleStickyPanelVisible":false,"isArticleStickyPanelAtTheBottom":false,"isFixedBannerVisible":false,"isStickyPanelIconsHidden":false},"flows":{"updates":{}},"global":{"isPwa":false,"device":"desktop","isHabrCom":true,"requestId":"aae629b2cdcad818c98b0c66df218a4d"},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"welcomePage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"query":{},"pathname":"\u002Fru\u002Fcompanies\u002Fvktech\u002Farticles\u002F890386\u002F","path":"\u002Fru\u002Fcompanies\u002Fvktech\u002Farticles\u002F890386\u002F","href":"\u002Fru\u002Fcompanies\u002Fvktech\u002Farticles\u002F890386\u002F"}},"me":{"user":null,"uuid":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null,"userUpdates":{"feeds":{"newPostsCount":null,"newThreadsCount":null,"newNewsCount":null,"newCount":null},"conversationUnreadCount":0},"features":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"onboarding":{"currentStep":null,"stepsData":{},"stepsErrors":{},"completedSteps":[],"isStepCommitting":false,"isCommitDisabled":true},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"promoData":{"isLoading":false,"hasLoaded":false,"featurer":null,"megaposts":null,"promoLinks":null,"promoPosts":null,"sticker":null},"publicationStatistics":{"statsInfo":{},"statsFunnels":{},"statsGraph":{},"defaultSuggest":{},"suggest":{},"timeTracker":{},"isTrackingActivity":false,"isUserActive":true,"otherPublicationStats":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"search":{"searchQueryError":null},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":true,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"stories":{"stories":null},"technotext":{"years":[],"technotextDocForNominees":null,"technotextDocForWinners":null,"technotextInfo":{},"technotextInfoLoading":false,"technotextWinners":{},"technotextWinnersLoading":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"userVotes":{"karmaVotesList":[],"karmaVotesPagesCount":null,"karmaVotesListLoading":false,"commentsVotesList":[],"commentsVotesPagesCount":null,"commentsVotesListLoading":false,"postsVotesList":[],"postsVotesPagesCount":null,"postsVotesListLoading":false,"userVotesList":[],"userVotesPagesCount":null,"userVotesListLoading":false},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"userSpecialization":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"notificationsLoading":false,"notificationsList":[],"notificationsPageCount":0,"pendingMarkNotificationsRead":[],"publicationsLoading":true,"publicationsList":[],"publicationsPageCount":0,"pendingDeletePublications":false,"pendingMarkPublicationsRead":false},"events":{"eventRefs":{},"eventIds":[],"pagesCount":0,"categories":[],"cities":[],"actualEvents":null,"currentEvent":null,"eventsFilter":{"city":"all","timeStarted":null,"timeEnded":null}},"wysiwyg":{"WYSIWYGRulesRefs":null},"refs":{"specializationRefs":[]},"hint":{"hints":{}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
   <script src="https://assets.habr.com/habr-web/js/chunk-vendors.978df117.js" defer></script>
   <script src="https://assets.habr.com/habr-web/js/app.58b8c457.js" defer></script>
  </div>
  <div id="overlays">
   <!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor-->
  </div>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S28W1WC23F"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    </script>
  <script type="text/javascript">
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

  </script>
  <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
 </body>
</html>