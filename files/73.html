<!doctype html>
<html lang="ru">
 <head>
  <title>Zabbix. Мониторинг больших рассылок / Хабр</title>
  <meta property="fb:app_id" content="444736788986613">
  <meta property="fb:pages" content="472597926099084">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@habr_com">
  <meta property="og:site_name" content="Хабр">
  <link href="https://habr.com/ru/rss/post/907232/?fl=ru" type="application/rss+xml" title rel="alternate" name="rss">
  <link href="https://habr.com/ru/companies/cloud4y/articles/907232/" rel="canonical" data-hid="e3fa780">
  <link rel="image_src" href="https://habrastorage.org/getpro/habr/upload_files/856/2db/ace/8562dbace864d371b0ccfd0c83b7912c.png" data-hid="2a79c45">
  <link rel="amphtml" href="https://habr.com/ru/amp/publications/907232/">
  <meta property="og:title" content="Zabbix. Мониторинг больших рассылок">
  <meta name="twitter:title" content="Zabbix. Мониторинг больших рассылок">
  <meta name="aiturec:title" content="Zabbix. Мониторинг больших рассылок">
  <meta name="description" content="Привет! На связи Виктор Лысенко из Cloud4Y. Сегодня хочу рассказать о массовых рассылках и способах борьбы с&nbsp;ними. Кейс исключительно практический: возникла необходимость предупреждать и...">
  <meta itemprop="description" content="Привет! На связи Виктор Лысенко из Cloud4Y. Сегодня хочу рассказать о массовых рассылках и способах борьбы с&nbsp;ними. Кейс исключительно практический: возникла необходимость предупреждать и...">
  <meta property="og:description" content="Привет! На связи Виктор Лысенко из Cloud4Y. Сегодня хочу рассказать о массовых рассылках и способах борьбы с&nbsp;ними. Кейс исключительно практический: возникла необходимость предупреждать и...">
  <meta name="twitter:description" content="Привет! На связи Виктор Лысенко из Cloud4Y. Сегодня хочу рассказать о массовых рассылках и способах борьбы с&nbsp;ними. Кейс исключительно практический: возникла необходимость предупреждать и...">
  <meta property="aiturec:description" content="Привет! На связи Виктор Лысенко из Cloud4Y. Сегодня хочу рассказать о массовых рассылках и способах борьбы с&nbsp;ними. Кейс исключительно практический: возникла необходимость предупреждать и...">
  <meta itemprop="image" content="https://habrastorage.org/getpro/habr/upload_files/856/2db/ace/8562dbace864d371b0ccfd0c83b7912c.png">
  <meta property="og:image" content="https://habrastorage.org/getpro/habr/upload_files/856/2db/ace/8562dbace864d371b0ccfd0c83b7912c.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="aiturec:image" content="https://habrastorage.org/getpro/habr/upload_files/856/2db/ace/8562dbace864d371b0ccfd0c83b7912c.png">
  <meta name="twitter:image" content="https://habrastorage.org/getpro/habr/upload_files/856/2db/ace/8562dbace864d371b0ccfd0c83b7912c.png">
  <meta property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/856/2db/ace/8562dbace864d371b0ccfd0c83b7912c.png?format=vk">
  <meta property="vk:image" content="https://habrastorage.org/getpro/habr/upload_files/856/2db/ace/8562dbace864d371b0ccfd0c83b7912c.png?format=vk">
  <meta property="aiturec:item_id" content="907232">
  <meta property="aiturec:datetime" content="2025-05-06T07:13:08.000Z">
  <meta content="https://habr.com/ru/companies/cloud4y/articles/907232/" property="og:url">
  <meta property="og:type" content="article">
  <meta property="og:locale" content="ru_RU">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta name="keywords" content="антиспам, Zabbix, Exchange, рассылки">
  <script type="application/ld+json" data-hid="1e0f0a2">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/companies\/cloud4y\/articles\/907232\/"},"headline":"Zabbix. Мониторинг больших рассылок","datePublished":"2025-05-06T10:13:08+03:00","dateModified":"2025-05-07T00:56:07+03:00","author":{"@type":"Person","name":"Cloud4Y"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Привет! На связи Виктор Лысенко из Cloud4Y. Сегодня хочу рассказать о массовых рассылках и способах борьбы с&nbsp;ними. Кейс исключительно практический: возникла необ...","url":"https:\/\/habr.com\/ru\/companies\/cloud4y\/articles\/907232\/#post-content-body","about":["c_cloud4y","h_sys_admin","h_it-infrastructure","h_spam","h_cloud_services","f_admin"],"image":["https:\/\/habr.com\/share\/publication\/907232\/ac6e078ff802952e29fbd0f04c4b1921\/","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/77a\/f12\/37c\/77af1237c4ee0d914bf11880a08afa2d.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/8df\/f21\/4e8\/8dff214e84c28bf591e2130ab798d605.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/136\/2cb\/317\/1362cb31791593f195e1f5cfd452f3fa.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/ea4\/a51\/424\/ea4a51424883818e3cabbb5d72e0c12b.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/d53\/5dd\/c21\/d535ddc21533131f48200cf72cf6d81f.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/238\/22e\/5b4\/23822e5b4bde0b9f45678b99f2d04724.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/0ce\/64b\/b70\/0ce64bb70c1cb594fe7f2d76c426d20b.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/db3\/3d9\/3a0\/db33d93a009b68a89cea563298a134f0.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/5b9\/677\/0ac\/5b96770ac3e3e2d6a57bd85d52b20df8.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/0c1\/12e\/196\/0c112e1969a3ffdd2dc31fd7fa8ea3dc.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/bc1\/3a3\/e33\/bc13a3e332342bbc0a58630b899e6957.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/f9a\/9ab\/263\/f9a9ab2639265d1f927a3991cf65d287.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/ece\/5ac\/609\/ece5ac609e76d4e7e48a1ced27a1023c.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/716\/4c0\/6c7\/7164c06c7bada3381a00ea2070a239ef.png","https:\/\/habrastorage.org\/getpro\/habr\/upload_files\/856\/2db\/ace\/8562dbace864d371b0ccfd0c83b7912c.png"]}</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover,maximum-scale=1,user-scalable=0">
  <meta name="referrer" content="unsafe-url">
  <style>
      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5VvmojLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5Vvk4jLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5VvmYjLazX3dGTP.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9E4kDNxMZdWfMOD5Vvl4jLazX3dA.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }

      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveSxf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveQhf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveSBf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 500;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnZKveRhf6Xl7Glw.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }

      /* cyrillic-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eSxf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
      }

      /* cyrillic */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eQhf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
      }

      /* latin-ext */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eSBf6Xl7Gl3LX.woff2) format('woff2');
        unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
      }

      /* latin */
      @font-face {
        font-family: 'Fira Sans';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/firasans/v17/va9B4kDNxMZdWfMOD5VnLK3eRhf6Xl7Glw.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }
    </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/theme/light-v1.css" as="style" media="(prefers-color-scheme: light)">
  <link rel="preload" href="https://assets.habr.com/habr-web/css/theme/dark-v1.css" as="style" media="(prefers-color-scheme: dark)">
  <link id="light-colors" rel="stylesheet" href="https://assets.habr.com/habr-web/css/theme/light-v1.css" media="(prefers-color-scheme: light)">
  <link id="dark-colors" rel="stylesheet" href="https://assets.habr.com/habr-web/css/theme/dark-v1.css" media="(prefers-color-scheme: dark)">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.635b6c39236ebd33fa716c71ab0131a0.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  <style>
      .grecaptcha-badge {
        visibility: hidden;
      }
    </style>
  <meta name="habr-version" content="2.241.0">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" type="image/png" sizes="16x16" href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png">
  <link rel="shortcut icon" type="image/png" sizes="32x32" href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png">
  <link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png">
  <link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png">
  <link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png">
  <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png">
  <link rel="apple-touch-icon" type="image/png" sizes="256x256" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png">
  <link rel="apple-touch-startup-image" media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png">
  <link rel="mask-icon" color="#77a2b6" href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg">
  <link crossorigin="use-credentials" href="/manifest.webmanifest" rel="manifest">
  <script async src="https://unpkg.com/pwacompat" crossorigin="anonymous"></script>
  <script>window.yaContextCb = window.yaContextCb || []</script>
  <script src="https://yandex.ru/ads/system/context.js" async></script>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.04465f7c.css" as="style">
  <link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.978df117.js" as="script">
  <link rel="preload" href="https://assets.habr.com/habr-web/css/app.8599692f.css" as="style">
  <link rel="preload" href="https://assets.habr.com/habr-web/js/app.58b8c457.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.04465f7c.css">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.8599692f.css">
 </head>
 <body>
  <div id="mount">
   <div id="app">
    <div class="tm-layout__wrapper">
     <!--[--><!---->
     <div></div><!---->
     <header class="tm-header" data-test-id="header">
      <div class="tm-page-width">
       <!--[-->
       <div class="tm-header__container">
        <!----><span class="tm-header__logo-wrap"><a class="tm-header__logo tm-header__logo_hl-ru tm-header__logo" href="/ru/">
          <svg class="tm-svg-img tm-header__icon" height="16" width="16">
           <title>
            Хабр
           </title><use xlink:href="/img/habr-logo-ru.svg#logo"></use>
          </svg></a><span style="display:none;" class="tm-header__beta-sign">β</span></span><!--[-->
        <div class="tm-dropdown tm-header__projects">
         <div class="tm-dropdown__head">
          <!--[-->
          <button class="tm-header__dropdown-toggle">
           <svg class="tm-svg-img tm-header__icon tm-header__icon_dropdown" height="16" width="16">
            <title>
             Открыть список
            </title><use xlink:href="/img/megazord-v28.7909a852..svg#arrow-down"></use>
           </svg></button><!--]-->
         </div><!---->
        </div><a href="/ru/sandbox/start/" class="tm-header__become-author-btn">Как стать автором</a>
        <div class="tm-feature tm-feature tm-feature_variant-inline tm-header__feature">
         <!---->
        </div><!----><!--]--><!---->
       </div><!--]-->
      </div>
     </header>
     <div class="tm-layout">
      <div class="tm-page-progress-bar"></div>
      <div class="tm-base-layout__header_is-sticky tm-base-layout__header" data-menu-sticky="true">
       <div class="tm-page-width">
        <!--[-->
        <div class="tm-base-layout__header-wrapper">
         <div class="tm-main-menu">
          <div class="tm-main-menu__section">
           <nav class="tm-main-menu__section-content">
            <!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/feed/">Моя лента</a><!--]--><!--[--><a class="tm-main-menu__item" href="/ru/articles/">Все потоки</a><!--]--><!--[--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/develop/">Разработка</a><!--]--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/admin/">Администрирование</a><!--]--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/design/">Дизайн</a><!--]--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/management/">Менеджмент</a><!--]--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/marketing/">Маркетинг</a><!--]--><!--[--><a class="tm-main-menu__item" data-test-id="main-menu-item" href="/ru/flows/popsci/">Научпоп</a><!--]--><!--]-->
           </nav>
          </div>
         </div>
         <div class="tm-header-user-menu tm-base-layout__user-menu">
          <a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search" data-test-id="search-button">
           <svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark" height="24" width="24">
            <title>
             Поиск
            </title><use xlink:href="/img/megazord-v28.7909a852..svg#search"></use>
           </svg></a><!----><!---->
          <div class="tm-header-user-menu__item tm-header-user-menu__write">
           <div>
            <svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_write tm-header-user-menu__icon_dark" height="24" width="24">
             <title>
              Написать публикацию
             </title><use xlink:href="/img/megazord-v28.7909a852..svg#write"></use>
            </svg>
           </div><!---->
          </div><!--[-->
          <div class="tm-header-user-menu__item">
           <button class="tm-header-user-menu__toggle" data-test-id="user-menu-settings">
            <svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_dark" height="24" width="24">
             <title>
              Настройки
             </title><use xlink:href="/img/megazord-v28.7909a852..svg#page-settings"></use>
            </svg></button>
          </div><a href="https://habr.com/kek/v1/auth/habrahabr/?back=/ru/companies/cloud4y/articles/907232/&amp;hl=ru" rel="nofollow" class="tm-header-user-menu__item"><!--[-->
           <button class="btn btn_solid btn_small tm-header-user-menu__login" type="button"><!--[-->Войти<!--]--></button><!--]--></a><!--]--><!----><!--teleport start--><!--teleport end--><!---->
         </div>
        </div><!--]-->
       </div>
      </div><!---->
      <div class="tm-page-width">
       <!--[--><!--]-->
      </div>
      <main class="tm-layout__container">
       <div class="tm-page" hl="ru" companyname="cloud4y" data-async-called="true" style="--5ab2e5a8:16px;--44c4f6f6:100%;--45ba7a3b:0;">
        <div class="tm-page-width">
         <!--[-->
         <div class="tm-page__header">
          <!--[--><!--]-->
         </div>
         <div class="tm-page__wrapper">
          <div class="tm-page__main_has-sidebar tm-page__main">
           <div class="pull-down">
            <!---->
            <div class="pull-down__header" style="height:0px;">
             <div class="pull-down__content" style="bottom:10px;">
              <svg class="tm-svg-img pull-down__icon pull-down__arrow" height="24" width="24">
               <title>
                Обновить
               </title><use xlink:href="/img/megazord-v28.7909a852..svg#pull-arrow"></use>
              </svg>
             </div>
            </div><!--[--><!--[-->
            <div class="tm-article-presenter">
             <!--[--><!--[--><!---->
             <div class="tm-company-profile-card tm-company-article__profile-card">
              <div class="tm-company-card tm-company-profile-card__info">
               <div class="tm-company-card__header">
                <a href="/ru/companies/cloud4y/profile/" class="tm-company-card__avatar">
                 <div class="tm-entity-image">
                  <img alt="" class="tm-entity-image__pic" height="48" src="//habrastorage.org/getpro/habr/company/9d5/c09/f08/9d5c09f082a1df6cef1fe1ec3acdd0b9.png" width="48">
                 </div></a><!--[--><!---->
                <div class="tm-counter-container tm-company-card__rating">
                 <div class="tm-counter-container__header">
                  <!--[--><!--[--><!--]-->
                  <div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating">
                   <!---->
                   <div class="tm-votes-lever__score tm-votes-lever__score_appearance-rating tm-votes-lever__score">
                    <!--[--><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter_rating tm-votes-lever__score-counter" data-test-id="votes-score-counter">83.08</span></span><!--]-->
                   </div><!---->
                  </div><!--]-->
                 </div>
                 <div class="tm-counter-container__footer">
                  <!--[--><span class="tm-rating__text tm-rating__text">Рейтинг</span><!--]-->
                 </div>
                </div><!----><!--]-->
               </div>
               <div class="tm-company-card__info">
                <a href="/ru/companies/cloud4y/profile/" class="tm-company-card__name"><span>Cloud4Y</span></a>
                <div class="tm-company-card__description">
                 #1 Корпоративный облачный провайдер
                </div>
               </div>
              </div>
              <div class="tm-company-profile-card__buttons">
               <div class="tm-button-follow tm-company-profile-card__button tm-company-profile-card__button_follow">
                <!---->
                <button class="tm-button-follow__button tm-button-follow__button_big" data-test-id="follow-button" type="button">Подписаться</button>
               </div><!----><!----><!---->
              </div>
             </div><!----><!--]--><!--]-->
             <div class="tm-article-presenter__body" data-test-id="article-body">
              <div class="tm-misprint-area">
               <div class="tm-misprint-area__wrapper">
                <!--[-->
                <article class="tm-article-presenter__content tm-article-presenter__content_narrow">
                 <!--[-->
                 <div class="tm-article-presenter__header">
                  <!--[--><!--]-->
                  <div class="tm-article-snippet tm-article-snippet tm-article-presenter__snippet">
                   <!--[--><!--]-->
                   <div class="tm-article-snippet__meta-container">
                    <div class="tm-article-snippet__meta">
                     <span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/Cloud4Y/" class="tm-user-info__userpic" data-test-id="user-info-pic" title="Cloud4Y">
                       <div class="tm-entity-image">
                        <img alt="" class="tm-entity-image__pic" height="24" src="//habrastorage.org/r/w48/getpro/habr/avatars/c2d/d0d/c05/c2dd0dc05834aebeb86bb76e35caeaab.png" width="24">
                       </div></a><span class="tm-user-info__user tm-user-info__user_appearance-default" data-test-id="user-info-description"><a href="/ru/users/Cloud4Y/" class="tm-user-info__username">Cloud4Y <!----></a><!--[--><span class="tm-article-datetime-published"><time datetime="2025-05-06T07:13:08.000Z" title="2025-05-06, 10:13">23 часа назад</time></span><!--]--></span></span>
                    </div><!---->
                   </div>
                   <h1 class="tm-title tm-title_h1" lang="ru" data-test-id="articleTitle"><span>Zabbix. Мониторинг больших рассылок</span></h1>
                   <div class="tm-article-snippet__stats" data-test-id="articleStats">
                    <div class="tm-article-complexity tm-article-complexity_complexity-low">
                     <span class="tm-svg-icon__wrapper tm-article-complexity__icon">
                      <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
                       <title>
                        Уровень сложности
                       </title><use xlink:href="/img/megazord-v28.7909a852..svg#complexity-low"></use>
                      </svg></span><span class="tm-article-complexity__label">Простой</span>
                    </div>
                    <div class="tm-article-reading-time">
                     <span class="tm-svg-icon__wrapper tm-article-reading-time__icon">
                      <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
                       <title>
                        Время на прочтение
                       </title><use xlink:href="/img/megazord-v28.7909a852..svg#clock"></use>
                      </svg></span><span class="tm-article-reading-time__label">7 мин</span>
                    </div><span class="tm-icon-counter tm-data-icons__item">
                     <svg class="tm-svg-img tm-icon-counter__icon" height="24" width="24">
                      <title>
                       Количество просмотров
                      </title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-views"></use>
                     </svg><span class="tm-icon-counter__value" title="1559">1.6K</span></span>
                   </div>
                   <div class="tm-publication-hubs__container" data-test-id="articleHubsList">
                    <div class="tm-publication-hubs">
                     <!--[--><span class="tm-publication-hub__link-container"><a href="/ru/companies/cloud4y/articles/" class="tm-publication-hub__link"><!--[--><span>Блог компании Cloud4Y</span><!----><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/sys_admin/" class="tm-publication-hub__link"><!--[--><span>Системное администрирование</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/it-infrastructure/" class="tm-publication-hub__link"><!--[--><span>IT-инфраструктура</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/spam/" class="tm-publication-hub__link"><!--[--><span>Спам и антиспам</span><!----><!--]--></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/cloud_services/" class="tm-publication-hub__link"><!--[--><span>Облачные сервисы</span><span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span><!--]--></a></span><!--]-->
                    </div>
                   </div>
                   <div class="tm-article-labels" data-test-id="articleLabels">
                    <div class="tm-article-labels__container">
                     <div class="tm-publication-label tm-publication-label_variant-tutorial">
                      <span>Туториал</span>
                     </div><!--[--><!--]-->
                    </div>
                   </div><!----><!---->
                  </div>
                 </div><!--[--><!---->
                 <div class="tm-article-body" data-gallery-root lang="ru">
                  <div>
                   <!--[--><!--]-->
                  </div>
                  <div id="post-content-body">
                   <div>
                    <div class="article-formatted-body article-formatted-body article-formatted-body_version-2">
                     <div xmlns="http://www.w3.org/1999/xhtml">
                      <figure class="full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/77a/f12/37c/77af1237c4ee0d914bf11880a08afa2d.png" width="810" height="262" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/77a/f12/37c/77af1237c4ee0d914bf11880a08afa2d.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/77a/f12/37c/77af1237c4ee0d914bf11880a08afa2d.png 781w" loading="lazy" decode="async">
                      </figure>
                      <p>Привет! На связи Виктор Лысенко из Cloud4Y. Сегодня хочу рассказать о массовых рассылках и способах борьбы с&nbsp;ними.</p>
                      <p>Кейс исключительно практический: возникла необходимость предупреждать и отслеживать потенциальных спамеров (входящих и исходящих). И я решил вывести большие рассылки в&nbsp;Zabbix со следующими полями писем <a href="https://www.cloud4y.ru/cloud-services/corporate-mail/?utm_source=habr&amp;utm_medium=article&amp;utm_campaign=article&amp;utm_content=corporate-mail">Exchange</a>:</p>
                      <ul>
                       <li>
                        <p>Domain</p></li>
                       <li>
                        <p>Timestamp</p></li>
                       <li>
                        <p>Sender</p></li>
                       <li>
                        <p>RecipientCount</p></li>
                       <li>
                        <p>Subject</p></li>
                       <li>
                        <p>InternalMessageId</p></li>
                      </ul>
                      <details class="spoiler">
                       <summary>Примерный план работ:</summary>
                       <div class="spoiler__content">
                        <ol>
                         <li>
                          <p>Подготовить скрипт, генерирующий .json и поместить его в планировщик задач</p></li>
                         <li>
                          <p>Добавить UserParameter в конфигурацию Zabbix (zabbix_agentd.conf)</p></li>
                         <li>
                          <p>Добавляем макрос для поля RecipientCount в шаблон</p></li>
                         <li>
                          <p>Создать главный элемент данных</p></li>
                         <li>
                          <p>Создание зависимого правила обнаружения</p></li>
                         <li>
                          <p>Создание прототипа элемента данных</p></li>
                         <li>
                          <p>Создание прототипа триггера</p></li>
                         <li>
                          <p>Применение шаблона на Exchange сервера</p></li>
                        </ol>
                       </div>
                      </details>
                      <h3>Подготовка скрипта</h3>
                      <p>Подготовлен скрипт, который собирает все <u>полученные и отправленные</u> письма текущим сервером, с&nbsp;количеством получателей более двух (переменная <strong>$Limit</strong>) и выгружает в&nbsp;json‑файл. Дальнейшая фильтрация по&nbsp;количеству получателей будет производится в&nbsp;Zabbix через макрос <strong>{$BIG_MAIL_TRIGGER}</strong>.</p>
                      <pre><code>Add-PSSnapin Microsoft.Exchange.Management.PowerShell.E2010

$Utf8NoBomEncoding = New-Object System.Text.Utf8Encoding
$RunServer = $env:COMPUTERNAME
$Limit = 2
$OutFile = "D:\Scripts\Zabbix\Results\zabbix_big_mailings.json"

[System.Collections.ArrayList]$Status = @()

$Nums  = Get-MessageTrackingLog -Server $RunServer -EventId "EXPAND" -Resultsize Unlimited -Start (Get-Date).AddDays(-3)  | ?{$_.RecipientCount -gt $Limit}

ForEach ($Num in $Nums) { 
    $Status += [PSCustomObject]@{
        'Domain'            = ($Num.sender).split("@")[1]
        'Timestamp'         = [string]$Num.Timestamp
        'Sender'            = [string]$Num.Sender
        'RecipientCount'    = [int]$Num.RecipientCount
        'Subject'           = [string]$Num.MessageSubject
        'InternalMessageId' = [string]$Num.InternalMessageId}
}

#Генерируем заглушку, если нет данных после выборки
if ($Nums.count -eq 0){
    $Status += ,[PSCustomObject]@{
        'Domain'            = "domain.com"
        'Timestamp'         = "01/01/1900 00:00:0"
        'Sender'            = "debug@domain.com"
        'RecipientCount'    = 0
        'Subject'           = "Only if $Nums = 0, stub for zabbix"
        'InternalMessageId' = "0123456789ABCDE"}
}

if ($Nums.Count -eq 1) {[array]$Sorted = @($Status) | Sort Domain} else {$Sorted = $Status | Sort Domain}
$MyRawString = ,$Sorted | ConvertTo-Json -Depth 5
[System.IO.File]::WriteAllLines($OutFile, $MyRawString, $Utf8NoBomEncoding)</code></pre>
                      <p>В&nbsp;моём примере команда «(Get‑Date).AddDays(-3)» получает выборку за&nbsp;последние три дня. Можно, например, установить выборку за&nbsp;последние 6&nbsp;часов: «(Get‑Date).AddHours(-6)».</p>
                      <p>Пример JSON‑файла:</p>
                      <figure class="bordered full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/8df/f21/4e8/8dff214e84c28bf591e2130ab798d605.png" width="540" height="176" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/8df/f21/4e8/8dff214e84c28bf591e2130ab798d605.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/8df/f21/4e8/8dff214e84c28bf591e2130ab798d605.png 781w" loading="lazy" decode="async">
                      </figure>
                      <p>Размещаем выполнение скрипта в планировщике задач:</p>
                      <figure class="bordered full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/136/2cb/317/1362cb31791593f195e1f5cfd452f3fa.png" width="844" height="94" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/136/2cb/317/1362cb31791593f195e1f5cfd452f3fa.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/136/2cb/317/1362cb31791593f195e1f5cfd452f3fa.png 781w" loading="lazy" decode="async">
                      </figure>
                      <h3>2. Добавить UserParameter в конфигурацию Zabbix</h3>
                      <p>В&nbsp;файл конфигурации <strong>zabbix_agentd.conf</strong> добавляем пользовательский параметр с&nbsp;ключом <strong>exchange.big.mail.get</strong>, можно указать любой другой ключ, просто в&nbsp;следующем пункте нужно будет указать именно этот ключ.</p>
                      <p>По&nbsp;этому ключу zabbix будет получать .json, созданный в&nbsp;предыдущем пункте при&nbsp;выполнении скрипта:</p>
                      <pre><code>UserParameter = exchange.big.mailings.get, type D:\Scripts\Zabbix\EX01\zabbix_big_mailings.json</code></pre>
                      <p>После внесения изменений в <strong>zabbix_agentd.conf</strong> не&nbsp;забываем перезапустить службу «Zabbix Agent».</p>
                      <h3>3. Добавление макроса в шаблон</h3>
                      <p>Создаём <u>новый шаблон или&nbsp;используем другой</u>. Важно добавить макрос «{$BIG_MAIL_TRIGGER}». Этот макрос устанавливает пороговое значение для&nbsp;перехода на&nbsp;следующий этап, то есть срабатывания триггера.</p>
                      <p>В моём примере порог срабатывания 100&nbsp;получателей&nbsp;— RecipientCount:</p>
                      <figure class="bordered full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/ea4/a51/424/ea4a51424883818e3cabbb5d72e0c12b.png" width="942" height="259" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/ea4/a51/424/ea4a51424883818e3cabbb5d72e0c12b.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/ea4/a51/424/ea4a51424883818e3cabbb5d72e0c12b.png 781w" loading="lazy" decode="async">
                      </figure>
                      <h3>4. Создаём главный элемент данных Zabbix</h3>
                      <p><strong>Главный элемент данных (Master Item)</strong>&nbsp;— это обычный элемент данных (Item) в&nbsp;Zabbix, который хранит «сырые» данные (например, JSON), используемые другими зависимыми элементами (<strong>Dependent Items</strong>) или&nbsp;правилами обнаружения (<strong>LLD Rules</strong>).</p>
                      <p>Создаём новый элемент данных.. Здесь при&nbsp;создании важно указать:</p>
                      <ul>
                       <li>
                        <p>тип&nbsp;— «Zabbix Agent»</p></li>
                       <li>
                        <p>ключ&nbsp;— указанный ранее в&nbsp;пункте 2, в «UserParameter». В&nbsp;моём случае&nbsp;— «exchange.big.mailings.get»</p></li>
                      </ul>
                      <figure class="bordered full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/d53/5dd/c21/d535ddc21533131f48200cf72cf6d81f.png" width="940" height="534" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/d53/5dd/c21/d535ddc21533131f48200cf72cf6d81f.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/d53/5dd/c21/d535ddc21533131f48200cf72cf6d81f.png 781w" loading="lazy" decode="async">
                      </figure>
                      <p>Далее нужно сделать предобработку, отфильтровать элементы массива, добавляем зависимость от&nbsp;макроса «{$BIG_MAIL_TRIGGER}» во&nbsp;вкладке «Предобработка». Я опишу два варианта:</p>
                      <p>А. Логичнее это реализовать с&nbsp;помощью JSONPath&nbsp;— «$.value[?(@.RecipientCount &gt;= {$BIG_MAIL_TRIGGER})]»:</p>
                      <figure class="bordered full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/238/22e/5b4/23822e5b4bde0b9f45678b99f2d04724.png" width="943" height="248" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/238/22e/5b4/23822e5b4bde0b9f45678b99f2d04724.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/238/22e/5b4/23822e5b4bde0b9f45678b99f2d04724.png 781w" loading="lazy" decode="async">
                      </figure>
                      <p>Но&nbsp;в случае, когда после фильтрации не&nbsp;останется элементов, Zabbix <strong>вернёт ошибку, не&nbsp;пустой массив: </strong>«cannot extract value from json by path "$..[?(@.RecipientCount &gt;= {$BIG_MAIL_TRIGGER})]": no data matches the specified path». Что <strong>НЕ </strong>запустит процесс обновления элементов данных и триггеров.</p>
                      <p>На&nbsp;практике это означает, что старые триггеры&nbsp;будут висеть до&nbsp;тех пор, пока не&nbsp;выполнится условие в&nbsp;JSONPath и уже следующий массив «спамеров» не&nbsp;пойдёт в&nbsp;генерацию новых элементов данных и триггеров. В&nbsp;некоторых случаях это может пригодится&nbsp;— всегда наблюдать последних спамеров.</p>
                      <ul>
                       <li>
                        <p>«<strong>$</strong>»<strong> </strong>— корневой элемент JSON-документа.</p></li>
                       <li>
                        <p>«<strong>value</strong>»<strong> </strong>— поиск в пределах массива <strong>value </strong>(нерекурсивный).</p></li>
                       <li>
                        <p>«<strong>[?(@.RecipientCount &gt;= {$BIG_MAIL_TRIGGER})]</strong>»<strong> </strong>— это фильтр, который применяется к каждому элементу массива или объекту, найденному на предыдущем шаге. Разберём его подробнее:</p>
                        <ul>
                         <li>
                          <p>«<strong>?</strong>»<strong> </strong>— обозначает начало фильтра.</p></li>
                         <li>
                          <p>«<strong>@</strong>»<strong> </strong>— текущий элемент, который проверяется.</p></li>
                         <li>
                          <p>«<strong>.RecipientCount</strong>» — обращение к полю <strong>«RecipientCount» </strong>текущего элемента.</p></li>
                         <li>
                          <p>«<strong>&gt;= {$BIG_MAIL_TRIGGER}</strong>» — условие, при котором значение поля <strong>«RecipientCount» </strong>должно быть больше или равно значению макроса(переменной) <strong>«{$BIG_MAIL_TRIGGER}»</strong>.</p></li>
                        </ul></li>
                      </ul>
                      <p>Б. Но&nbsp;я реализую с&nbsp;помощью JavaScript, с&nbsp;условием если нет элементов, то вернётся пустой массив:</p>
                      <pre><code>try {
    var threshold = Number("{$BIG_MAIL_TRIGGER}"); // Преобразуем макрос в число
    var data = JSON.parse(value); // Разбираем JSON
    
    if (!data.value || typeof data.value !== "object") {
        return "[]"; // Если нет массива, возвращаем пустой массив
    }

    var result = [];
    for (var i = 0; i &lt; data.value.length; i++) {
        if (data.value[i].RecipientCount &gt;= threshold) {
            result.push(data.value[i]); // Добавляем элемент в результат, если проходит фильтр
        }
    }

    return JSON.stringify(result); // Возвращаем отфильтрованный JSON
} catch (e) {
    return "[]"; // В случае ошибки возвращаем пустой массив
}
</code></pre>
                      <figure class="bordered full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/0ce/64b/b70/0ce64bb70c1cb594fe7f2d76c426d20b.png" width="941" height="246" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/0ce/64b/b70/0ce64bb70c1cb594fe7f2d76c426d20b.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/0ce/64b/b70/0ce64bb70c1cb594fe7f2d76c426d20b.png 781w" loading="lazy" decode="async">
                      </figure>
                      <h3>5. Создаём правило обнаружения</h3>
                      <p>В&nbsp;Zabbix <strong>правило обнаружения</strong> (Discovery Rule)&nbsp;— это механизм, который позволяет автоматически обнаруживать и создавать объекты мониторинга (например, элементы данных, триггеры, графики) на&nbsp;основе динамически собираемых данных. Это особенно полезно для&nbsp;мониторинга систем, где количество объектов может меняться, например, сетевые интерфейсы, диски, сервисы, виртуальные машины и&nbsp;т.&nbsp;д.</p>
                      <p>В&nbsp;нашем случае правило обнаружения анализирует полученный JSON, и извлекает из&nbsp;него массив объектов рассылки. На&nbsp;основе обнаруженных объектов Zabbix автоматически создает элементы данных и триггеры.</p>
                      <p>Создаём правило обнаружения. Правило следует связать с&nbsp;главным элементом данных созданном в&nbsp;предыдущем пункте. Связь устанавливается указанием двух полей:</p>
                      <ul>
                       <li>
                        <p>Тип&nbsp;— «Зависимый элемент данных»</p></li>
                       <li>
                        <p>Основной элемент данных&nbsp;— указываем имя главного элемента данных из&nbsp;п.4.</p></li>
                       <li>
                        <p><em>Имя и остальные параметры, устанавливаем на&nbsp;своё усмотрение</em></p></li>
                      </ul>
                      <figure class="bordered full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/db3/3d9/3a0/db33d93a009b68a89cea563298a134f0.png" width="769" height="325" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/db3/3d9/3a0/db33d93a009b68a89cea563298a134f0.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/db3/3d9/3a0/db33d93a009b68a89cea563298a134f0.png 781w" loading="lazy" decode="async">
                      </figure>
                      <p>Правило обнаружения понадобилось, чтобы использовать функциональность <a href="https://www.zabbix.com/documentation/current/en/manual/config/macros/lld_macros">LLD (Low Level Discovery) макросов</a> в&nbsp;прототипах триггера и элемента данных. Добавляем LLD макросы:</p>
                      <figure class="bordered full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/5b9/677/0ac/5b96770ac3e3e2d6a57bd85d52b20df8.png" width="844" height="287" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/5b9/677/0ac/5b96770ac3e3e2d6a57bd85d52b20df8.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/5b9/677/0ac/5b96770ac3e3e2d6a57bd85d52b20df8.png 781w" loading="lazy" decode="async">
                      </figure>
                      <p>LLD макросы:</p>
                      <div>
                       <div class="table">
                        <table>
                         <tbody>
                          <tr>
                           <td>
                            <p align="left"><strong>Макрос</strong></p></td>
                           <td>
                            <p align="left"><strong>JSONPath</strong></p></td>
                          </tr>
                          <tr>
                           <td>
                            <p align="left">{#BIGMAILINGSORG}</p></td>
                           <td>
                            <p align="left">$.Domain</p></td>
                          </tr>
                          <tr>
                           <td>
                            <p align="left">{#BIGMAILINGSTIMESTAMP}&nbsp;</p></td>
                           <td>
                            <p align="left">$.Timestamp</p></td>
                          </tr>
                          <tr>
                           <td>
                            <p align="left">{#ID}</p></td>
                           <td>
                            <p align="left">$.InternalMessageId</p></td>
                          </tr>
                          <tr>
                           <td>
                            <p align="left">{#MAILSCOUNT}&nbsp;</p></td>
                           <td>
                            <p align="left">$.RecipientCount</p></td>
                          </tr>
                          <tr>
                           <td>
                            <p align="left">{#SENDER}</p></td>
                           <td>
                            <p align="left">$.Sender</p></td>
                          </tr>
                          <tr>
                           <td>
                            <p align="left">{#SUBJECT}</p></td>
                           <td>
                            <p align="left">$.Subject</p></td>
                          </tr>
                         </tbody>
                        </table>
                       </div>
                      </div>
                      <p>Количество макросов можно расширить, для этого достаточно указать нужные поля, которые требуется добавить в выходной JSON, используя скрипт в п.1.</p>
                      <h3>6. Создаём прототип элемента данных</h3>
                      <p>Ограничение Zabbix: <strong>зависимый элемент данных </strong>(<strong>Dependent Item) нельзя привязать напрямую к&nbsp;правилу обнаружения (Discovery Rule)</strong>. Это связано с&nbsp;архитектурой Zabbix&nbsp;— Зависимый элемент данных может зависеть только от&nbsp;другого элемента данных (Item), а&nbsp;не&nbsp;от&nbsp;LLD‑правила.</p>
                      <p>Если бы не это ограничение, элемент данных (п.4), можно было бы не создавать, а прототип привязать сразу к правилу обнаружения.</p>
                      <p>Создаём прототип элемента данных. Правило следует связать с&nbsp;элементом данных созданным в&nbsp;п.4.&nbsp;— поля «Тип» и «Основной элемент данных», заполняем и другие поля:</p>
                      <ul>
                       <li>
                        <p>Тип&nbsp;— «Зависимый элемент данных»</p></li>
                       <li>
                        <p>Основной элемент данных&nbsp;— указываем имя главного элемента данных из&nbsp;п.4.</p></li>
                       <li>
                        <p><em>Имя</em>&nbsp;— имя должно быть уникальным, не повторять даже макросы</p></li>
                       <li>
                        <p><em>Ключ</em>&nbsp;— по&nbsp;ключу будет обращение триггера, важно указать макрос «{#ID}» в&nbsp;качестве параметра</p></li>
                       <li>
                        <p><em>Тип информации</em>&nbsp;— Числовой, так как&nbsp;будет возвращаться «RecipientCount»</p></li>
                       <li>
                        <p><em>Остальные параметры устанавливаем на&nbsp;своё усмотрение</em></p></li>
                      </ul>
                      <figure class="bordered full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/0c1/12e/196/0c112e1969a3ffdd2dc31fd7fa8ea3dc.png" width="942" height="526" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/0c1/12e/196/0c112e1969a3ffdd2dc31fd7fa8ea3dc.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/0c1/12e/196/0c112e1969a3ffdd2dc31fd7fa8ea3dc.png 781w" loading="lazy" decode="async">
                      </figure>
                      <p>Далее во&nbsp;вкладке «Предобработка» добавляем условия возврата «RecipientCount» для&nbsp;рассылки с&nbsp;указанным «{#ID}».</p>
                      <p>Поле JSONPath - «$[?(@.InternalMessageId=="{#ID}")].RecipientCount»:</p>
                      <figure class="bordered full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/bc1/3a3/e33/bc13a3e332342bbc0a58630b899e6957.png" width="941" height="308" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/bc1/3a3/e33/bc13a3e332342bbc0a58630b899e6957.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/bc1/3a3/e33/bc13a3e332342bbc0a58630b899e6957.png 781w" loading="lazy" decode="async">
                      </figure>
                      <p>Так как&nbsp;значение возвращается в&nbsp;квадратных скобках, просто обрезаем их с&nbsp;помощью правил предобработки.</p>
                      <p>Проверяем с&nbsp;заранее подготовленным массивом. Результат тестирования правил предобработки для&nbsp;рассылки с {#ID} = 31&nbsp;628&nbsp;139&nbsp;167&nbsp;757, вернул количество получателей&nbsp;— 3:</p>
                      <figure class="bordered full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/f9a/9ab/263/f9a9ab2639265d1f927a3991cf65d287.png" width="768" height="378" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/f9a/9ab/263/f9a9ab2639265d1f927a3991cf65d287.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/f9a/9ab/263/f9a9ab2639265d1f927a3991cf65d287.png 781w" loading="lazy" decode="async">
                      </figure>
                      <h3>7. Создаём прототип триггера</h3>
                      <p>Вот здесь нам и потребуется указать LLD макросы, в полях:</p>
                      <ul>
                       <li>
                        <p>Имя&nbsp;— «_BigMail: {#SENDER} send {#MAILSCOUNT} messages at {#BIGMAILINGSTIMESTAMP}, Subject: {#SUBJECT}»</p></li>
                       <li>
                        <p>Выражение&nbsp;— «last(/Template Microsoft Exchange PS Checks/exchange.big.mailings.getstatus[{#ID}])&gt;{$BIG_MAIL_TRIGGER}»</p></li>
                      </ul>
                      <figure class="bordered full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/ece/5ac/609/ece5ac609e76d4e7e48a1ced27a1023c.png" width="942" height="585" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/ece/5ac/609/ece5ac609e76d4e7e48a1ced27a1023c.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/ece/5ac/609/ece5ac609e76d4e7e48a1ced27a1023c.png 781w" loading="lazy" decode="async">
                      </figure>
                      <p>Имя триггера (поле «Имя») при&nbsp;подстановке макросов будет выглядеть примерно так: «_BigMail: <a href="mailto:debug@domain.com">debug@domain.com</a> send 200 messages at 01/01/1900 00:00:00, Subject: Stub For Zabbix»</p>
                      <p>А&nbsp;поле «Выражение»&nbsp;— это условие срабатывание/отображения триггера. Это выражение вызывает прототип элемента данных с&nbsp;макросом\переменной {#ID} письма, и полученный результат сравнивает с {$BIG_MAIL_TRIGGER}&nbsp; - «RecipientCount &gt; {$BIG_MAIL_TRIGGER}». Если соблюдено условие, то срабатывает триггер.</p>
                      <h3>8. Применяем подготовленный шаблон на сервер Exchange</h3>
                      <p>В&nbsp;свойствах узла сети выбираем шаблон и нажимаем «Обновить». Нужно время, чтобы шаблон применился и создались элементы данных и триггеры.</p>
                      <figure class="bordered full-width ">
                       <img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/716/4c0/6c7/7164c06c7bada3381a00ea2070a239ef.png" width="942" height="543" sizes="(max-width: 780px) 100vw, 50vw" srcset="https://habrastorage.org/r/w780/getpro/habr/upload_files/716/4c0/6c7/7164c06c7bada3381a00ea2070a239ef.png 780w,
       https://habrastorage.org/r/w1560/getpro/habr/upload_files/716/4c0/6c7/7164c06c7bada3381a00ea2070a239ef.png 781w" loading="lazy" decode="async">
                      </figure>
                      <p>Вот так можно поколдовать с почтой. Есть идеи, как можно сделать лучше? Я с интересом выслушаю.</p>
                      <p>Спасибо за внимание, ваш&nbsp;<a href="https://www.cloud4y.ru/?utm_source=habr&amp;utm_medium=article&amp;utm_campaign=habr&amp;utm_content=ai-gpu-main">Cloud4Y</a>. Читайте нас здесь или в&nbsp;<a href="https://t.me/+ET_qtHM8_540Nzhi">Telegram‑канале</a>!</p>
                     </div>
                    </div>
                   </div><!----><!---->
                  </div><!----><!---->
                 </div><!--]--><!---->
                 <div class="tm-article-presenter__meta" data-test-id="article-meta-links">
                  <div class="tm-separated-list tm-article-presenter__meta-list">
                   <span class="tm-separated-list__title">Теги:</span>
                   <ul class="tm-separated-list__list">
                    <!--[-->
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D0%B0%D0%BD%D1%82%D0%B8%D1%81%D0%BF%D0%B0%D0%BC]" class="tm-tags-list__link"><span>антиспам</span></a><!--]--></li>
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[Zabbix]" class="tm-tags-list__link"><span>Zabbix</span></a><!--]--></li>
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[Exchange]" class="tm-tags-list__link"><span>Exchange</span></a><!--]--></li>
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=[%D1%80%D0%B0%D1%81%D1%81%D1%8B%D0%BB%D0%BA%D0%B8]" class="tm-tags-list__link"><span>рассылки</span></a><!--]--></li><!--]--><!---->
                   </ul>
                  </div>
                  <div class="tm-separated-list tm-article-presenter__meta-list">
                   <span class="tm-separated-list__title">Хабы:</span>
                   <ul class="tm-separated-list__list">
                    <!--[-->
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/companies/cloud4y/articles/" class="tm-hubs-list__link"><!--[--><span>Блог компании Cloud4Y</span><!--]--></a><!--]--></li>
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/sys_admin/" class="tm-hubs-list__link"><!--[--><span>Системное администрирование</span><!--]--></a><!--]--></li>
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/it-infrastructure/" class="tm-hubs-list__link"><!--[--><span>IT-инфраструктура</span><!--]--></a><!--]--></li>
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/spam/" class="tm-hubs-list__link"><!--[--><span>Спам и антиспам</span><!--]--></a><!--]--></li>
                    <li class="tm-separated-list__item"><!--[--><a href="/ru/hubs/cloud_services/" class="tm-hubs-list__link"><!--[--><span>Облачные сервисы</span><!--]--></a><!--]--></li><!--]--><!---->
                   </ul>
                  </div>
                 </div><!----><!--]-->
                </article><!--]-->
               </div><!---->
              </div>
              <div style="" class="tm-article-sticky-panel" data-test-id="article-sticky-panel">
               <div class="tm-data-icons tm-data-icons tm-data-icons_space-big tm-article-sticky-panel__icons" data-test-id="article-stats-icons">
                <div class="article-rating tm-data-icons__item" data-v-86aec4a7>
                 <div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-article votes-switcher" title="Всего голосов 6: ↑6 и ↓0" data-v-86aec4a7>
                  <button class="tm-votes-lever__button" data-test-id="votes-lever-upvote-button" title="Нравится" type="button">
                   <svg class="tm-svg-img tm-votes-lever__icon" height="24" width="24">
                    <title>
                     Нравится
                    </title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-vote"></use>
                   </svg></button>
                  <div class="tm-votes-lever__score tm-votes-lever__score_appearance-article tm-votes-lever__score">
                   <!--[--><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter_positive tm-votes-lever__score-counter" data-test-id="votes-score-counter">+6</span></span><!--]-->
                  </div>
                  <button class="tm-votes-lever__button" data-test-id="votes-lever-downvote-button" title="Не нравится" type="button">
                   <svg class="tm-svg-img tm-votes-lever__icon tm-votes-lever__icon_arrow-down" height="24" width="24">
                    <title>
                     Не нравится
                    </title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-vote"></use>
                   </svg></button>
                 </div><!--teleport start--><!--teleport end--><!---->
                </div><!----><!---->
                <button class="bookmarks-button tm-data-icons__item" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon">
                  <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
                   <title>
                    Добавить в закладки
                   </title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-favorite"></use>
                  </svg></span><span class="bookmarks-button__counter" title="Количество пользователей, добавивших публикацию в закладки">12</span></button>
                <div class="tm-sharing tm-data-icons__item" title="Поделиться">
                 <button class="tm-sharing__button" type="button">
                  <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="tm-sharing__icon">
                   <path fill="currentColor" d="M13.8 13.8V18l7.2-6.6L13.8 5v3.9C5 8.9 3 18.6 3 18.6c2.5-4.4 6-4.8 10.8-4.8z"></path>
                  </svg></button><!--teleport start--><!--teleport end-->
                </div>
                <div class="tm-article-comments-counter-link tm-data-icons__item" title="Читать комментарии">
                 <a href="/ru/companies/cloud4y/articles/907232/comments/" class="tm-article-comments-counter-link__link" data-test-id="counter-comments"><!--[-->
                  <svg class="tm-svg-img tm-article-comments-counter-link__icon" height="24" width="24">
                   <title>
                    Комментарии
                   </title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-comments"></use>
                  </svg><span class="tm-article-comments-counter-link__value">0</span><!--]--></a><!---->
                </div><!--[--><!--[--><!--[--><!----><!--]--><!--]--><!--]--><!--teleport start--><!--teleport end--><!---->
               </div>
              </div>
             </div><!--[--><!--]-->
             <div class="tm-article-presenter__footer">
              <!--[--><!--[-->
              <div class="tm-article-blocks">
               <!----><!--[-->
               <section class="tm-block tm-block tm-block_spacing-bottom">
                <!----><!--[-->
                <div class="tm-block__body tm-block__body tm-block__body_variant-balanced">
                 <!--[-->
                 <div class="tm-article-author" data-test-id="article-author-info" data-async-called="true">
                  <!--[--><!--[-->
                  <div class="tm-article-author__company">
                   <div class="tm-article-author__company-card">
                    <div class="tm-company-snippet">
                     <a href="/ru/companies/cloud4y/profile/" class="tm-company-snippet__logo-link">
                      <div class="tm-entity-image">
                       <img alt="" class="tm-entity-image__pic" height="40" src="//habrastorage.org/getpro/habr/company/9d5/c09/f08/9d5c09f082a1df6cef1fe1ec3acdd0b9.png" width="40">
                      </div></a>
                     <div class="tm-company-snippet__info">
                      <a href="/ru/companies/cloud4y/profile/" class="tm-company-snippet__title" data-test-id="company-title"><span>Cloud4Y</span></a>
                      <div class="tm-company-snippet__description">
                       #1 Корпоративный облачный провайдер
                      </div>
                     </div>
                    </div>
                    <div class="tm-article-author__buttons">
                     <!----><!---->
                    </div>
                   </div>
                   <div class="tm-article-author__company-contacts">
                    <!--[--><a class="tm-article-author__contact" href="http://www.cloud4y.ru/" rel="noopener" target="_blank">Сайт</a><a class="tm-article-author__contact" href="https://facebook.com/cloud4y" rel="noopener" target="_blank">Facebook</a><a class="tm-article-author__contact" href="https://x.com/Cloud4Y" rel="noopener" target="_blank">X</a><a class="tm-article-author__contact" href="https://vk.com/cloud4y" rel="noopener" target="_blank">ВКонтакте</a><a class="tm-article-author__contact" href="https://telegram.me/cloud4y" rel="noopener" target="_blank">Telegram</a><!--]-->
                   </div>
                   <div class="tm-article-author__separator"></div>
                  </div><!--]--><!--]-->
                  <div class="tm-user-card tm-user-card tm-user-card_variant-article tm-article-author__user-card" data-async-called="true">
                   <div class="tm-user-card__info-container">
                    <div class="tm-user-card__header">
                     <div class="tm-user-card__header-data">
                      <a href="/ru/users/Cloud4Y/" class="tm-user-card__userpic tm-user-card__userpic_size-40">
                       <div class="tm-entity-image">
                        <img alt="" class="tm-entity-image__pic" src="//habrastorage.org/getpro/habr/avatars/c2d/d0d/c05/c2dd0dc05834aebeb86bb76e35caeaab.png">
                       </div></a>
                      <div class="tm-user-card__meta">
                       <div class="tm-counter-container karma" title=" 406 голосов " data-v-f7c0e283>
                        <div class="tm-counter-container__header">
                         <!--[-->
                         <div class="karma-display positive" data-v-f7c0e283 data-v-7635202e>
                          206
                         </div><!----><!--]-->
                        </div>
                        <div class="tm-counter-container__footer">
                         <!--[-->
                         <div class="karma-text" data-v-f7c0e283>
                          Карма
                         </div><!--teleport start--><!--teleport end--><!--]-->
                        </div>
                       </div>
                       <div class="tm-counter-container" title="Рейтинг пользователя">
                        <div class="tm-counter-container__header">
                         <!--[--><!--[--><!--]-->
                         <div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating">
                          <!---->
                          <div class="tm-votes-lever__score tm-votes-lever__score_appearance-rating tm-votes-lever__score">
                           <!--[--><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter_rating tm-votes-lever__score-counter" data-test-id="votes-score-counter">43.8</span></span><!--]-->
                          </div><!---->
                         </div><!--]-->
                        </div>
                        <div class="tm-counter-container__footer">
                         <!--[--><span class="tm-rating__text tm-rating__text">Рейтинг</span><!--]-->
                        </div>
                       </div>
                      </div>
                     </div>
                    </div>
                    <div class="tm-user-card__info tm-user-card__info_variant-article tm-user-card__info">
                     <div class="tm-user-card__title tm-user-card__title_variant-article tm-user-card__title">
                      <span class="tm-user-card__name tm-user-card__name_variant-article tm-user-card__name">Cloud4Y</span><a href="/ru/users/Cloud4Y/" class="tm-user-card__nickname tm-user-card__nickname tm-user-card__nickname_variant-article"> @Cloud4Y</a><!---->
                     </div>
                     <p class="tm-user-card__short-info tm-user-card__short-info_variant-article tm-user-card__short-info" data-test-id="user-card-speciality">Корпоративный облачный провайдер</p>
                    </div>
                   </div><!---->
                   <div class="tm-user-card__buttons tm-user-card__buttons_variant-article tm-user-card__buttons">
                    <!---->
                    <div class="tm-user-card__button">
                     <div class="tm-button-follow tm-user-card__button-follow">
                      <!---->
                      <button class="tm-button-follow__button tm-button-follow__button_big" data-test-id="follow-button" type="button">Подписаться</button>
                     </div>
                    </div><!---->
                    <div class="tm-user-card__button tm-user-card__button_write" data-test-id="user-card-conversations">
                     <svg class="tm-svg-img tm-user-card__button-icon" height="16" width="16">
                      <title>
                       Отправить сообщение
                      </title><use xlink:href="/img/megazord-v28.7909a852..svg#mail"></use>
                     </svg>
                    </div><!---->
                   </div><!---->
                  </div>
                  <div class="tm-article-author__user-contacts" data-test-id="author-contacts">
                   <!----><!----><!--[--><a class="tm-article-author__contact" data-test-id="author-contact-link" href="http://cloud4y.ru" rel="noopener" target="_blank">Сайт</a><a class="tm-article-author__contact" data-test-id="author-contact-link" href="https://vk.com/cloud4y" rel="noopener" target="_blank">ВКонтакте</a><a class="tm-article-author__contact" data-test-id="author-contact-link" href="https://telegram.me/cloud4y" rel="noopener" target="_blank">Telegram</a><!--]-->
                  </div>
                 </div><!--]-->
                </div><!--]--><!---->
               </section><!----><!--[-->
               <div class="banner-wrapper leaderboard tm-company-article__banner" style="--38f3d936:200px;--78a3cd06:auto;" data-v-f4bf0d24>
                <!--[-->
                <div class="placeholder-wrapper placeholder" data-v-f4bf0d24>
                 <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---->
                 <div class="adfox-banner-placeholder leaderboard" data-v-12f7bcca>
                  <div class="image loads" data-v-12f7bcca></div>
                  <div class="lines" data-v-12f7bcca>
                   <div class="line loads" data-v-12f7bcca></div>
                   <div class="line loads" data-v-12f7bcca></div>
                   <div class="line loads" data-v-12f7bcca></div>
                  </div>
                 </div><!----><!----><!---->
                </div>
                <div id="adfox_164725660339535756" class="tm-adfox-banner" data-v-f4bf0d24></div><!--]-->
               </div><!----><!--]--><!--]-->
               <div class="tm-article-blocks__comments">
                <div id="publication-comments" class="tm-article-page-comments">
                 <div>
                  <!--[-->
                  <div class="tm-article-comments-counter-link tm-article-comments-counter-button">
                   <a href="/ru/companies/cloud4y/articles/907232/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style" data-test-id="counter-comments"><!--[-->
                    <svg class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted" height="24" width="24">
                     <title>
                      Комментарии
                     </title><use xlink:href="/img/megazord-v28.7909a852..svg#counter-comments"></use>
                    </svg><span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted"> Комментировать </span><!--]--></a><!---->
                  </div><!--]-->
                 </div>
                </div>
               </div><!--[--><!--[--><!--]-->
               <section class="tm-block tm-block tm-block_spacing-bottom">
                <header class="tm-block__header tm-block__header tm-block__header_variant-borderless">
                 <div class="tm-block__header-container">
                  <h2 class="tm-block__title tm-block__title tm-block__title_variant-large">Публикации</h2><!--[--><!--]-->
                 </div><!---->
                </header><!--[-->
                <div class="tm-block__body tm-block__body tm-block__body_variant-condensed-slim">
                 <!--[--><!--[-->
                 <div class="tm-tabs tm-tabs">
                  <div class="">
                   <!--[--><span class="tm-tabs__tab-item">
                    <button class="tm-tabs__tab-link tm-tabs__tab-link_active tm-tabs__tab-link_slim tm-tabs__tab-link">Лучшие за сутки</button></span><span class="tm-tabs__tab-item">
                    <button class="tm-tabs__tab-link tm-tabs__tab-link_slim tm-tabs__tab-link">Похожие</button></span><!--]-->
                  </div><!---->
                 </div>
                 <div class="similar-and-daily__tab-view">
                  <div class="placeholder-wrapper">
                   <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---->
                   <div class="tm-placeholder-article-cards">
                    <!--[-->
                    <div class="tm-placeholder-article-card">
                     <div class="tm-placeholder__user">
                      <div class="tm-placeholder__user-pic loads"></div>
                      <div class="tm-placeholder__user-date loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__title">
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__icons tm-placeholder__counters">
                      <!--[-->
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div><!--]-->
                     </div>
                    </div>
                    <div class="tm-placeholder-article-card">
                     <div class="tm-placeholder__user">
                      <div class="tm-placeholder__user-pic loads"></div>
                      <div class="tm-placeholder__user-date loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__title">
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__icons tm-placeholder__counters">
                      <!--[-->
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div><!--]-->
                     </div>
                    </div>
                    <div class="tm-placeholder-article-card">
                     <div class="tm-placeholder__user">
                      <div class="tm-placeholder__user-pic loads"></div>
                      <div class="tm-placeholder__user-date loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__title">
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__icons tm-placeholder__counters">
                      <!--[-->
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div><!--]-->
                     </div>
                    </div>
                    <div class="tm-placeholder-article-card">
                     <div class="tm-placeholder__user">
                      <div class="tm-placeholder__user-pic loads"></div>
                      <div class="tm-placeholder__user-date loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__title">
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__icons tm-placeholder__counters">
                      <!--[-->
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div><!--]-->
                     </div>
                    </div>
                    <div class="tm-placeholder-article-card">
                     <div class="tm-placeholder__user">
                      <div class="tm-placeholder__user-pic loads"></div>
                      <div class="tm-placeholder__user-date loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__title">
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                      <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div>
                     </div>
                     <div class="tm-placeholder-article-card__icons tm-placeholder__counters">
                      <!--[-->
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div>
                      <div class="tm-placeholder-data-icon">
                       <div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div>
                       <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div>
                      </div><!--]-->
                     </div>
                    </div><!--]-->
                   </div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---->
                  </div><!---->
                 </div><!--]--><!--]-->
                </div><!--]--><!---->
               </section><!--[--><!--[-->
               <div>
                <div class="placeholder-wrapper">
                 <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---->
                 <div class="tm-placeholder-promo">
                  <div class="tm-placeholder-promo__header">
                   <div class="tm-placeholder__line tm-placeholder__line_promo-title"></div>
                  </div>
                  <div class="tm-placeholder-promo__body">
                   <div class="tm-placeholder-promo__posts">
                    <div class="tm-placeholder-promo__post">
                     <div class="tm-placeholder-promo__image"></div>
                     <div class="tm-placeholder__line tm-placeholder__line_post-title"></div>
                    </div>
                    <div class="tm-placeholder-promo__post">
                     <div class="tm-placeholder-promo__image"></div>
                     <div class="tm-placeholder__line tm-placeholder__line_post-title"></div>
                    </div>
                    <div class="tm-placeholder-promo__post">
                     <div class="tm-placeholder-promo__image"></div>
                     <div class="tm-placeholder__line tm-placeholder__line_post-title"></div>
                    </div>
                   </div>
                   <div class="tm-placeholder-promo__dots">
                    <div class="tm-placeholder-promo__dot"></div>
                    <div class="tm-placeholder-promo__dot"></div>
                    <div class="tm-placeholder-promo__dot"></div>
                   </div>
                  </div>
                 </div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---->
                </div>
               </div>
               <div class="placeholder-wrapper" data-async-called="true">
                <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---->
                <div class="tm-placeholder-inset tm-placeholder-vacancies">
                 <div class="tm-placeholder-inset__header">
                  <div class="tm-placeholder__line tm-placeholder__line_inset-header loads"></div>
                 </div>
                 <div class="tm-placeholder-inset__body">
                  <ul class="tm-placeholder-list">
                   <!--[-->
                   <li class="tm-placeholder-list__item tm-placeholder-list__item_inset">
                    <div class="tm-placeholder-list__title-container">
                     <div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div>
                    </div>
                    <div class="tm-project-block-items__properties">
                     <!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]-->
                    </div></li>
                   <li class="tm-placeholder-list__item tm-placeholder-list__item_inset">
                    <div class="tm-placeholder-list__title-container">
                     <div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div>
                    </div>
                    <div class="tm-project-block-items__properties">
                     <!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]-->
                    </div></li>
                   <li class="tm-placeholder-list__item tm-placeholder-list__item_inset">
                    <div class="tm-placeholder-list__title-container">
                     <div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div>
                    </div>
                    <div class="tm-project-block-items__properties">
                     <!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]-->
                    </div></li>
                   <li class="tm-placeholder-list__item tm-placeholder-list__item_inset">
                    <div class="tm-placeholder-list__title-container">
                     <div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div>
                    </div>
                    <div class="tm-project-block-items__properties">
                     <!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]-->
                    </div></li>
                   <li class="tm-placeholder-list__item tm-placeholder-list__item_inset">
                    <div class="tm-placeholder-list__title-container">
                     <div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div>
                    </div>
                    <div class="tm-project-block-items__properties">
                     <!--[--><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width:100px;"></span></span><!--]-->
                    </div></li><!--]-->
                  </ul>
                 </div>
                 <div class="tm-placeholder-inset__footer">
                  <div class="tm-placeholder__line tm-placeholder__line_inset-footer loads"></div>
                 </div>
                </div><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---->
               </div><!--]--><!--]--><!----><!--[--><!--]--><!--]-->
              </div><!--]--><!--]-->
             </div>
            </div><!--]--><!--]-->
           </div>
          </div>
          <div class="tm-page__sidebar">
           <!--[-->
           <div class="tm-layout-sidebar">
            <div class="tm-layout-sidebar__placeholder_initial"></div>
            <div class="tm-sexy-sidebar_initial tm-sexy-sidebar" style="margin-top:0px;">
             <!--[--><!--]--><!---->
             <div class="tm-layout-sidebar__ads_initial tm-layout-sidebar__ads">
              <div class="banner-wrapper half-page tm-layout-sidebar__banner tm-layout-sidebar__banner_top" style="--38f3d936:600px;--78a3cd06:auto;" data-v-f4bf0d24>
               <!--[-->
               <div class="placeholder-wrapper placeholder" data-v-f4bf0d24>
                <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---->
                <div class="adfox-banner-placeholder half-page" data-v-12f7bcca>
                 <div class="image loads" data-v-12f7bcca></div>
                 <div class="lines" data-v-12f7bcca>
                  <div class="line loads" data-v-12f7bcca></div>
                  <div class="line loads" data-v-12f7bcca></div>
                  <div class="line loads" data-v-12f7bcca></div>
                 </div>
                </div><!----><!----><!---->
               </div>
               <div id="adfox_164725680533065327" class="tm-adfox-banner" data-v-f4bf0d24></div><!--]-->
              </div>
             </div><!--[-->
             <section class="tm-block tm-block tm-block_spacing-bottom">
              <header class="tm-block__header tm-block__header">
               <div class="tm-block__header-container">
                <h2 class="tm-block__title tm-block__title">Информация</h2><!--[--><!--]-->
               </div><!---->
              </header><!--[-->
              <div class="tm-block__body tm-block__body">
               <!--[-->
               <div class="tm-company-basic-info">
                <dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap">
                 <dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap tm-description-list__title">
                  Сайт
                 </dt>
                 <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap tm-description-list__body">
                  <!--[--><a class="tm-company-basic-info__link" href="http://www.cloud4y.ru" target="_blank">www.cloud4y.ru</a><!--]-->
                 </dd>
                </dl>
                <dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap">
                 <dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap tm-description-list__title">
                  Дата регистрации
                 </dt>
                 <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap tm-description-list__body">
                  <!--[--><time datetime="2011-07-29T13:27:27.000Z" title="2011-07-29, 17:27">29 июля 2011</time><!--]-->
                 </dd>
                </dl>
                <dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap">
                 <dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap tm-description-list__title">
                  Дата основания
                 </dt>
                 <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap tm-description-list__body">
                  <!--[--><span>2009</span><!--]-->
                 </dd>
                </dl>
                <dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap">
                 <dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap tm-description-list__title">
                  Численность
                 </dt>
                 <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap tm-description-list__body">
                  <!--[-->51–100 человек<!--]-->
                 </dd>
                </dl>
                <dl class="tm-description-list tm-description-list tm-description-list_variant-columns-nowrap">
                 <dt class="tm-description-list__title tm-description-list__title_variant-columns-nowrap tm-description-list__title">
                  Местоположение
                 </dt>
                 <dd class="tm-description-list__body tm-description-list__body_variant-columns-nowrap tm-description-list__body">
                  <!--[-->Россия<!--]-->
                 </dd>
                </dl><!---->
               </div><!--]-->
              </div><!--]--><!---->
             </section>
             <div class="tm-company-widgets">
              <!--[--><!--]-->
             </div><!---->
             <div></div><!--]-->
             <div class="banner-wrapper medium-rectangle tm-layout-sidebar__banner tm-layout-sidebar__banner_bottom" style="--38f3d936:250px;--78a3cd06:auto;" data-v-f4bf0d24>
              <!--[-->
              <div class="placeholder-wrapper placeholder" data-v-f4bf0d24>
               <!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!---->
               <div class="adfox-banner-placeholder medium-rectangle" data-v-12f7bcca>
                <div class="image loads" data-v-12f7bcca></div>
                <div class="lines" data-v-12f7bcca>
                 <div class="line loads" data-v-12f7bcca></div>
                 <div class="line loads" data-v-12f7bcca></div>
                 <div class="line loads" data-v-12f7bcca></div>
                </div>
               </div><!----><!----><!---->
              </div>
              <div id="adfox_164725691003361602" class="tm-adfox-banner" data-v-f4bf0d24></div><!--]-->
             </div>
            </div>
           </div><!--]-->
          </div>
         </div><!----><!--]-->
        </div>
       </div>
      </main><!---->
     </div>
     <div class="tm-footer-menu">
      <div class="tm-page-width">
       <!--[-->
       <div class="tm-footer-menu__container">
        <!--[-->
        <div class="tm-footer-menu__block">
         <p class="tm-footer-menu__block-title">Ваш аккаунт</p>
         <div class="tm-footer-menu__block-content">
          <ul class="tm-footer-menu__list">
           <!--[-->
           <li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/companies/cloud4y/articles/907232/&amp;hl=ru" rel="nofollow" target="_self">Войти</a></li>
           <li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/companies/cloud4y/articles/907232/&amp;hl=ru" rel="nofollow" target="_self">Регистрация</a></li><!--]-->
          </ul>
         </div>
        </div>
        <div class="tm-footer-menu__block">
         <p class="tm-footer-menu__block-title">Разделы</p>
         <div class="tm-footer-menu__block-content">
          <ul class="tm-footer-menu__list">
           <!--[-->
           <li class="tm-footer-menu__list-item"><a href="/ru/articles/" class="footer-menu__item-link">Статьи</a></li>
           <li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">Новости</a></li>
           <li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">Хабы</a></li>
           <li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">Компании</a></li>
           <li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">Авторы</a></li>
           <li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">Песочница</a></li><!--]-->
          </ul>
         </div>
        </div>
        <div class="tm-footer-menu__block">
         <p class="tm-footer-menu__block-title">Информация</p>
         <div class="tm-footer-menu__block-content">
          <ul class="tm-footer-menu__list">
           <!--[-->
           <li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">Устройство сайта</a></li>
           <li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">Для авторов</a></li>
           <li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">Для компаний</a></li>
           <li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">Документы</a></li>
           <li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement/?hl=ru_RU" target="_blank">Соглашение</a></li>
           <li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/?hl=ru_RU" target="_blank">Конфиденциальность</a></li><!--]-->
          </ul>
         </div>
        </div>
        <div class="tm-footer-menu__block">
         <p class="tm-footer-menu__block-title">Услуги</p>
         <div class="tm-footer-menu__block-content">
          <ul class="tm-footer-menu__list">
           <!--[-->
           <li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/corporate-blogs/" target="_blank">Корпоративный блог</a></li>
           <li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/advertising/" target="_blank">Медийная реклама</a></li>
           <li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/native-special/" target="_blank">Нативные проекты</a></li>
           <li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/education-programs/" target="_blank">Образовательные программы</a></li>
           <li class="tm-footer-menu__list-item"><a href="https://company.habr.com/ru/hello-startup/" target="_blank">Стартапам</a></li><!--]-->
          </ul>
         </div>
        </div><!--]-->
       </div><!--]-->
      </div>
     </div>
     <div class="tm-footer">
      <div class="tm-page-width">
       <!--[-->
       <div class="tm-footer__container">
        <!---->
        <div class="tm-footer__social">
         <!--[--><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank">
          <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
           <title>
            Facebook
           </title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-facebook"></use>
          </svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank">
          <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
           <title>
            Twitter
           </title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-twitter"></use>
          </svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank">
          <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
           <title>
            VK
           </title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-vk"></use>
          </svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank">
          <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
           <title>
            Telegram
           </title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-telegram"></use>
          </svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank">
          <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
           <title>
            Youtube
           </title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-youtube"></use>
          </svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://dzen.ru/habr" rel="nofollow noopener noreferrer" target="_blank">
          <svg class="tm-svg-img tm-svg-icon" height="24" width="24">
           <title>
            Яндекс Дзен
           </title><use xlink:href="/img/new-social-icons-sprite.svg#social-logo-dzen"></use>
          </svg></a><!--]-->
        </div><!--teleport start--><!--teleport end-->
        <button class="tm-footer__link"><!----> Настройка языка</button><a href="/ru/feedback/" class="tm-footer__link">Техническая поддержка</a>
        <div class="tm-footer-copyright">
         <span class="tm-copyright"><span class="tm-copyright__years">© 2006–2025, </span><span class="tm-copyright__name"><a class="tm-copyright__link" href="https://company.habr.com/" rel="noopener" target="_blank">Habr</a></span></span>
        </div>
       </div><!--]-->
      </div>
     </div><!----><!--]-->
    </div><!---->
   </div>
   <script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"907232":{"id":"907232","timePublished":"2025-05-06T07:13:08+00:00","isCorporative":true,"lang":"ru","titleHtml":"Zabbix. Мониторинг больших рассылок","leadData":{"textHtml":"\u003Cp\u003EПривет! На связи Виктор Лысенко из Cloud4Y. Сегодня хочу рассказать о массовых рассылках и способах борьбы с ними. \u003C\u002Fp\u003E\u003Cp\u003EКейс исключительно практический: возникла необходимость предупреждать и отслеживать потенциальных спамеров (входящих и исходящих). И я решил вывести большие рассылки в Zabbix со следующими полями писем Exchange:\u003C\u002Fp\u003E","imageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F856\u002F2db\u002Face\u002F8562dbace864d371b0ccfd0c83b7912c.png","buttonTextHtml":"Читать далее","image":{"url":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F856\u002F2db\u002Face\u002F8562dbace864d371b0ccfd0c83b7912c.png","fit":"cover","positionY":5,"positionX":50}},"editorVersion":"2.0","postType":"article","postLabels":[],"author":{"id":"64252","alias":"Cloud4Y","fullname":"Cloud4Y","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fc2d\u002Fd0d\u002Fc05\u002Fc2dd0dc05834aebeb86bb76e35caeaab.png","speciality":"Корпоративный облачный провайдер","scoreStats":{"score":206,"votesCount":406},"rating":43.8,"relatedData":null,"contacts":[{"title":"Сайт","url":"http:\u002F\u002Fcloud4y.ru","value":"http:\u002F\u002Fcloud4y.ru","siteTitle":null,"favicon":null},{"title":"ВКонтакте","url":"https:\u002F\u002Fvk.com\u002Fcloud4y","value":"cloud4y","siteTitle":null,"favicon":null},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Fcloud4y","value":"cloud4y","siteTitle":null,"favicon":null}],"authorContacts":[{"title":"Сайт","url":"http:\u002F\u002Fcloud4y.ru","value":"http:\u002F\u002Fcloud4y.ru","siteTitle":null,"favicon":null},{"title":"ВКонтакте","url":"https:\u002F\u002Fvk.com\u002Fcloud4y","value":"cloud4y","siteTitle":null,"favicon":null},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Fcloud4y","value":"cloud4y","siteTitle":null,"favicon":null}],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"donationsMethod":null,"isInBlacklist":null,"careerProfile":null},"statistics":{"commentsCount":0,"favoritesCount":12,"readingCount":1559,"score":6,"votesCount":6,"votesCountPlus":6,"votesCountMinus":0},"hubs":[{"id":"17352","alias":"cloud4y","type":"corporative","title":"Блог компании Cloud4Y","titleHtml":"Блог компании Cloud4Y","isProfiled":false,"relatedData":null},{"id":"221","alias":"sys_admin","type":"collective","title":"Системное администрирование","titleHtml":"Системное администрирование","isProfiled":true,"relatedData":null},{"id":"6398","alias":"it-infrastructure","type":"collective","title":"IT-инфраструктура","titleHtml":"IT-инфраструктура","isProfiled":true,"relatedData":null},{"id":"28","alias":"spam","type":"collective","title":"Спам и антиспам","titleHtml":"Спам и антиспам","isProfiled":false,"relatedData":null},{"id":"21470","alias":"cloud_services","type":"collective","title":"Облачные сервисы","titleHtml":"Облачные сервисы","isProfiled":true,"relatedData":null}],"flows":[{"id":"6","alias":"admin","title":"Администрирование","titleHtml":"Администрирование"}],"relatedData":{"vote":null,"unreadCommentsCount":0,"bookmarked":false,"canComment":false,"canEdit":false,"canViewVotes":false,"votePlus":{"canVote":false,"isChargeEnough":false,"isKarmaEnough":false,"isVotingOver":false,"isPublicationLimitEnough":false},"voteMinus":{"canVote":false,"isChargeEnough":false,"isKarmaEnough":false,"isVotingOver":false,"isPublicationLimitEnough":false},"canModerateComments":false,"trackerSubscribed":false,"emailSubscribed":false},"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cfigure class=\"full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F77a\u002Ff12\u002F37c\u002F77af1237c4ee0d914bf11880a08afa2d.png\" width=\"810\" height=\"262\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F77a\u002Ff12\u002F37c\u002F77af1237c4ee0d914bf11880a08afa2d.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F77a\u002Ff12\u002F37c\u002F77af1237c4ee0d914bf11880a08afa2d.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EПривет! На связи Виктор Лысенко из Cloud4Y. Сегодня хочу рассказать о массовых рассылках и способах борьбы с ними. \u003C\u002Fp\u003E\u003Cp\u003EКейс исключительно практический: возникла необходимость предупреждать и отслеживать потенциальных спамеров (входящих и исходящих). И я решил вывести большие рассылки в Zabbix со следующими полями писем \u003Ca href=\"https:\u002F\u002Fwww.cloud4y.ru\u002Fcloud-services\u002Fcorporate-mail\u002F?utm_source=habr&amp;utm_medium=article&amp;utm_campaign=article&amp;utm_content=corporate-mail\"\u003EExchange\u003C\u002Fa\u003E:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EDomain\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003ETimestamp\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003ESender\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003ERecipientCount\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003ESubject\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EInternalMessageId\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cdetails class=\"spoiler\"\u003E\u003Csummary\u003EПримерный план работ:\u003C\u002Fsummary\u003E\u003Cdiv class=\"spoiler__content\"\u003E\u003Col\u003E\u003Cli\u003E\u003Cp\u003EПодготовить скрипт, генерирующий .json и поместить его в планировщик задач\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EДобавить UserParameter в конфигурацию Zabbix (zabbix_agentd.conf)\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EДобавляем макрос для поля RecipientCount в шаблон\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EСоздать главный элемент данных\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EСоздание зависимого правила обнаружения\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EСоздание прототипа элемента данных\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EСоздание прототипа триггера\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EПрименение шаблона на Exchange сервера\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Fol\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdetails\u003E\u003Ch3\u003EПодготовка скрипта\u003C\u002Fh3\u003E\u003Cp\u003EПодготовлен скрипт, который собирает все \u003Cu\u003Eполученные и отправленные\u003C\u002Fu\u003E письма текущим сервером, с количеством получателей более двух (переменная \u003Cstrong\u003E$Limit\u003C\u002Fstrong\u003E) и выгружает в json‑файл. Дальнейшая фильтрация по количеству получателей будет производится в Zabbix через макрос \u003Cstrong\u003E{$BIG_MAIL_TRIGGER}\u003C\u002Fstrong\u003E. \u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003EAdd-PSSnapin Microsoft.Exchange.Management.PowerShell.E2010\n\n$Utf8NoBomEncoding = New-Object System.Text.Utf8Encoding\n$RunServer = $env:COMPUTERNAME\n$Limit = 2\n$OutFile = \"D:\\Scripts\\Zabbix\\Results\\zabbix_big_mailings.json\"\n\n[System.Collections.ArrayList]$Status = @()\n\n$Nums  = Get-MessageTrackingLog -Server $RunServer -EventId \"EXPAND\" -Resultsize Unlimited -Start (Get-Date).AddDays(-3)  | ?{$_.RecipientCount -gt $Limit}\n\nForEach ($Num in $Nums) { \n    $Status += [PSCustomObject]@{\n        'Domain'            = ($Num.sender).split(\"@\")[1]\n        'Timestamp'         = [string]$Num.Timestamp\n        'Sender'            = [string]$Num.Sender\n        'RecipientCount'    = [int]$Num.RecipientCount\n        'Subject'           = [string]$Num.MessageSubject\n        'InternalMessageId' = [string]$Num.InternalMessageId}\n}\n\n#Генерируем заглушку, если нет данных после выборки\nif ($Nums.count -eq 0){\n    $Status += ,[PSCustomObject]@{\n        'Domain'            = \"domain.com\"\n        'Timestamp'         = \"01\u002F01\u002F1900 00:00:0\"\n        'Sender'            = \"debug@domain.com\"\n        'RecipientCount'    = 0\n        'Subject'           = \"Only if $Nums = 0, stub for zabbix\"\n        'InternalMessageId' = \"0123456789ABCDE\"}\n}\n\nif ($Nums.Count -eq 1) {[array]$Sorted = @($Status) | Sort Domain} else {$Sorted = $Status | Sort Domain}\n$MyRawString = ,$Sorted | ConvertTo-Json -Depth 5\n[System.IO.File]::WriteAllLines($OutFile, $MyRawString, $Utf8NoBomEncoding)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EВ моём примере команда «(Get‑Date).AddDays(-3)» получает выборку за последние три дня. Можно, например, установить выборку за последние 6 часов: «(Get‑Date).AddHours(-6)». \u003C\u002Fp\u003E\u003Cp\u003EПример JSON‑файла:\u003C\u002Fp\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8df\u002Ff21\u002F4e8\u002F8dff214e84c28bf591e2130ab798d605.png\" width=\"540\" height=\"176\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8df\u002Ff21\u002F4e8\u002F8dff214e84c28bf591e2130ab798d605.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8df\u002Ff21\u002F4e8\u002F8dff214e84c28bf591e2130ab798d605.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EРазмещаем выполнение скрипта в планировщике задач:\u003C\u002Fp\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F136\u002F2cb\u002F317\u002F1362cb31791593f195e1f5cfd452f3fa.png\" width=\"844\" height=\"94\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F136\u002F2cb\u002F317\u002F1362cb31791593f195e1f5cfd452f3fa.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F136\u002F2cb\u002F317\u002F1362cb31791593f195e1f5cfd452f3fa.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003E2. Добавить UserParameter в конфигурацию Zabbix\u003C\u002Fh3\u003E\u003Cp\u003EВ файл конфигурации \u003Cstrong\u003Ezabbix_agentd.conf\u003C\u002Fstrong\u003E добавляем пользовательский параметр с ключом \u003Cstrong\u003Eexchange.big.mail.get\u003C\u002Fstrong\u003E, можно указать любой другой ключ, просто в следующем пункте нужно будет указать именно этот ключ. \u003C\u002Fp\u003E\u003Cp\u003EПо этому ключу zabbix будет получать .json, созданный в предыдущем пункте при выполнении скрипта:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003EUserParameter = exchange.big.mailings.get, type D:\\Scripts\\Zabbix\\EX01\\zabbix_big_mailings.json\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cp\u003EПосле внесения изменений в \u003Cstrong\u003Ezabbix_agentd.conf\u003C\u002Fstrong\u003E не забываем перезапустить службу «Zabbix Agent».\u003C\u002Fp\u003E\u003Ch3\u003E3. Добавление макроса в шаблон\u003C\u002Fh3\u003E\u003Cp\u003EСоздаём \u003Cu\u003Eновый шаблон или используем другой\u003C\u002Fu\u003E. Важно добавить макрос «{$BIG_MAIL_TRIGGER}». Этот макрос устанавливает пороговое значение для перехода на следующий этап, то есть срабатывания триггера.\u003C\u002Fp\u003E\u003Cp\u003EВ моём примере порог срабатывания 100 получателей — RecipientCount:\u003C\u002Fp\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fea4\u002Fa51\u002F424\u002Fea4a51424883818e3cabbb5d72e0c12b.png\" width=\"942\" height=\"259\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fea4\u002Fa51\u002F424\u002Fea4a51424883818e3cabbb5d72e0c12b.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fea4\u002Fa51\u002F424\u002Fea4a51424883818e3cabbb5d72e0c12b.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003E4. Создаём главный элемент данных Zabbix\u003C\u002Fh3\u003E\u003Cp\u003E\u003Cstrong\u003EГлавный элемент данных (Master Item)\u003C\u002Fstrong\u003E — это обычный элемент данных (Item) в Zabbix, который хранит «сырые» данные (например, JSON), используемые другими зависимыми элементами (\u003Cstrong\u003EDependent Items\u003C\u002Fstrong\u003E) или правилами обнаружения (\u003Cstrong\u003ELLD Rules\u003C\u002Fstrong\u003E).\u003C\u002Fp\u003E\u003Cp\u003EСоздаём новый элемент данных.. Здесь при создании важно указать:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003Eтип — «Zabbix Agent»\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003Eключ — указанный ранее в пункте 2, в «UserParameter». В моём случае — «exchange.big.mailings.get»\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd53\u002F5dd\u002Fc21\u002Fd535ddc21533131f48200cf72cf6d81f.png\" width=\"940\" height=\"534\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd53\u002F5dd\u002Fc21\u002Fd535ddc21533131f48200cf72cf6d81f.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd53\u002F5dd\u002Fc21\u002Fd535ddc21533131f48200cf72cf6d81f.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EДалее нужно сделать предобработку, отфильтровать элементы массива, добавляем зависимость от макроса «{$BIG_MAIL_TRIGGER}» во вкладке «Предобработка». Я опишу два варианта:\u003C\u002Fp\u003E\u003Cp\u003EА. Логичнее это реализовать с помощью JSONPath — «$.value[?(@.RecipientCount &gt;= {$BIG_MAIL_TRIGGER})]»:\u003C\u002Fp\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F238\u002F22e\u002F5b4\u002F23822e5b4bde0b9f45678b99f2d04724.png\" width=\"943\" height=\"248\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F238\u002F22e\u002F5b4\u002F23822e5b4bde0b9f45678b99f2d04724.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F238\u002F22e\u002F5b4\u002F23822e5b4bde0b9f45678b99f2d04724.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EНо в случае, когда после фильтрации не останется элементов, Zabbix \u003Cstrong\u003Eвернёт ошибку, не пустой массив: \u003C\u002Fstrong\u003E«cannot extract value from json by path \"$..[?(@.RecipientCount &gt;= {$BIG_MAIL_TRIGGER})]\": no data matches the specified path». Что \u003Cstrong\u003EНЕ \u003C\u002Fstrong\u003Eзапустит процесс обновления элементов данных и триггеров. \u003C\u002Fp\u003E\u003Cp\u003EНа практике это означает, что старые триггеры будут висеть до тех пор, пока не выполнится условие в JSONPath и уже следующий массив «спамеров» не пойдёт в генерацию новых элементов данных и триггеров. В некоторых случаях это может пригодится — всегда наблюдать последних спамеров. \u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E«\u003Cstrong\u003E$\u003C\u002Fstrong\u003E»\u003Cstrong\u003E \u003C\u002Fstrong\u003E— корневой элемент JSON-документа.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E«\u003Cstrong\u003Evalue\u003C\u002Fstrong\u003E»\u003Cstrong\u003E \u003C\u002Fstrong\u003E— поиск в пределах массива \u003Cstrong\u003Evalue \u003C\u002Fstrong\u003E(нерекурсивный).\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E«\u003Cstrong\u003E[?(@.RecipientCount &gt;= {$BIG_MAIL_TRIGGER})]\u003C\u002Fstrong\u003E»\u003Cstrong\u003E \u003C\u002Fstrong\u003E— это фильтр, который применяется к каждому элементу массива или объекту, найденному на предыдущем шаге. Разберём его подробнее:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003E«\u003Cstrong\u003E?\u003C\u002Fstrong\u003E»\u003Cstrong\u003E \u003C\u002Fstrong\u003E— обозначает начало фильтра.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E«\u003Cstrong\u003E@\u003C\u002Fstrong\u003E»\u003Cstrong\u003E \u003C\u002Fstrong\u003E— текущий элемент, который проверяется.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E«\u003Cstrong\u003E.RecipientCount\u003C\u002Fstrong\u003E» — обращение к полю \u003Cstrong\u003E«RecipientCount» \u003C\u002Fstrong\u003Eтекущего элемента.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E«\u003Cstrong\u003E&gt;= {$BIG_MAIL_TRIGGER}\u003C\u002Fstrong\u003E» — условие, при котором значение поля \u003Cstrong\u003E«RecipientCount» \u003C\u002Fstrong\u003Eдолжно быть больше или равно значению макроса(переменной) \u003Cstrong\u003E«{$BIG_MAIL_TRIGGER}»\u003C\u002Fstrong\u003E.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EБ. Но я реализую с помощью JavaScript, с условием если нет элементов, то вернётся пустой массив:\u003C\u002Fp\u003E\u003Cpre\u003E\u003Ccode\u003Etry {\n    var threshold = Number(\"{$BIG_MAIL_TRIGGER}\"); \u002F\u002F Преобразуем макрос в число\n    var data = JSON.parse(value); \u002F\u002F Разбираем JSON\n    \n    if (!data.value || typeof data.value !== \"object\") {\n        return \"[]\"; \u002F\u002F Если нет массива, возвращаем пустой массив\n    }\n\n    var result = [];\n    for (var i = 0; i &lt; data.value.length; i++) {\n        if (data.value[i].RecipientCount &gt;= threshold) {\n            result.push(data.value[i]); \u002F\u002F Добавляем элемент в результат, если проходит фильтр\n        }\n    }\n\n    return JSON.stringify(result); \u002F\u002F Возвращаем отфильтрованный JSON\n} catch (e) {\n    return \"[]\"; \u002F\u002F В случае ошибки возвращаем пустой массив\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0ce\u002F64b\u002Fb70\u002F0ce64bb70c1cb594fe7f2d76c426d20b.png\" width=\"941\" height=\"246\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0ce\u002F64b\u002Fb70\u002F0ce64bb70c1cb594fe7f2d76c426d20b.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0ce\u002F64b\u002Fb70\u002F0ce64bb70c1cb594fe7f2d76c426d20b.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003E5. Создаём правило обнаружения\u003C\u002Fh3\u003E\u003Cp\u003EВ Zabbix \u003Cstrong\u003Eправило обнаружения\u003C\u002Fstrong\u003E (Discovery Rule) — это механизм, который позволяет автоматически обнаруживать и создавать объекты мониторинга (например, элементы данных, триггеры, графики) на основе динамически собираемых данных. Это особенно полезно для мониторинга систем, где количество объектов может меняться, например, сетевые интерфейсы, диски, сервисы, виртуальные машины и т. д.\u003C\u002Fp\u003E\u003Cp\u003EВ нашем случае правило обнаружения анализирует полученный JSON, и извлекает из него массив объектов рассылки. На основе обнаруженных объектов Zabbix автоматически создает элементы данных и триггеры.\u003C\u002Fp\u003E\u003Cp\u003EСоздаём правило обнаружения. Правило следует связать с главным элементом данных созданном в предыдущем пункте. Связь устанавливается указанием двух полей:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EТип — «Зависимый элемент данных»\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EОсновной элемент данных — указываем имя главного элемента данных из п.4.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cem\u003EИмя и остальные параметры, устанавливаем на своё усмотрение\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fdb3\u002F3d9\u002F3a0\u002Fdb33d93a009b68a89cea563298a134f0.png\" width=\"769\" height=\"325\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fdb3\u002F3d9\u002F3a0\u002Fdb33d93a009b68a89cea563298a134f0.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fdb3\u002F3d9\u002F3a0\u002Fdb33d93a009b68a89cea563298a134f0.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EПравило обнаружения понадобилось, чтобы использовать функциональность \u003Ca href=\"https:\u002F\u002Fwww.zabbix.com\u002Fdocumentation\u002Fcurrent\u002Fen\u002Fmanual\u002Fconfig\u002Fmacros\u002Flld_macros\"\u003ELLD (Low Level Discovery) макросов\u003C\u002Fa\u003E в прототипах триггера и элемента данных. Добавляем LLD макросы:\u003C\u002Fp\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5b9\u002F677\u002F0ac\u002F5b96770ac3e3e2d6a57bd85d52b20df8.png\" width=\"844\" height=\"287\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5b9\u002F677\u002F0ac\u002F5b96770ac3e3e2d6a57bd85d52b20df8.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5b9\u002F677\u002F0ac\u002F5b96770ac3e3e2d6a57bd85d52b20df8.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003ELLD макросы:\u003C\u002Fp\u003E\u003Cdiv\u003E\u003Cdiv class=\"table\"\u003E\u003Ctable\u003E\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"left\"\u003E\u003Cstrong\u003EМакрос\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"left\"\u003E\u003Cstrong\u003EJSONPath\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"left\"\u003E{#BIGMAILINGSORG}\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"left\"\u003E$.Domain\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"left\"\u003E{#BIGMAILINGSTIMESTAMP} \u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"left\"\u003E$.Timestamp\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"left\"\u003E{#ID}\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"left\"\u003E$.InternalMessageId\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"left\"\u003E{#MAILSCOUNT} \u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"left\"\u003E$.RecipientCount\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"left\"\u003E{#SENDER}\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"left\"\u003E$.Sender\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp align=\"left\"\u003E{#SUBJECT}\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003Ctd\u003E\u003Cp align=\"left\"\u003E$.Subject\u003C\u002Fp\u003E\u003C\u002Ftd\u003E\u003C\u002Ftr\u003E\u003C\u002Ftbody\u003E\u003C\u002Ftable\u003E\u003C\u002Fdiv\u003E\u003C\u002Fdiv\u003E\u003Cp\u003EКоличество макросов можно расширить, для этого достаточно указать нужные поля, которые требуется добавить в выходной JSON, используя скрипт в п.1.\u003C\u002Fp\u003E\u003Ch3\u003E6. Создаём прототип элемента данных\u003C\u002Fh3\u003E\u003Cp\u003EОграничение Zabbix: \u003Cstrong\u003Eзависимый элемент данных \u003C\u002Fstrong\u003E(\u003Cstrong\u003EDependent Item) нельзя привязать напрямую к правилу обнаружения (Discovery Rule)\u003C\u002Fstrong\u003E. Это связано с архитектурой Zabbix — Зависимый элемент данных может зависеть только от другого элемента данных (Item), а не от LLD‑правила.\u003C\u002Fp\u003E\u003Cp\u003EЕсли бы не это ограничение, элемент данных (п.4), можно было бы не создавать, а прототип привязать сразу к правилу обнаружения.\u003C\u002Fp\u003E\u003Cp\u003EСоздаём прототип элемента данных. Правило следует связать с элементом данных созданным в п.4. — поля «Тип» и «Основной элемент данных», заполняем и другие поля:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EТип — «Зависимый элемент данных»\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EОсновной элемент данных — указываем имя главного элемента данных из п.4.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cem\u003EИмя\u003C\u002Fem\u003E — имя должно быть уникальным, не повторять даже макросы\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cem\u003EКлюч\u003C\u002Fem\u003E — по ключу будет обращение триггера, важно указать макрос «{#ID}» в качестве параметра\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cem\u003EТип информации\u003C\u002Fem\u003E — Числовой, так как будет возвращаться «RecipientCount»\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003E\u003Cem\u003EОстальные параметры устанавливаем на своё усмотрение\u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0c1\u002F12e\u002F196\u002F0c112e1969a3ffdd2dc31fd7fa8ea3dc.png\" width=\"942\" height=\"526\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0c1\u002F12e\u002F196\u002F0c112e1969a3ffdd2dc31fd7fa8ea3dc.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F0c1\u002F12e\u002F196\u002F0c112e1969a3ffdd2dc31fd7fa8ea3dc.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EДалее во вкладке «Предобработка» добавляем условия возврата «RecipientCount» для рассылки с указанным «{#ID}».\u003C\u002Fp\u003E\u003Cp\u003EПоле JSONPath - «$[?(@.InternalMessageId==\"{#ID}\")].RecipientCount»:\u003C\u002Fp\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbc1\u002F3a3\u002Fe33\u002Fbc13a3e332342bbc0a58630b899e6957.png\" width=\"941\" height=\"308\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbc1\u002F3a3\u002Fe33\u002Fbc13a3e332342bbc0a58630b899e6957.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbc1\u002F3a3\u002Fe33\u002Fbc13a3e332342bbc0a58630b899e6957.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EТак как значение возвращается в квадратных скобках, просто обрезаем их с помощью правил предобработки.\u003C\u002Fp\u003E\u003Cp\u003EПроверяем с заранее подготовленным массивом. Результат тестирования правил предобработки для рассылки с {#ID} = 31 628 139 167 757, вернул количество получателей — 3:\u003C\u002Fp\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff9a\u002F9ab\u002F263\u002Ff9a9ab2639265d1f927a3991cf65d287.png\" width=\"768\" height=\"378\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff9a\u002F9ab\u002F263\u002Ff9a9ab2639265d1f927a3991cf65d287.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff9a\u002F9ab\u002F263\u002Ff9a9ab2639265d1f927a3991cf65d287.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Ch3\u003E7. Создаём прототип триггера\u003C\u002Fh3\u003E\u003Cp\u003EВот здесь нам и потребуется указать LLD макросы, в полях:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003E\u003Cp\u003EИмя — «_BigMail: {#SENDER} send {#MAILSCOUNT} messages at {#BIGMAILINGSTIMESTAMP}, Subject: {#SUBJECT}»\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003Cli\u003E\u003Cp\u003EВыражение — «last(\u002FTemplate Microsoft Exchange PS Checks\u002Fexchange.big.mailings.getstatus[{#ID}])&gt;{$BIG_MAIL_TRIGGER}»\u003C\u002Fp\u003E\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fece\u002F5ac\u002F609\u002Fece5ac609e76d4e7e48a1ced27a1023c.png\" width=\"942\" height=\"585\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fece\u002F5ac\u002F609\u002Fece5ac609e76d4e7e48a1ced27a1023c.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fece\u002F5ac\u002F609\u002Fece5ac609e76d4e7e48a1ced27a1023c.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EИмя триггера (поле «Имя») при подстановке макросов будет выглядеть примерно так: «_BigMail: \u003Ca href=\"mailto:debug@domain.com\"\u003Edebug@domain.com\u003C\u002Fa\u003E send 200 messages at 01\u002F01\u002F1900 00:00:00, Subject: Stub For Zabbix»\u003C\u002Fp\u003E\u003Cp\u003EА поле «Выражение» — это условие срабатывание\u002Fотображения триггера. Это выражение вызывает прототип элемента данных с макросом\\переменной {#ID} письма, и полученный результат сравнивает с {$BIG_MAIL_TRIGGER}  - «RecipientCount &gt; {$BIG_MAIL_TRIGGER}». Если соблюдено условие, то срабатывает триггер.\u003C\u002Fp\u003E\u003Ch3\u003E8. Применяем подготовленный шаблон на сервер Exchange\u003C\u002Fh3\u003E\u003Cp\u003EВ свойствах узла сети выбираем шаблон и нажимаем «Обновить». Нужно время, чтобы шаблон применился и создались элементы данных и триггеры.\u003C\u002Fp\u003E\u003Cfigure class=\"bordered full-width \"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F716\u002F4c0\u002F6c7\u002F7164c06c7bada3381a00ea2070a239ef.png\" width=\"942\" height=\"543\" sizes=\"(max-width: 780px) 100vw, 50vw\" srcset=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F716\u002F4c0\u002F6c7\u002F7164c06c7bada3381a00ea2070a239ef.png 780w,&#10;       https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F716\u002F4c0\u002F6c7\u002F7164c06c7bada3381a00ea2070a239ef.png 781w\" loading=\"lazy\" decode=\"async\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp\u003EВот так можно поколдовать с почтой. Есть идеи, как можно сделать лучше? Я с интересом выслушаю.\u003C\u002Fp\u003E\u003Cp\u003EСпасибо за внимание, ваш \u003Ca href=\"https:\u002F\u002Fwww.cloud4y.ru\u002F?utm_source=habr&amp;utm_medium=article&amp;utm_campaign=habr&amp;utm_content=ai-gpu-main\"\u003ECloud4Y\u003C\u002Fa\u003E. Читайте нас здесь или в \u003Ca href=\"https:\u002F\u002Ft.me\u002F+ET_qtHM8_540Nzhi\"\u003ETelegram‑канале\u003C\u002Fa\u003E!  \u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"антиспам"},{"titleHtml":"Zabbix"},{"titleHtml":"Exchange"},{"titleHtml":"рассылки"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F856\u002F2db\u002Face\u002F8562dbace864d371b0ccfd0c83b7912c.png","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F856\u002F2db\u002Face\u002F8562dbace864d371b0ccfd0c83b7912c.png","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompanies\\\u002Fcloud4y\\\u002Farticles\\\u002F907232\\\u002F\"},\"headline\":\"Zabbix. Мониторинг больших рассылок\",\"datePublished\":\"2025-05-06T10:13:08+03:00\",\"dateModified\":\"2025-05-07T00:56:07+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Cloud4Y\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Привет! На связи Виктор Лысенко из Cloud4Y. Сегодня хочу рассказать о массовых рассылках и способах борьбы с&nbsp;ними. Кейс исключительно практический: возникла необ...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompanies\\\u002Fcloud4y\\\u002Farticles\\\u002F907232\\\u002F#post-content-body\",\"about\":[\"c_cloud4y\",\"h_sys_admin\",\"h_it-infrastructure\",\"h_spam\",\"h_cloud_services\",\"f_admin\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F907232\\\u002Fac6e078ff802952e29fbd0f04c4b1921\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F77a\\\u002Ff12\\\u002F37c\\\u002F77af1237c4ee0d914bf11880a08afa2d.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F8df\\\u002Ff21\\\u002F4e8\\\u002F8dff214e84c28bf591e2130ab798d605.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F136\\\u002F2cb\\\u002F317\\\u002F1362cb31791593f195e1f5cfd452f3fa.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fea4\\\u002Fa51\\\u002F424\\\u002Fea4a51424883818e3cabbb5d72e0c12b.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fd53\\\u002F5dd\\\u002Fc21\\\u002Fd535ddc21533131f48200cf72cf6d81f.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F238\\\u002F22e\\\u002F5b4\\\u002F23822e5b4bde0b9f45678b99f2d04724.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F0ce\\\u002F64b\\\u002Fb70\\\u002F0ce64bb70c1cb594fe7f2d76c426d20b.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fdb3\\\u002F3d9\\\u002F3a0\\\u002Fdb33d93a009b68a89cea563298a134f0.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F5b9\\\u002F677\\\u002F0ac\\\u002F5b96770ac3e3e2d6a57bd85d52b20df8.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F0c1\\\u002F12e\\\u002F196\\\u002F0c112e1969a3ffdd2dc31fd7fa8ea3dc.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fbc1\\\u002F3a3\\\u002Fe33\\\u002Fbc13a3e332342bbc0a58630b899e6957.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Ff9a\\\u002F9ab\\\u002F263\\\u002Ff9a9ab2639265d1f927a3991cf65d287.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fece\\\u002F5ac\\\u002F609\\\u002Fece5ac609e76d4e7e48a1ced27a1023c.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F716\\\u002F4c0\\\u002F6c7\\\u002F7164c06c7bada3381a00ea2070a239ef.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F856\\\u002F2db\\\u002Face\\\u002F8562dbace864d371b0ccfd0c83b7912c.png\"]}","metaDescription":"Привет! На связи Виктор Лысенко из Cloud4Y. Сегодня хочу рассказать о массовых рассылках и способах борьбы с&nbsp;ними. Кейс исключительно практический: возникла необходимость предупреждать и...","mainImageUrl":null,"amp":true,"customTrackerLinks":[]},"polls":[],"commentsEnabled":{"status":true,"reason":null},"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"hasPinnedComments":false,"format":"tutorial","banner":null,"multiwidget":null,"multiwidgetUuid":null,"readingTime":7,"complexity":"low","isEditorial":false,"allowedFeatures":{"isTestTargetAllow":true}}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"postReasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"viewedPosts":[],"myFeedFilter":{"complexity":"all","score":"all","types":["articles","posts","news"]},"myFeedIsApplyFilters":false,"myFeedIsForce":false,"karma":{"userReasonsList":null}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":""},"comments":{"articleComments":{},"articlePinnedComments":{},"searchCommentsResults":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":"","idempotenceKey":""}},"companies":{"companyRefs":{"cloud4y":{"alias":"cloud4y","imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcompany\u002F9d5\u002Fc09\u002Ff08\u002F9d5c09f082a1df6cef1fe1ec3acdd0b9.png","titleHtml":"Cloud4Y","descriptionHtml":"#1 Корпоративный облачный провайдер","relatedData":null,"statistics":{"subscribersCount":743,"rating":83.08,"invest":null,"postsCount":605,"threadsCount":2,"newsCount":99,"vacanciesCount":0,"employeesCount":5,"careerRating":null},"foundationDate":{"year":"2009","month":null,"day":null},"location":{"city":{"id":"447159","title":"Москва"},"region":{"id":"1885","title":"Москва и Московская обл."},"country":{"id":"168","title":"Россия"}},"siteUrl":"http:\u002F\u002Fwww.cloud4y.ru","staffNumber":"51–100 человек","registrationDate":"2011-07-29T13:27:27+00:00","representativeUser":null,"contacts":[{"title":"Сайт","url":"http:\u002F\u002Fwww.cloud4y.ru\u002F","siteTitle":"Облачная инфраструктура и сервисы для бизнеса | Cloud4Y","favicon":"https:\u002F\u002Fwww.cloud4y.ru\u002Ffavicon.ico"},{"title":"Facebook","url":"https:\u002F\u002Ffacebook.com\u002Fcloud4y","siteTitle":"Facebooki sisselogimine","favicon":"https:\u002F\u002Fstatic.xx.fbcdn.net\u002Frsrc.php\u002FyB\u002Fr\u002F2sFJRNmJ5OP.ico"},{"title":"X","url":"https:\u002F\u002Fx.com\u002FCloud4Y","siteTitle":null,"favicon":null},{"title":"ВКонтакте","url":"https:\u002F\u002Fvk.com\u002Fcloud4y","siteTitle":"VK | VK","favicon":"https:\u002F\u002Fm.vk.com\u002Fimages\u002Ficons\u002Ffavicons\u002Ffav_logo.ico?10"},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Fcloud4y","siteTitle":"Telegram: View @cloud4y","favicon":"https:\u002F\u002Ftelegram.org\u002Fimg\u002Fwebsite_icon.svg?4"}],"settings":{"analyticsSettings":[{"type":"ga","trackingId":"UA-73807615-3"}],"branding":null,"status":"active","isStartup":false,"hasActivePolls":false,"shouldShowHabrAds":true},"metadata":{"titleHtml":"Cloud4Y, Москва - #1 Корпоративный облачный провайдер с 2009 год","title":"Cloud4Y, Москва - #1 Корпоративный облачный провайдер с 2009 год","keywords":["ии","дата-центр","безопасность","microsoft","разработка"],"descriptionHtml":"605 статей от авторов компании Cloud4Y","description":"605 статей от авторов компании Cloud4Y"},"aDeskSettings":null,"careerAlias":"cloud4y","schoolAlias":null}},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"multiwidgets":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"multiwidgetLoading":false,"vacancies":{},"companiesGalleries":{},"companiesBanners":{},"companiesLandingVacancies":{},"companiesTechnologies":{},"workplaceInfo":null},"companyAdmin":{"companyInfo":null,"companyInfoLoading":false,"faqArticles":null,"brandingPreviewImageUrl":null,"jivoStatus":0,"adminNotifications":null,"availableInvitesCount":{}},"companyAdd":{"currentStep":"","stepsData":{},"uncompletedSteps":[],"isStepLoading":true,"isStepCommitting":false,"isInitialized":false,"agreementContent":""},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"pagesCount":0},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":true},"fixedBanner":{"isArticleStickyPanelVisible":false,"isArticleStickyPanelAtTheBottom":false,"isFixedBannerVisible":false,"isStickyPanelIconsHidden":false},"flows":{"updates":{}},"global":{"isPwa":false,"device":"desktop","isHabrCom":true,"requestId":"81b2a7da4e248e77b4989bdf77644c9e"},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"welcomePage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"query":{},"pathname":"\u002Fru\u002Fcompanies\u002Fcloud4y\u002Farticles\u002F907232\u002F","path":"\u002Fru\u002Fcompanies\u002Fcloud4y\u002Farticles\u002F907232\u002F","href":"\u002Fru\u002Fcompanies\u002Fcloud4y\u002Farticles\u002F907232\u002F"}},"me":{"user":null,"uuid":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null,"userUpdates":{"feeds":{"newPostsCount":null,"newThreadsCount":null,"newNewsCount":null,"newCount":null},"conversationUnreadCount":0},"features":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"onboarding":{"currentStep":null,"stepsData":{},"stepsErrors":{},"completedSteps":[],"isStepCommitting":false,"isCommitDisabled":true},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{"vacancies":"project-block-company-article"}},"promoData":{"isLoading":false,"hasLoaded":false,"featurer":null,"megaposts":null,"promoLinks":null,"promoPosts":null,"sticker":null},"publicationStatistics":{"statsInfo":{},"statsFunnels":{},"statsGraph":{},"defaultSuggest":{},"suggest":{},"timeTracker":{},"isTrackingActivity":false,"isUserActive":true,"otherPublicationStats":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"search":{"searchQueryError":null},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":true,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"stories":{"stories":null},"technotext":{"years":[],"technotextDocForNominees":null,"technotextDocForWinners":null,"technotextInfo":{},"technotextInfoLoading":false,"technotextWinners":{},"technotextWinnersLoading":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"userVotes":{"karmaVotesList":[],"karmaVotesPagesCount":null,"karmaVotesListLoading":false,"commentsVotesList":[],"commentsVotesPagesCount":null,"commentsVotesListLoading":false,"postsVotesList":[],"postsVotesPagesCount":null,"postsVotesListLoading":false,"userVotesList":[],"userVotesPagesCount":null,"userVotesListLoading":false},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"userSpecialization":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"notificationsLoading":false,"notificationsList":[],"notificationsPageCount":0,"pendingMarkNotificationsRead":[],"publicationsLoading":true,"publicationsList":[],"publicationsPageCount":0,"pendingDeletePublications":false,"pendingMarkPublicationsRead":false},"events":{"eventRefs":{},"eventIds":[],"pagesCount":0,"categories":[],"cities":[],"actualEvents":null,"currentEvent":null,"eventsFilter":{"city":"all","timeStarted":null,"timeEnded":null}},"wysiwyg":{"WYSIWYGRulesRefs":null},"refs":{"specializationRefs":[]},"hint":{"hints":{}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
   <script src="https://assets.habr.com/habr-web/js/chunk-vendors.978df117.js" defer></script>
   <script src="https://assets.habr.com/habr-web/js/app.58b8c457.js" defer></script>
  </div>
  <div id="overlays">
   <!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor--><!----><!--teleport anchor-->
  </div>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S28W1WC23F"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    </script>
  <script type="text/javascript">
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

  </script>
  <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
 </body>
</html>